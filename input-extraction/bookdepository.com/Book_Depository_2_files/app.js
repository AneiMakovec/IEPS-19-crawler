!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){(function(t,e,i){function o(t,e,n){try{"object"==typeof _gaq&&_gaq.push(["_trackEvent","JS Exception Error",t,e+" ("+n+")",0,!0]),"function"==typeof window.ga&&ga("send","exception",{exDescription:t,exFatal:!1,nonInteraction:!0})}catch(t){}return!1}n(4),window.onerror=o,n(5),n(7);var s=n(8),a=n(9),r=n(12),l=n(13),h=n(14),c=n(15),u=n(16),d=n(17),p=n(27),m=n(33),_=n(36),f=n(39),g=n(51),v=n(57),y=n(21),b=n(61),w=t.View.extend({el:"body",events:{"click .add-to-wishlist":"addToWishlist","click .create-wishlist":"createWishlist","click .wishlist-note":"editNote","click .basket-page button[type=submit], .checkout-page button[type=submit], .checkout-page input[type=submit]":"throttleSubmit","click .item-img-content":"zoomInJacketImage"},$window:null,_components:[],initialize:function(){var t=this;this.$window=e(window),this.$el.hasClass("js")||this.$el.addClass("js"),this.polyfillStartsWithForIE11(),this.stringLocalizer=window.firstLoadApp.stringLocalizer,this.tags=new r({isMobile:this.isMobile(),stringLocalizer:this.stringLocalizer}),this.basket=new d({el:this.el,app:t,stringLocalizer:this.stringLocalizer}),this.wishlist=new p({stringLocalizer:this.stringLocalizer}),this.mode=this.$(".main-content").hasClass("full-width")&&0===this.$(".custom-page").length?"full-width":"two-column",this.initComponents({".carousel-wrap":s,".map-block":a,".block-selector":l,".ratings-credit-wrap":h,".show-more-categories-wrap":c,".checkout-homer":f,".address-validation":g,".tabbed-block-wrap":u,".newsletter-section":m,".search-wrap":_,".tech-test":v}),t.tags.loadAll(),t.lazyLoad(),t.processUrlActionParameter(),new b(e(".book-img"))},initComponents:function(t){var e=this;this._components=i.map(t,function(t,n){var i=this.$(n);return i.length?i.map(function(n,i){return new t({el:i,app:e,stringLocalizer:e.stringLocalizer})}):null},this)},lazyLoad:function(){e(".lazy").unveil(500,null,function(){e(this).addClass("loaded")}),this.$window.trigger("scroll"),this.logLazyLoad()},logLazyLoad:function(){"function"==typeof uex&&uex("ld","imagesLazyLoadStart",{wb:1})},polyfillStartsWithForIE11:function(){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(!e||e<0?0:+e,t.length)===t})},addToWishlist:function(t){t.preventDefault();var n=e(t.currentTarget),i=n.data("isbn");e(t.currentTarget).data("current-wishlist")&&(this.wishlist.current_wishlist=e(t.currentTarget).data("current-wishlist")),this.wishlist.addItem(i,n)},processUrlActionParameter:function(){"addToWishlist"===getUrlParameter("action")&&e(".add-to-wishlist").click()},createWishlist:function(t){t.preventDefault(),this.wishlist.newWishlist()},editNote:function(t){var n=e(t.currentTarget);this.wishlist.editNote(n)},throttleSubmit:function(t){var n=e(t.currentTarget),i=n.hasClass("submitted");return i===!0?(t.preventDefault(),!1):(n.addClass("submitted"),setTimeout(function(){n.removeClass("submitted")},5e3),!0)},scrollTop:function(t){this.isMobile&&(t-=this.headerHeight()),this.$window.scrollTop(t)},headerHeight:function(){return this._headerHeight||(this._headerHeight=this.$(".primary-wrap").height()),this._headerHeight},isMobile:function(){return this.$window.width()<y.sizes.md},zoomInJacketImage:function(){this.isMobile()&&(e("body").hasClass("lightbox-show")||e("body").addClass("lightbox-show"),window.firstLoadApp.counter&&window.firstLoadApp.counter.logMobileJacketLightboxClick())}});try{window.app=new w}catch(t){var x=t.stack||t.message;o(x,"Bootstrap error",0)}}).call(e,n(1),n(2),n(3))},function(t,e){t.exports=Backbone},function(t,e){t.exports=$},function(t,e,n){var i,o;(function(){function n(t){function e(e,n,i,o,s,a){for(;s>=0&&s<a;s+=t){var r=o?o[s]:s;i=n(i,e[r],r,e)}return i}return function(n,i,o,s){i=L(i,s,4);var a=!I(n)&&x.keys(n),r=(a||n).length,l=t>0?0:r-1;return arguments.length<3&&(o=n[a?a[l]:l],l+=t),e(n,i,o,a,l,r)}}function s(t){return function(e,n,i){n=P(n,i);for(var o=T(e),s=t>0?0:o-1;s>=0&&s<o;s+=t)if(n(e[s],s,e))return s;return-1}}function a(t,e,n){return function(i,o,s){var a=0,r=T(i);if("number"==typeof s)t>0?a=s>=0?s:Math.max(s+r,a):r=s>=0?Math.min(s+1,r):s+r+1;else if(n&&s&&r)return s=n(i,o),i[s]===o?s:-1;if(o!==o)return s=e(m.call(i,a,r),x.isNaN),s>=0?s+a:-1;for(s=t>0?a:r-1;s>=0&&s<r;s+=t)if(i[s]===o)return s;return-1}}function r(t,e){var n=O.length,i=t.constructor,o=x.isFunction(i)&&i.prototype||u,s="constructor";for(x.has(t,s)&&!x.contains(e,s)&&e.push(s);n--;)s=O[n],s in t&&t[s]!==o[s]&&!x.contains(e,s)&&e.push(s)}var l=this,h=l._,c=Array.prototype,u=Object.prototype,d=Function.prototype,p=c.push,m=c.slice,_=u.toString,f=u.hasOwnProperty,g=Array.isArray,v=Object.keys,y=d.bind,b=Object.create,w=function(){},x=function(t){return t instanceof x?t:this instanceof x?void(this._wrapped=t):new x(t)};"undefined"!=typeof t&&t.exports&&(e=t.exports=x),e._=x,x.VERSION="1.8.3";var L=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,o){return t.call(e,n,i,o)};case 4:return function(n,i,o,s){return t.call(e,n,i,o,s)}}return function(){return t.apply(e,arguments)}},P=function(t,e,n){return null==t?x.identity:x.isFunction(t)?L(t,e,n):x.isObject(t)?x.matcher(t):x.property(t)};x.iteratee=function(t,e){return P(t,e,1/0)};var C=function(t,e){return function(n){var i=arguments.length;if(i<2||null==n)return n;for(var o=1;o<i;o++)for(var s=arguments[o],a=t(s),r=a.length,l=0;l<r;l++){var h=a[l];e&&void 0!==n[h]||(n[h]=s[h])}return n}},S=function(t){if(!x.isObject(t))return{};if(b)return b(t);w.prototype=t;var e=new w;return w.prototype=null,e},E=function(t){return function(e){return null==e?void 0:e[t]}},k=Math.pow(2,53)-1,T=E("length"),I=function(t){var e=T(t);return"number"==typeof e&&e>=0&&e<=k};x.each=x.forEach=function(t,e,n){e=L(e,n);var i,o;if(I(t))for(i=0,o=t.length;i<o;i++)e(t[i],i,t);else{var s=x.keys(t);for(i=0,o=s.length;i<o;i++)e(t[s[i]],s[i],t)}return t},x.map=x.collect=function(t,e,n){e=P(e,n);for(var i=!I(t)&&x.keys(t),o=(i||t).length,s=Array(o),a=0;a<o;a++){var r=i?i[a]:a;s[a]=e(t[r],r,t)}return s},x.reduce=x.foldl=x.inject=n(1),x.reduceRight=x.foldr=n(-1),x.find=x.detect=function(t,e,n){var i;if(i=I(t)?x.findIndex(t,e,n):x.findKey(t,e,n),void 0!==i&&i!==-1)return t[i]},x.filter=x.select=function(t,e,n){var i=[];return e=P(e,n),x.each(t,function(t,n,o){e(t,n,o)&&i.push(t)}),i},x.reject=function(t,e,n){return x.filter(t,x.negate(P(e)),n)},x.every=x.all=function(t,e,n){e=P(e,n);for(var i=!I(t)&&x.keys(t),o=(i||t).length,s=0;s<o;s++){var a=i?i[s]:s;if(!e(t[a],a,t))return!1}return!0},x.some=x.any=function(t,e,n){e=P(e,n);for(var i=!I(t)&&x.keys(t),o=(i||t).length,s=0;s<o;s++){var a=i?i[s]:s;if(e(t[a],a,t))return!0}return!1},x.contains=x.includes=x.include=function(t,e,n,i){return I(t)||(t=x.values(t)),("number"!=typeof n||i)&&(n=0),x.indexOf(t,e,n)>=0},x.invoke=function(t,e){var n=m.call(arguments,2),i=x.isFunction(e);return x.map(t,function(t){var o=i?e:t[e];return null==o?o:o.apply(t,n)})},x.pluck=function(t,e){return x.map(t,x.property(e))},x.where=function(t,e){return x.filter(t,x.matcher(e))},x.findWhere=function(t,e){return x.find(t,x.matcher(e))},x.max=function(t,e,n){var i,o,s=-(1/0),a=-(1/0);if(null==e&&null!=t){t=I(t)?t:x.values(t);for(var r=0,l=t.length;r<l;r++)i=t[r],i>s&&(s=i)}else e=P(e,n),x.each(t,function(t,n,i){o=e(t,n,i),(o>a||o===-(1/0)&&s===-(1/0))&&(s=t,a=o)});return s},x.min=function(t,e,n){var i,o,s=1/0,a=1/0;if(null==e&&null!=t){t=I(t)?t:x.values(t);for(var r=0,l=t.length;r<l;r++)i=t[r],i<s&&(s=i)}else e=P(e,n),x.each(t,function(t,n,i){o=e(t,n,i),(o<a||o===1/0&&s===1/0)&&(s=t,a=o)});return s},x.shuffle=function(t){for(var e,n=I(t)?t:x.values(t),i=n.length,o=Array(i),s=0;s<i;s++)e=x.random(0,s),e!==s&&(o[s]=o[e]),o[e]=n[s];return o},x.sample=function(t,e,n){return null==e||n?(I(t)||(t=x.values(t)),t[x.random(t.length-1)]):x.shuffle(t).slice(0,Math.max(0,e))},x.sortBy=function(t,e,n){return e=P(e,n),x.pluck(x.map(t,function(t,n,i){return{value:t,index:n,criteria:e(t,n,i)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index}),"value")};var M=function(t){return function(e,n,i){var o={};return n=P(n,i),x.each(e,function(i,s){var a=n(i,s,e);t(o,i,a)}),o}};x.groupBy=M(function(t,e,n){x.has(t,n)?t[n].push(e):t[n]=[e]}),x.indexBy=M(function(t,e,n){t[n]=e}),x.countBy=M(function(t,e,n){x.has(t,n)?t[n]++:t[n]=1}),x.toArray=function(t){return t?x.isArray(t)?m.call(t):I(t)?x.map(t,x.identity):x.values(t):[]},x.size=function(t){return null==t?0:I(t)?t.length:x.keys(t).length},x.partition=function(t,e,n){e=P(e,n);var i=[],o=[];return x.each(t,function(t,n,s){(e(t,n,s)?i:o).push(t)}),[i,o]},x.first=x.head=x.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:x.initial(t,t.length-e)},x.initial=function(t,e,n){return m.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},x.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:x.rest(t,Math.max(0,t.length-e))},x.rest=x.tail=x.drop=function(t,e,n){return m.call(t,null==e||n?1:e)},x.compact=function(t){return x.filter(t,x.identity)};var A=function(t,e,n,i){for(var o=[],s=0,a=i||0,r=T(t);a<r;a++){var l=t[a];if(I(l)&&(x.isArray(l)||x.isArguments(l))){e||(l=A(l,e,n));var h=0,c=l.length;for(o.length+=c;h<c;)o[s++]=l[h++]}else n||(o[s++]=l)}return o};x.flatten=function(t,e){return A(t,e,!1)},x.without=function(t){return x.difference(t,m.call(arguments,1))},x.uniq=x.unique=function(t,e,n,i){x.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=P(n,i));for(var o=[],s=[],a=0,r=T(t);a<r;a++){var l=t[a],h=n?n(l,a,t):l;e?(a&&s===h||o.push(l),s=h):n?x.contains(s,h)||(s.push(h),o.push(l)):x.contains(o,l)||o.push(l)}return o},x.union=function(){return x.uniq(A(arguments,!0,!0))},x.intersection=function(t){for(var e=[],n=arguments.length,i=0,o=T(t);i<o;i++){var s=t[i];if(!x.contains(e,s)){for(var a=1;a<n&&x.contains(arguments[a],s);a++);a===n&&e.push(s)}}return e},x.difference=function(t){var e=A(arguments,!0,!0,1);return x.filter(t,function(t){return!x.contains(e,t)})},x.zip=function(){return x.unzip(arguments)},x.unzip=function(t){for(var e=t&&x.max(t,T).length||0,n=Array(e),i=0;i<e;i++)n[i]=x.pluck(t,i);return n},x.object=function(t,e){for(var n={},i=0,o=T(t);i<o;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},x.findIndex=s(1),x.findLastIndex=s(-1),x.sortedIndex=function(t,e,n,i){n=P(n,i,1);for(var o=n(e),s=0,a=T(t);s<a;){var r=Math.floor((s+a)/2);n(t[r])<o?s=r+1:a=r}return s},x.indexOf=a(1,x.findIndex,x.sortedIndex),x.lastIndexOf=a(-1,x.findLastIndex),x.range=function(t,e,n){null==e&&(e=t||0,t=0),n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),o=Array(i),s=0;s<i;s++,t+=n)o[s]=t;return o};var D=function(t,e,n,i,o){if(!(i instanceof e))return t.apply(n,o);var s=S(t.prototype),a=t.apply(s,o);return x.isObject(a)?a:s};x.bind=function(t,e){if(y&&t.bind===y)return y.apply(t,m.call(arguments,1));if(!x.isFunction(t))throw new TypeError("Bind must be called on a function");var n=m.call(arguments,2),i=function(){return D(t,i,e,this,n.concat(m.call(arguments)))};return i},x.partial=function(t){var e=m.call(arguments,1),n=function(){for(var i=0,o=e.length,s=Array(o),a=0;a<o;a++)s[a]=e[a]===x?arguments[i++]:e[a];for(;i<arguments.length;)s.push(arguments[i++]);return D(t,n,this,this,s)};return n},x.bindAll=function(t){var e,n,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(e=1;e<i;e++)n=arguments[e],t[n]=x.bind(t[n],t);return t},x.memoize=function(t,e){var n=function(i){var o=n.cache,s=""+(e?e.apply(this,arguments):i);return x.has(o,s)||(o[s]=t.apply(this,arguments)),o[s]};return n.cache={},n},x.delay=function(t,e){var n=m.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},x.defer=x.partial(x.delay,x,1),x.throttle=function(t,e,n){var i,o,s,a=null,r=0;n||(n={});var l=function(){r=n.leading===!1?0:x.now(),a=null,s=t.apply(i,o),a||(i=o=null)};return function(){var h=x.now();r||n.leading!==!1||(r=h);var c=e-(h-r);return i=this,o=arguments,c<=0||c>e?(a&&(clearTimeout(a),a=null),r=h,s=t.apply(i,o),a||(i=o=null)):a||n.trailing===!1||(a=setTimeout(l,c)),s}},x.debounce=function(t,e,n){var i,o,s,a,r,l=function(){var h=x.now()-a;h<e&&h>=0?i=setTimeout(l,e-h):(i=null,n||(r=t.apply(s,o),i||(s=o=null)))};return function(){s=this,o=arguments,a=x.now();var h=n&&!i;return i||(i=setTimeout(l,e)),h&&(r=t.apply(s,o),s=o=null),r}},x.wrap=function(t,e){return x.partial(e,t)},x.negate=function(t){return function(){return!t.apply(this,arguments)}},x.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},x.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},x.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},x.once=x.partial(x.before,2);var z=!{toString:null}.propertyIsEnumerable("toString"),O=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];x.keys=function(t){if(!x.isObject(t))return[];if(v)return v(t);var e=[];for(var n in t)x.has(t,n)&&e.push(n);return z&&r(t,e),e},x.allKeys=function(t){if(!x.isObject(t))return[];var e=[];for(var n in t)e.push(n);return z&&r(t,e),e},x.values=function(t){for(var e=x.keys(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=t[e[o]];return i},x.mapObject=function(t,e,n){e=P(e,n);for(var i,o=x.keys(t),s=o.length,a={},r=0;r<s;r++)i=o[r],a[i]=e(t[i],i,t);return a},x.pairs=function(t){for(var e=x.keys(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=[e[o],t[e[o]]];return i},x.invert=function(t){for(var e={},n=x.keys(t),i=0,o=n.length;i<o;i++)e[t[n[i]]]=n[i];return e},x.functions=x.methods=function(t){var e=[];for(var n in t)x.isFunction(t[n])&&e.push(n);return e.sort()},x.extend=C(x.allKeys),x.extendOwn=x.assign=C(x.keys),x.findKey=function(t,e,n){e=P(e,n);for(var i,o=x.keys(t),s=0,a=o.length;s<a;s++)if(i=o[s],e(t[i],i,t))return i},x.pick=function(t,e,n){var i,o,s={},a=t;if(null==a)return s;x.isFunction(e)?(o=x.allKeys(a),i=L(e,n)):(o=A(arguments,!1,!1,1),i=function(t,e,n){return e in n},a=Object(a));for(var r=0,l=o.length;r<l;r++){var h=o[r],c=a[h];i(c,h,a)&&(s[h]=c)}return s},x.omit=function(t,e,n){if(x.isFunction(e))e=x.negate(e);else{var i=x.map(A(arguments,!1,!1,1),String);e=function(t,e){return!x.contains(i,e)}}return x.pick(t,e,n)},x.defaults=C(x.allKeys,!0),x.create=function(t,e){var n=S(t);return e&&x.extendOwn(n,e),n},x.clone=function(t){return x.isObject(t)?x.isArray(t)?t.slice():x.extend({},t):t},x.tap=function(t,e){return e(t),t},x.isMatch=function(t,e){var n=x.keys(e),i=n.length;if(null==t)return!i;for(var o=Object(t),s=0;s<i;s++){var a=n[s];if(e[a]!==o[a]||!(a in o))return!1}return!0};var B=function(t,e,n,i){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof x&&(t=t._wrapped),e instanceof x&&(e=e._wrapped);var o=_.call(t);if(o!==_.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var s="[object Array]"===o;if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,r=e.constructor;if(a!==r&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(r)&&r instanceof r)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],i=i||[];for(var l=n.length;l--;)if(n[l]===t)return i[l]===e;if(n.push(t),i.push(e),s){if(l=t.length,l!==e.length)return!1;for(;l--;)if(!B(t[l],e[l],n,i))return!1}else{var h,c=x.keys(t);if(l=c.length,x.keys(e).length!==l)return!1;for(;l--;)if(h=c[l],!x.has(e,h)||!B(t[h],e[h],n,i))return!1}return n.pop(),i.pop(),!0};x.isEqual=function(t,e){return B(t,e)},x.isEmpty=function(t){return null==t||(I(t)&&(x.isArray(t)||x.isString(t)||x.isArguments(t))?0===t.length:0===x.keys(t).length)},x.isElement=function(t){return!(!t||1!==t.nodeType)},x.isArray=g||function(t){return"[object Array]"===_.call(t)},x.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},x.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){x["is"+t]=function(e){return _.call(e)==="[object "+t+"]"}}),x.isArguments(arguments)||(x.isArguments=function(t){return x.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(x.isFunction=function(t){return"function"==typeof t||!1}),x.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},x.isNaN=function(t){return x.isNumber(t)&&t!==+t},x.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===_.call(t)},x.isNull=function(t){return null===t},x.isUndefined=function(t){return void 0===t},x.has=function(t,e){return null!=t&&f.call(t,e)},x.noConflict=function(){return l._=h,this},x.identity=function(t){return t},x.constant=function(t){return function(){return t}},x.noop=function(){},x.property=E,x.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},x.matcher=x.matches=function(t){return t=x.extendOwn({},t),function(e){return x.isMatch(e,t)}},x.times=function(t,e,n){var i=Array(Math.max(0,t));e=L(e,n,1);for(var o=0;o<t;o++)i[o]=e(o);return i},x.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},x.now=Date.now||function(){return(new Date).getTime()};var U={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=x.invert(U),R=function(t){var e=function(e){return t[e]},n="(?:"+x.keys(t).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(o,e):t}};x.escape=R(U),x.unescape=R(N),x.result=function(t,e,n){var i=null==t?void 0:t[e];return void 0===i&&(i=n),x.isFunction(i)?i.call(t):i};var j=0;x.uniqueId=function(t){var e=++j+"";return t?t+e:e},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var $=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Z=/\\|'|\r|\n|\u2028|\u2029/g,W=function(t){return"\\"+F[t]};x.template=function(t,e,n){!e&&n&&(e=n),e=x.defaults({},e,x.templateSettings);var i=RegExp([(e.escape||$).source,(e.interpolate||$).source,(e.evaluate||$).source].join("|")+"|$","g"),o=0,s="__p+='";t.replace(i,function(e,n,i,a,r){return s+=t.slice(o,r).replace(Z,W),o=r+e.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":a&&(s+="';\n"+a+"\n__p+='"),e}),s+="';\n",e.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var a=new Function(e.variable||"obj","_",s)}catch(t){throw t.source=s,t}var r=function(t){return a.call(this,t,x)},l=e.variable||"obj";return r.source="function("+l+"){\n"+s+"}",r},x.chain=function(t){var e=x(t);return e._chain=!0,e};var H=function(t,e){return t._chain?x(e).chain():e};x.mixin=function(t){x.each(x.functions(t),function(e){var n=x[e]=t[e];x.prototype[e]=function(){var t=[this._wrapped];return p.apply(t,arguments),H(this,n.apply(x,t))}})},x.mixin(x),x.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=c[t];x.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],H(this,n)}}),x.each(["concat","join","slice"],function(t){var e=c[t];x.prototype[t]=function(){return H(this,e.apply(this._wrapped,arguments))}}),x.prototype.value=function(){return this._wrapped},x.prototype.valueOf=x.prototype.toJSON=x.prototype.value,x.prototype.toString=function(){return""+this._wrapped},i=[],o=function(){return x}.apply(e,i),!(void 0!==o&&(t.exports=o))}).call(this)},function(t,e){Array.prototype.map=function(t){if(void 0===this||null===this)throw new TypeError(this+"is not an object");if(!(t instanceof Function))throw new TypeError(t+" is not a function");for(var e=Object(this),n=arguments[1],i=e instanceof String?e.split(""):e,o=Math.max(Math.min(i.length,9007199254740991),0)||0,s=-1,a=[];++s<o;)s in i&&(a[s]=t.call(n,i[s],s,e));return a}},function(t,e,n){(function(e){n(6),e.fn.unveil=function(t,n,i){function o(){var t=c.filter(function(){var t=e(this);if(!t.is(":hidden")){var n=a.scrollTop(),i=n+a.height(),o=t.offset().top,s=o+t.height();return s>=n-r&&o<=i+r}});s=t.trigger("unveil"),c=c.not(s)}var s,a=e(window),r=t||0,l=window.devicePixelRatio>1,h=l?"data-lazy-retina":"data-lazy",c=this;return this.one("unveil",function(){var t=this.getAttribute(h);t=t||this.getAttribute("data-lazy"),t&&("function"==typeof i&&e(this).on("load",i),this.setAttribute("src",t),"function"==typeof n&&n.call(this))}),a.on("scroll.unveil resize.unveil lookup.unveil",o),o(),this},t.exports=e}).call(e,n(2))},function(t,e){Array.prototype.filter=function(t){if(void 0===this||null===this)throw new TypeError(this+"is not an object");if(!(t instanceof Function))throw new TypeError(t+" is not a function");for(var e,n=Object(this),i=arguments[1],o=n instanceof String?n.split(""):n,s=Math.max(Math.min(o.length,9007199254740991),0)||0,a=-1,r=[];++a<s;)e=o[a],a in o&&t.call(i,e,a,n)&&r.push(e);return r}},function(t,e,n){var i,o,s;/*!
	 * jQuery-ajaxTransport-XDomainRequest - v1.0.4 - 2015-03-05
	 * https://github.com/MoonScript/jQuery-ajaxTransport-XDomainRequest
	 * Copyright (c) 2015 Jason Moon (@JSONMOON)
	 * Licensed MIT (/blob/master/LICENSE.txt)
	 */
!function(a){o=[n(2)],i=a,s="function"==typeof i?i.apply(e,o):i,!(void 0!==s&&(t.exports=s))}(function(t){if(t.support.cors||!t.ajaxTransport||!window.XDomainRequest)return t;var e=/^(https?:)?\/\//i,n=/^get|post$/i,i=new RegExp("^(//|"+location.protocol+")","i");return t.ajaxTransport("* text html xml json",function(o,s,a){if(o.crossDomain&&o.async&&n.test(o.type)&&e.test(o.url)&&i.test(o.url)){var r=null;return{send:function(e,n){var i="",a=(s.dataType||"").toLowerCase();r=new XDomainRequest,/^\d+$/.test(s.timeout)&&(r.timeout=s.timeout),r.ontimeout=function(){n(500,"timeout")},r.onload=function(){var e="Content-Length: "+r.responseText.length+"\r\nContent-Type: "+r.contentType,i={code:200,message:"success"},o={text:r.responseText};try{if("html"===a||/text\/html/i.test(r.contentType))o.html=r.responseText;else if("json"===a||"text"!==a&&/\/json/i.test(r.contentType))try{o.json=t.parseJSON(r.responseText)}catch(t){i.code=500,i.message="parseerror"}else if("xml"===a||"text"!==a&&/\/xml/i.test(r.contentType)){var s=new ActiveXObject("Microsoft.XMLDOM");s.async=!1;try{s.loadXML(r.responseText)}catch(t){s=void 0}if(!s||!s.documentElement||s.getElementsByTagName("parsererror").length)throw i.code=500,i.message="parseerror","Invalid XML: "+r.responseText;o.xml=s}}catch(t){throw t}finally{n(i.code,i.message,o,e)}},r.onprogress=function(){},r.onerror=function(){n(500,"error",{text:r.responseText})},s.data&&(i="string"===t.type(s.data)?s.data:t.param(s.data)),r.open(o.type,o.url),r.send(i)},abort:function(){r&&r.abort()}}}}),t})},function(t,e,n){(function(e,n){var i=e.View.extend({events:{"click .next-btn":"slideNext","click .prev-btn":"slidePrev"},initialize:function(){var t=this;this.$(".tab-wrap").is(":hidden")?n(window).on("refresh",function(){t.$(".tab-wrap").is(":hidden")||t.setPos.apply(t)}):this.setPos(),this.on("updated:carousel",function(){t.setPos()})},setPos:function(){var t=this;this.tab=this.$(".tab"),this.wrap=this.$(".tab-wrap"),this.wrap.addClass("carousel-active"),this.maxScroll=this.tab.outerWidth()-this.wrap.width(),this.listenTo(this.wrap,"scroll",this.scrolled),this.wrap.on("scroll",function(e){t.scrolled.apply(t,[e.target.scrollLeft])}),n(window).on("resize",function(){t.resetPos.apply(t)}),this.pos=this.pos?this.pos:0,this.checkForBoundary()},slideNext:function(){this.pos<this.maxScroll&&(this.pos+=Math.round(.9*this.wrap.width()),this.updatePos())},slidePrev:function(){this.pos>0&&(this.pos-=Math.round(.9*this.wrap.width()),this.updatePos())},updatePos:function(){var t=this;this.wrap.animate({scrollLeft:this.pos},function(){t.checkForBoundary.apply(t)})},checkForBoundary:function(){this.maxScroll<=0?(this.maxScroll=0,this.$el.addClass("carousel-begin"),this.$el.addClass("carousel-end")):0===this.pos?(this.$el.removeClass("carousel-end"),this.$el.addClass("carousel-begin")):this.pos==this.maxScroll?(this.$el.removeClass("carousel-begin"),this.$el.addClass("carousel-end")):(this.$el.removeClass("carousel-begin"),this.$el.removeClass("carousel-end"))},scrolled:function(t){var e=this;null!==this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){e.pos=t,e.checkForBoundary.apply(e),e.timeout=null},100)},resetPos:function(){this.pos=this.wrap.scrollLeft(),this.maxScroll=this.tab.outerWidth()-this.wrap.width(),this.checkForBoundary()}});t.exports=i}).call(e,n(1),n(2))},function(t,e,n){(function(e,i){n(4);var o=n(10),s="/map/data.json",a="",r="",l=1,h=n(11),c=e.Model.extend({url:function(){return s},startPolling:function(){var t=this;this.on("sync",function(){setTimeout(function(){t.fetch()},5e3)}),this.fetch()}}),u=e.View.extend({_started:!1,_booksRendered:0,initialize:function(t){this.stringLocalizer=t.stringLocalizer,this.$el.data("endpoint")&&(s=this.$el.data("endpoint")),a=this.$el.data("asset-cdn")||"https://d3ogvdx946i4sr.cloudfront.net/",r=this.$el.data("img-cdn")||"https://d1w7fb2mkkr3kw.cloudfront.net/",l=this.$el.parents(".map-live-page").length?5:1,this.$el.is(":visible")&&this.start();var e=this;i(window).on("resize",function(){e._started||e.start()})},start:function(){this.render(),this.model=new c({imgCdn:r}),this.listenTo(this.model,"change:bookUrl",this.renderBook),this.model.startPolling(),this._started=!0,this.logRender();var t=this;setTimeout(function(){t._booksRendered<2&&t.logFailure()},15e3)},logFailure:function(){window.ue&&window.ue.count("MapUpdateFailed",1)},logRender:function(){"function"==typeof uex&&uex("ld","mapRenderStart",{wb:1})},hide:function(){this.$el.parentsUntil(".block-wrap").parent().hide()},render:function(){this.map=o.map(this.el,{minZoom:3,maxZoom:6,attributionControl:!1,zoomControl:!1,keepInView:!0,closePopupOnClick:!1}).setView([51.505,-.09],13),this.popups=new Array;var t=this.map;o.tileLayer(a+"map/{z}/{x}/{y}.jpg").addTo(t);var e=L.latLngBounds([[80,-300],[-80,300]]);t.setMaxBounds(e),t.on("drag",function(){t.panInsideBounds(e,{animate:!1})}),t.setZoom(3)},renderBook:function(t){var e=h(t.attributes),n=this.stringLocalizer.localizeTemplate(e);this.map.panTo([t.get("Latitude"),t.get("Longitude")]);var i=o.popup({maxHeight:180,className:"map-popup"}).setContent(n).setLatLng([t.get("Latitude"),t.get("Longitude")]).addTo(this.map);this.popups.push(i),this.popups.length>l&&this.map.closePopup(this.popups.shift()),this._booksRendered++}});t.exports=u}).call(e,n(1),n(2))},function(t,e,n){var i,o;!function(s,a,r){var l=s.L,h={};h.version="0.7.7","object"==typeof t&&"object"==typeof t.exports?t.exports=h:(i=h,o="function"==typeof i?i.call(e,n,e,t):i,!(o!==r&&(t.exports=o))),h.noConflict=function(){return s.L=l,this},s.L=h,h.Util={extend:function(t){var e,n,i,o,s=Array.prototype.slice.call(arguments,1);for(n=0,i=s.length;n<i;n++){o=s[n]||{};for(e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t},bind:function(t,e){var n=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,n||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(n){return n[e]=n[e]||++t,n[e]}}(),invokeEach:function(t,e,n){var i,o;if("object"==typeof t){o=Array.prototype.slice.call(arguments,3);for(i in t)e.apply(n,[i,t[i]].concat(o));return!0}return!1},limitExecByInterval:function(t,e,n){var i,o;return function s(){var a=arguments;return i?void(o=!0):(i=!0,setTimeout(function(){i=!1,o&&(s.apply(n,a),o=!1)},e),void t.apply(n,a))}},falseFn:function(){return!1},formatNum:function(t,e){var n=Math.pow(10,e||5);return Math.round(t*n)/n},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return h.Util.trim(t).split(/\s+/)},setOptions:function(t,e){return t.options=h.extend({},t.options,e),t.options},getParamString:function(t,e,n){var i=[];for(var o in t)i.push(encodeURIComponent(n?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&e.indexOf("?")!==-1?"&":"?")+i.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,n){var i=e[n];if(i===r)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(e)),i})},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function t(t){var e,n,i=["webkit","moz","o","ms"];for(e=0;e<i.length&&!n;e++)n=s[i[e]+t];return n}function e(t){var e=+new Date,i=Math.max(0,16-(e-n));return n=e+i,s.setTimeout(t,i)}var n=0,i=s.requestAnimationFrame||t("RequestAnimationFrame")||e,o=s.cancelAnimationFrame||t("CancelAnimationFrame")||t("CancelRequestAnimationFrame")||function(t){s.clearTimeout(t)};h.Util.requestAnimFrame=function(t,n,o,a){return t=h.bind(t,n),o&&i===e?void t():i.call(s,t,a)},h.Util.cancelAnimFrame=function(t){t&&o.call(s,t)}}(),h.extend=h.Util.extend,h.bind=h.Util.bind,h.stamp=h.Util.stamp,h.setOptions=h.Util.setOptions,h.Class=function(){},h.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},n=function(){};n.prototype=this.prototype;var i=new n;i.constructor=e,e.prototype=i;for(var o in this)this.hasOwnProperty(o)&&"prototype"!==o&&(e[o]=this[o]);t.statics&&(h.extend(e,t.statics),delete t.statics),t.includes&&(h.Util.extend.apply(null,[i].concat(t.includes)),delete t.includes),t.options&&i.options&&(t.options=h.extend({},i.options,t.options)),h.extend(i,t),i._initHooks=[];var s=this;return e.__super__=s.prototype,i.callInitHooks=function(){if(!this._initHooksCalled){s.prototype.callInitHooks&&s.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=i._initHooks.length;t<e;t++)i._initHooks[t].call(this)}},e},h.Class.include=function(t){h.extend(this.prototype,t)},h.Class.mergeOptions=function(t){h.extend(this.prototype.options,t)},h.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n)};var c="_leaflet_events";h.Mixin={},h.Mixin.Events={addEventListener:function(t,e,n){if(h.Util.invokeEach(t,this.addEventListener,this,e,n))return this;var i,o,s,a,r,l,u,d=this[c]=this[c]||{},p=n&&n!==this&&h.stamp(n);for(t=h.Util.splitWords(t),i=0,o=t.length;i<o;i++)s={action:e,context:n||this},a=t[i],p?(r=a+"_idx",l=r+"_len",u=d[r]=d[r]||{},u[p]||(u[p]=[],d[l]=(d[l]||0)+1),u[p].push(s)):(d[a]=d[a]||[],d[a].push(s));return this},hasEventListeners:function(t){var e=this[c];return!!e&&(t in e&&e[t].length>0||t+"_idx"in e&&e[t+"_idx_len"]>0)},removeEventListener:function(t,e,n){if(!this[c])return this;if(!t)return this.clearAllEventListeners();if(h.Util.invokeEach(t,this.removeEventListener,this,e,n))return this;var i,o,s,a,r,l,u,d,p,m=this[c],_=n&&n!==this&&h.stamp(n);for(t=h.Util.splitWords(t),i=0,o=t.length;i<o;i++)if(s=t[i],l=s+"_idx",u=l+"_len",d=m[l],e){if(a=_&&d?d[_]:m[s]){for(r=a.length-1;r>=0;r--)a[r].action!==e||n&&a[r].context!==n||(p=a.splice(r,1),p[0].action=h.Util.falseFn);n&&d&&0===a.length&&(delete d[_],m[u]--)}}else delete m[s],delete m[l],delete m[u];return this},clearAllEventListeners:function(){return delete this[c],this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var n,i,o,s,a,r=h.Util.extend({},e,{type:t,target:this}),l=this[c];if(l[t])for(n=l[t].slice(),i=0,o=n.length;i<o;i++)n[i].action.call(n[i].context,r);s=l[t+"_idx"];for(a in s)if(n=s[a].slice())for(i=0,o=n.length;i<o;i++)n[i].action.call(n[i].context,r);return this},addOneTimeEventListener:function(t,e,n){if(h.Util.invokeEach(t,this.addOneTimeEventListener,this,e,n))return this;var i=h.bind(function(){this.removeEventListener(t,e,n).removeEventListener(t,i,n)},this);return this.addEventListener(t,e,n).addEventListener(t,i,n)}},h.Mixin.Events.on=h.Mixin.Events.addEventListener,h.Mixin.Events.off=h.Mixin.Events.removeEventListener,h.Mixin.Events.once=h.Mixin.Events.addOneTimeEventListener,h.Mixin.Events.fire=h.Mixin.Events.fireEvent,function(){var t="ActiveXObject"in s,e=t&&!a.addEventListener,n=navigator.userAgent.toLowerCase(),i=n.indexOf("webkit")!==-1,o=n.indexOf("chrome")!==-1,l=n.indexOf("phantom")!==-1,c=n.indexOf("android")!==-1,u=n.search("android [23]")!==-1,d=n.indexOf("gecko")!==-1,p=typeof orientation!=r+"",m=!s.PointerEvent&&s.MSPointerEvent,_=s.PointerEvent&&s.navigator.pointerEnabled||m,f="devicePixelRatio"in s&&s.devicePixelRatio>1||"matchMedia"in s&&s.matchMedia("(min-resolution:144dpi)")&&s.matchMedia("(min-resolution:144dpi)").matches,g=a.documentElement,v=t&&"transition"in g.style,y="WebKitCSSMatrix"in s&&"m11"in new s.WebKitCSSMatrix&&!u,b="MozPerspective"in g.style,w="OTransition"in g.style,x=!s.L_DISABLE_3D&&(v||y||b||w)&&!l,L=!s.L_NO_TOUCH&&!l&&(_||"ontouchstart"in s||s.DocumentTouch&&a instanceof s.DocumentTouch);h.Browser={ie:t,ielt9:e,webkit:i,gecko:d&&!i&&!s.opera&&!t,android:c,android23:u,chrome:o,ie3d:v,webkit3d:y,gecko3d:b,opera3d:w,any3d:x,mobile:p,mobileWebkit:p&&i,mobileWebkit3d:p&&y,mobileOpera:p&&s.opera,touch:L,msPointer:m,pointer:_,retina:f}}(),h.Point=function(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e},h.Point.prototype={clone:function(){return new h.Point(this.x,this.y)},add:function(t){return this.clone()._add(h.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(h.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=h.point(t);var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},equals:function(t){return t=h.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=h.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+h.Util.formatNum(this.x)+", "+h.Util.formatNum(this.y)+")"}},h.point=function(t,e,n){return t instanceof h.Point?t:h.Util.isArray(t)?new h.Point(t[0],t[1]):t===r||null===t?t:new h.Point(t,e,n)},h.Bounds=function(t,e){if(t)for(var n=e?[t,e]:t,i=0,o=n.length;i<o;i++)this.extend(n[i])},h.Bounds.prototype={extend:function(t){return t=h.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new h.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new h.Point(this.min.x,this.max.y)},getTopRight:function(){return new h.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,n;return t="number"==typeof t[0]||t instanceof h.Point?h.point(t):h.bounds(t),t instanceof h.Bounds?(e=t.min,n=t.max):e=n=t,e.x>=this.min.x&&n.x<=this.max.x&&e.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=h.bounds(t);var e=this.min,n=this.max,i=t.min,o=t.max,s=o.x>=e.x&&i.x<=n.x,a=o.y>=e.y&&i.y<=n.y;return s&&a},isValid:function(){return!(!this.min||!this.max)}},h.bounds=function(t,e){return!t||t instanceof h.Bounds?t:new h.Bounds(t,e)},h.Transformation=function(t,e,n,i){this._a=t,this._b=e,this._c=n,this._d=i},h.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new h.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},h.DomUtil={get:function(t){return"string"==typeof t?a.getElementById(t):t},getStyle:function(t,e){var n=t.style[e];if(!n&&t.currentStyle&&(n=t.currentStyle[e]),(!n||"auto"===n)&&a.defaultView){var i=a.defaultView.getComputedStyle(t,null);n=i?i[e]:null}return"auto"===n?null:n},getViewportOffset:function(t){var e,n=0,i=0,o=t,s=a.body,r=a.documentElement;do{if(n+=o.offsetTop||0,i+=o.offsetLeft||0,n+=parseInt(h.DomUtil.getStyle(o,"borderTopWidth"),10)||0,i+=parseInt(h.DomUtil.getStyle(o,"borderLeftWidth"),10)||0,e=h.DomUtil.getStyle(o,"position"),o.offsetParent===s&&"absolute"===e)break;if("fixed"===e){n+=s.scrollTop||r.scrollTop||0,i+=s.scrollLeft||r.scrollLeft||0;break}if("relative"===e&&!o.offsetLeft){var l=h.DomUtil.getStyle(o,"width"),c=h.DomUtil.getStyle(o,"max-width"),u=o.getBoundingClientRect();"none"===l&&"none"===c||(i+=u.left+o.clientLeft),n+=u.top+(s.scrollTop||r.scrollTop||0);break}o=o.offsetParent}while(o);o=t;do{if(o===s)break;n-=o.scrollTop||0,i-=o.scrollLeft||0,o=o.parentNode}while(o);return new h.Point(i,n)},documentIsLtr:function(){return h.DomUtil._docIsLtrCached||(h.DomUtil._docIsLtrCached=!0,h.DomUtil._docIsLtr="ltr"===h.DomUtil.getStyle(a.body,"direction")),h.DomUtil._docIsLtr},create:function(t,e,n){var i=a.createElement(t);return i.className=e,n&&n.appendChild(i),i},hasClass:function(t,e){if(t.classList!==r)return t.classList.contains(e);var n=h.DomUtil._getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==r)for(var n=h.Util.splitWords(e),i=0,o=n.length;i<o;i++)t.classList.add(n[i]);else if(!h.DomUtil.hasClass(t,e)){var s=h.DomUtil._getClass(t);h.DomUtil._setClass(t,(s?s+" ":"")+e)}},removeClass:function(t,e){t.classList!==r?t.classList.remove(e):h.DomUtil._setClass(t,h.Util.trim((" "+h.DomUtil._getClass(t)+" ").replace(" "+e+" "," ")))},_setClass:function(t,e){t.className.baseVal===r?t.className=e:t.className.baseVal=e},_getClass:function(t){return t.className.baseVal===r?t.className:t.className.baseVal},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var n=!1,i="DXImageTransform.Microsoft.Alpha";try{n=t.filters.item(i)}catch(t){if(1===e)return}e=Math.round(100*e),n?(n.Enabled=100!==e,n.Opacity=e):t.style.filter+=" progid:"+i+"(opacity="+e+")"}},testProp:function(t){for(var e=a.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1},getTranslateString:function(t){var e=h.Browser.webkit3d,n="translate"+(e?"3d":"")+"(",i=(e?",0":"")+")";return n+t.x+"px,"+t.y+"px"+i},getScaleString:function(t,e){var n=h.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),i=" scale("+t+") ";return n+i},setPosition:function(t,e,n){t._leaflet_pos=e,!n&&h.Browser.any3d?t.style[h.DomUtil.TRANSFORM]=h.DomUtil.getTranslateString(e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},h.DomUtil.TRANSFORM=h.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),h.DomUtil.TRANSITION=h.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),h.DomUtil.TRANSITION_END="webkitTransition"===h.DomUtil.TRANSITION||"OTransition"===h.DomUtil.TRANSITION?h.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in a)h.extend(h.DomUtil,{disableTextSelection:function(){h.DomEvent.on(s,"selectstart",h.DomEvent.preventDefault)},enableTextSelection:function(){h.DomEvent.off(s,"selectstart",h.DomEvent.preventDefault)}});else{var t=h.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);h.extend(h.DomUtil,{disableTextSelection:function(){if(t){var e=a.documentElement.style;this._userSelect=e[t],e[t]="none"}},enableTextSelection:function(){t&&(a.documentElement.style[t]=this._userSelect,delete this._userSelect)}})}h.extend(h.DomUtil,{disableImageDrag:function(){h.DomEvent.on(s,"dragstart",h.DomEvent.preventDefault)},enableImageDrag:function(){h.DomEvent.off(s,"dragstart",h.DomEvent.preventDefault)}})}(),h.LatLng=function(t,e,n){if(t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=t,this.lng=e,n!==r&&(this.alt=parseFloat(n))},h.extend(h.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),h.LatLng.prototype={equals:function(t){if(!t)return!1;t=h.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return e<=h.LatLng.MAX_MARGIN},toString:function(t){return"LatLng("+h.Util.formatNum(this.lat,t)+", "+h.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=h.latLng(t);var e=6378137,n=h.LatLng.DEG_TO_RAD,i=(t.lat-this.lat)*n,o=(t.lng-this.lng)*n,s=this.lat*n,a=t.lat*n,r=Math.sin(i/2),l=Math.sin(o/2),c=r*r+l*l*Math.cos(s)*Math.cos(a);return 2*e*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))},wrap:function(t,e){var n=this.lng;return t=t||-180,e=e||180,n=(n+e)%(e-t)+(n<t||n===e?e:t),new h.LatLng(this.lat,n)}},h.latLng=function(t,e){return t instanceof h.LatLng?t:h.Util.isArray(t)?"number"==typeof t[0]||"string"==typeof t[0]?new h.LatLng(t[0],t[1],t[2]):null:t===r||null===t?t:"object"==typeof t&&"lat"in t?new h.LatLng(t.lat,"lng"in t?t.lng:t.lon):e===r?null:new h.LatLng(t,e)},h.LatLngBounds=function(t,e){if(t)for(var n=e?[t,e]:t,i=0,o=n.length;i<o;i++)this.extend(n[i])},h.LatLngBounds.prototype={extend:function(t){if(!t)return this;var e=h.latLng(t);return t=null!==e?e:h.latLngBounds(t),t instanceof h.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new h.LatLng(t.lat,t.lng),this._northEast=new h.LatLng(t.lat,t.lng)):t instanceof h.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this},pad:function(t){var e=this._southWest,n=this._northEast,i=Math.abs(e.lat-n.lat)*t,o=Math.abs(e.lng-n.lng)*t;return new h.LatLngBounds(new h.LatLng(e.lat-i,e.lng-o),new h.LatLng(n.lat+i,n.lng+o))},getCenter:function(){return new h.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new h.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new h.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof h.LatLng?h.latLng(t):h.latLngBounds(t);var e,n,i=this._southWest,o=this._northEast;return t instanceof h.LatLngBounds?(e=t.getSouthWest(),n=t.getNorthEast()):e=n=t,e.lat>=i.lat&&n.lat<=o.lat&&e.lng>=i.lng&&n.lng<=o.lng},intersects:function(t){t=h.latLngBounds(t);var e=this._southWest,n=this._northEast,i=t.getSouthWest(),o=t.getNorthEast(),s=o.lat>=e.lat&&i.lat<=n.lat,a=o.lng>=e.lng&&i.lng<=n.lng;return s&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return!!t&&(t=h.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast()))},isValid:function(){return!(!this._southWest||!this._northEast)}},h.latLngBounds=function(t,e){return!t||t instanceof h.LatLngBounds?t:new h.LatLngBounds(t,e)},h.Projection={},h.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=h.LatLng.DEG_TO_RAD,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,t.lat),-n),o=t.lng*e,s=i*e;return s=Math.log(Math.tan(Math.PI/4+s/2)),new h.Point(o,s)},unproject:function(t){var e=h.LatLng.RAD_TO_DEG,n=t.x*e,i=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new h.LatLng(i,n)}},h.Projection.LonLat={project:function(t){return new h.Point(t.lng,t.lat)},unproject:function(t){return new h.LatLng(t.y,t.x)}},h.CRS={latLngToPoint:function(t,e){var n=this.projection.project(t),i=this.scale(e);return this.transformation._transform(n,i)},pointToLatLng:function(t,e){var n=this.scale(e),i=this.transformation.untransform(t,n);return this.projection.unproject(i)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)},getSize:function(t){var e=this.scale(t);return h.point(e,e)}},h.CRS.Simple=h.extend({},h.CRS,{projection:h.Projection.LonLat,transformation:new h.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),h.CRS.EPSG3857=h.extend({},h.CRS,{code:"EPSG:3857",projection:h.Projection.SphericalMercator,transformation:new h.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),n=6378137;return e.multiplyBy(n)}}),h.CRS.EPSG900913=h.extend({},h.CRS.EPSG3857,{code:"EPSG:900913"}),h.CRS.EPSG4326=h.extend({},h.CRS,{code:"EPSG:4326",projection:h.Projection.LonLat,transformation:new h.Transformation(1/360,.5,-1/360,.5)}),h.Map=h.Class.extend({includes:h.Mixin.Events,options:{crs:h.CRS.EPSG3857,fadeAnimation:h.DomUtil.TRANSITION&&!h.Browser.android23,trackResize:!0,markerZoomAnimation:h.DomUtil.TRANSITION&&h.Browser.any3d},initialize:function(t,e){e=h.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=h.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==r&&this.setView(h.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(e.layers)},setView:function(t,e){return e=e===r?this.getZoom():e,this._resetView(h.latLng(t),this._limitZoom(e)),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=this._limitZoom(t),this)},zoomIn:function(t,e){return this.setZoom(this._zoom+(t||1),e)},zoomOut:function(t,e){return this.setZoom(this._zoom-(t||1),e)},setZoomAround:function(t,e,n){var i=this.getZoomScale(e),o=this.getSize().divideBy(2),s=t instanceof h.Point?t:this.latLngToContainerPoint(t),a=s.subtract(o).multiplyBy(1-1/i),r=this.containerPointToLatLng(o.add(a));return this.setView(r,e,{zoom:n})},fitBounds:function(t,e){e=e||{},t=t.getBounds?t.getBounds():h.latLngBounds(t);var n=h.point(e.paddingTopLeft||e.padding||[0,0]),i=h.point(e.paddingBottomRight||e.padding||[0,0]),o=this.getBoundsZoom(t,!1,n.add(i));o=e.maxZoom?Math.min(e.maxZoom,o):o;var s=i.subtract(n).divideBy(2),a=this.project(t.getSouthWest(),o),r=this.project(t.getNorthEast(),o),l=this.unproject(a.add(r).divideBy(2).add(s),o);return this.setView(l,o,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(h.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=h.latLngBounds(t),this.options.maxBounds=t,t?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(t,e){var n=this.getCenter(),i=this._limitCenter(n,this._zoom,t);return n.equals(i)?this:this.panTo(i,e)},addLayer:function(t){var e=h.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&h.TileLayer&&t instanceof h.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(t),this)},removeLayer:function(t){var e=h.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&this.fire("layerremove",{layer:t}),this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&h.TileLayer&&t instanceof h.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(t){return!!t&&h.stamp(t)in this._layers},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},invalidateSize:function(t){if(!this._loaded)return this;t=h.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var n=this.getSize(),i=e.divideBy(2).round(),o=n.divideBy(2).round(),s=i.subtract(o);return s.x||s.y?(t.animate&&t.pan?this.panBy(s):(t.pan&&this._rawPanBy(s),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(h.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:n})):this},addHandler:function(t,e){if(!e)return this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(t){this._container._leaflet=r}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),n=this.unproject(t.getTopRight());return new h.LatLngBounds(e,n)},getMinZoom:function(){return this.options.minZoom===r?this._layersMinZoom===r?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===r?this._layersMaxZoom===r?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,n){t=h.latLngBounds(t);var i,o=this.getMinZoom()-(e?1:0),s=this.getMaxZoom(),a=this.getSize(),r=t.getNorthWest(),l=t.getSouthEast(),c=!0;n=h.point(n||[0,0]);do o++,i=this.project(l,o).subtract(this.project(r,o)).add(n),c=e?i.x<a.x||i.y<a.y:a.contains(i);while(c&&o<=s);return c&&e?null:e?o:o-1},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new h.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new h.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===r?this._zoom:e,this.options.crs.latLngToPoint(h.latLng(t),e)},unproject:function(t,e){return e=e===r?this._zoom:e,this.options.crs.pointToLatLng(h.point(t),e)},layerPointToLatLng:function(t){var e=h.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(h.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return h.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return h.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(h.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(h.latLng(t)))},mouseEventToContainerPoint:function(t){return h.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=h.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet)throw new Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;h.DomUtil.addClass(t,"leaflet-container"+(h.Browser.touch?" leaflet-touch":"")+(h.Browser.retina?" leaflet-retina":"")+(h.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var e=h.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(h.DomUtil.addClass(t.markerPane,e),h.DomUtil.addClass(t.shadowPane,e),h.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){
return h.DomUtil.create("div",t,e||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(t){t=t?h.Util.isArray(t)?t:[t]:[];for(var e=0,n=t.length;e<n;e++)this.addLayer(t[e])},_resetView:function(t,e,n,i){var o=this._zoom!==e;i||(this.fire("movestart"),o&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),n?this._initialTopLeftPoint._add(this._getMapPanePos()):h.DomUtil.setPosition(this._mapPane,new h.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var s=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!n}),s&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(o||i)&&this.fire("zoomend"),this.fire("moveend",{hard:!n})},_rawPanBy:function(t){h.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,n=-(1/0),i=this._getZoomSpan();for(t in this._zoomBoundLayers){var o=this._zoomBoundLayers[t];isNaN(o.options.minZoom)||(e=Math.min(e,o.options.minZoom)),isNaN(o.options.maxZoom)||(n=Math.max(n,o.options.maxZoom))}t===r?this._layersMaxZoom=this._layersMinZoom=r:(this._layersMaxZoom=n,this._layersMinZoom=e),i!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){if(h.DomEvent){t=t||"on",h.DomEvent[t](this._container,"click",this._onMouseClick,this);var e,n,i=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(e=0,n=i.length;e<n;e++)h.DomEvent[t](this._container,i[e],this._fireMouseEvent,this);this.options.trackResize&&h.DomEvent[t](s,"resize",this._onResize,this)}},_onResize:function(){h.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=h.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(t){!this._loaded||!t._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||h.DomEvent._skipped(t)||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded&&!h.DomEvent._skipped(t)){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&h.DomEvent.preventDefault(t);var n=this.mouseEventToContainerPoint(t),i=this.containerPointToLayerPoint(n),o=this.layerPointToLatLng(i);this.fire(e,{latlng:o,layerPoint:i,containerPoint:n,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_layerAdd:function(t){t.onAdd(this),this.fire("layeradd",{layer:t})},_getMapPanePos:function(){return h.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var n=this.getSize()._divideBy(2);return this.project(t,e)._subtract(n)._round()},_latLngToNewLayerPoint:function(t,e,n){var i=this._getNewTopLeftPoint(n,e).add(this._getMapPanePos());return this.project(t,e)._subtract(i)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,n){if(!n)return t;var i=this.project(t,e),o=this.getSize().divideBy(2),s=new h.Bounds(i.subtract(o),i.add(o)),a=this._getBoundsOffset(s,n,e);return this.unproject(i.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var n=this.getPixelBounds(),i=new h.Bounds(n.min.add(t),n.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,n){var i=this.project(e.getNorthWest(),n).subtract(t.min),o=this.project(e.getSouthEast(),n).subtract(t.max),s=this._rebound(i.x,-o.x),a=this._rebound(i.y,-o.y);return new h.Point(s,a)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),n=this.getMaxZoom();return Math.max(e,Math.min(n,t))}}),h.map=function(t,e){return new h.Map(t,e)},h.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(t){var e=h.LatLng.DEG_TO_RAD,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,t.lat),-n),o=this.R_MAJOR,s=this.R_MINOR,a=t.lng*e*o,r=i*e,l=s/o,c=Math.sqrt(1-l*l),u=c*Math.sin(r);u=Math.pow((1-u)/(1+u),.5*c);var d=Math.tan(.5*(.5*Math.PI-r))/u;return r=-o*Math.log(d),new h.Point(a,r)},unproject:function(t){for(var e,n=h.LatLng.RAD_TO_DEG,i=this.R_MAJOR,o=this.R_MINOR,s=t.x*n/i,a=o/i,r=Math.sqrt(1-a*a),l=Math.exp(-t.y/i),c=Math.PI/2-2*Math.atan(l),u=15,d=1e-7,p=u,m=.1;Math.abs(m)>d&&--p>0;)e=r*Math.sin(c),m=Math.PI/2-2*Math.atan(l*Math.pow((1-e)/(1+e),.5*r))-c,c+=m;return new h.LatLng(c*n,s)}},h.CRS.EPSG3395=h.extend({},h.CRS,{code:"EPSG:3395",projection:h.Projection.Mercator,transformation:function(){var t=h.Projection.Mercator,e=t.R_MAJOR,n=.5/(Math.PI*e);return new h.Transformation(n,.5,-n,.5)}()}),h.TileLayer=h.Class.extend({includes:h.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:h.Browser.mobile,updateWhenIdle:h.Browser.mobile},initialize:function(t,e){e=h.setOptions(this,e),e.detectRetina&&h.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=h.latLngBounds(e.bounds)),this._url=t;var n=this.options.subdomains;"string"==typeof n&&(this.options.subdomains=n.split(""))},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._initContainer(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=h.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==r&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var n,i,o,s=t.children,a=-e(1/0,-(1/0));for(i=0,o=s.length;i<o;i++)s[i]!==this._container&&(n=parseInt(s[i].style.zIndex,10),isNaN(n)||(a=e(a,n)));this.options.zIndex=this._container.style.zIndex=(isFinite(a)?a:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(h.Browser.ielt9)for(t in e)h.DomUtil.setOpacity(e[t],this.options.opacity);else h.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=h.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container";this._bgBuffer=h.DomUtil.create("div",e,this._container),this._tileContainer=h.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(t){for(var e in this._tiles)this.fire("tileunload",{tile:this._tiles[e]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var t=this._map,e=t.getZoom()+this.options.zoomOffset,n=this.options.maxNativeZoom,i=this.options.tileSize;return n&&e>n&&(i=Math.round(t.getZoomScale(e)/t.getZoomScale(n)*i)),i},_update:function(){if(this._map){var t=this._map,e=t.getPixelBounds(),n=t.getZoom(),i=this._getTileSize();if(!(n>this.options.maxZoom||n<this.options.minZoom)){var o=h.bounds(e.min.divideBy(i)._floor(),e.max.divideBy(i)._floor());this._addTilesFromCenterOut(o),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(o)}}},_addTilesFromCenterOut:function(t){var e,n,i,o=[],s=t.getCenter();for(e=t.min.y;e<=t.max.y;e++)for(n=t.min.x;n<=t.max.x;n++)i=new h.Point(n,e),this._tileShouldBeLoaded(i)&&o.push(i);var r=o.length;if(0!==r){o.sort(function(t,e){return t.distanceTo(s)-e.distanceTo(s)});var l=a.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=r,n=0;n<r;n++)this._addTile(o[n],l);this._tileContainer.appendChild(l)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var n=this._getWrapTileNum();if(e.noWrap&&(t.x<0||t.x>=n.x)||t.y<0||t.y>=n.y)return!1}if(e.bounds){var i=this._getTileSize(),o=t.multiplyBy(i),s=o.add([i,i]),a=this._map.unproject(o),r=this._map.unproject(s);if(e.continuousWorld||e.noWrap||(a=a.wrap(),r=r.wrap()),!e.bounds.intersects([a,r]))return!1}return!0},_removeOtherTiles:function(t){var e,n,i,o;for(o in this._tiles)e=o.split(":"),n=parseInt(e[0],10),i=parseInt(e[1],10),(n<t.min.x||n>t.max.x||i<t.min.y||i>t.max.y)&&this._removeTile(o)},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(h.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),h.Browser.android||(e.onload=null,e.src=h.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var n=this._getTilePos(t),i=this._getTile();h.DomUtil.setPosition(i,n,h.Browser.chrome),this._tiles[t.x+":"+t.y]=i,this._loadTile(i,t),i.parentNode!==this._tileContainer&&e.appendChild(i)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getTilePos:function(t){var e=this._map.getPixelOrigin(),n=this._getTileSize();return t.multiplyBy(n).subtract(e)},getTileUrl:function(t){return h.Util.template(this._url,h.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){var t=this._map.options.crs,e=t.getSize(this._map.getZoom());return e.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e.x+e.x)%e.x),this.options.tms&&(t.y=e.y-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=h.DomUtil.create("img","leaflet-tile");return t.style.width=t.style.height=this._getTileSize()+"px",t.galleryimg="no",t.onselectstart=t.onmousemove=h.Util.falseFn,h.Browser.ielt9&&this.options.opacity!==r&&h.DomUtil.setOpacity(t,this.options.opacity),h.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden"),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e),this.fire("tileloadstart",{tile:t,url:t.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&h.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(h.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==h.Util.emptyImageUrl&&(h.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),h.tileLayer=function(t,e){return new h.TileLayer(t,e)},h.TileLayer.WMS=h.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var n=h.extend({},this.defaultWmsParams),i=e.tileSize||this.options.tileSize;e.detectRetina&&h.Browser.retina?n.width=n.height=2*i:n.width=n.height=i;for(var o in e)this.options.hasOwnProperty(o)||"crs"===o||(n[o]=e[o]);this.wmsParams=n,h.setOptions(this,e)},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,h.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._map,n=this.options.tileSize,i=t.multiplyBy(n),o=i.add([n,n]),s=this._crs.project(e.unproject(i,t.z)),a=this._crs.project(e.unproject(o,t.z)),r=this._wmsVersion>=1.3&&this._crs===h.CRS.EPSG4326?[a.y,s.x,s.y,a.x].join(","):[s.x,a.y,a.x,s.y].join(","),l=h.Util.template(this._url,{s:this._getSubdomain(t)});return l+h.Util.getParamString(this.wmsParams,l,!0)+"&BBOX="+r},setParams:function(t,e){return h.extend(this.wmsParams,t),e||this.redraw(),this}}),h.tileLayer.wms=function(t,e){return new h.TileLayer.WMS(t,e)},h.TileLayer.Canvas=h.TileLayer.extend({options:{async:!1},initialize:function(t){h.setOptions(this,t)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var t in this._tiles)this._redrawTile(this._tiles[t]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTile:function(){var t=h.DomUtil.create("canvas","leaflet-tile");return t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=h.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),h.tileLayer.canvas=function(t){return new h.TileLayer.Canvas(t)},h.ImageOverlay=h.Class.extend({includes:h.Mixin.Events,options:{opacity:1},initialize:function(t,e,n){this._url=t,this._bounds=h.latLngBounds(e),h.setOptions(this,n)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&h.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},setUrl:function(t){this._url=t,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=h.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&h.Browser.any3d?h.DomUtil.addClass(this._image,"leaflet-zoom-animated"):h.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),h.extend(this._image,{galleryimg:"no",onselectstart:h.Util.falseFn,onmousemove:h.Util.falseFn,onload:h.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,n=this._image,i=e.getZoomScale(t.zoom),o=this._bounds.getNorthWest(),s=this._bounds.getSouthEast(),a=e._latLngToNewLayerPoint(o,t.zoom,t.center),r=e._latLngToNewLayerPoint(s,t.zoom,t.center)._subtract(a),l=a._add(r._multiplyBy(.5*(1-1/i)));n.style[h.DomUtil.TRANSFORM]=h.DomUtil.getTranslateString(l)+" scale("+i+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),n=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);h.DomUtil.setPosition(t,e),t.style.width=n.x+"px",t.style.height=n.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){h.DomUtil.setOpacity(this._image,this.options.opacity)}}),h.imageOverlay=function(t,e,n){return new h.ImageOverlay(t,e,n)},h.Icon=h.Class.extend({options:{className:""},initialize:function(t){h.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var n=this._getIconUrl(t);if(!n){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i;return i=e&&"IMG"===e.tagName?this._createImg(n,e):this._createImg(n),this._setIconStyles(i,t),i},_setIconStyles:function(t,e){var n,i=this.options,o=h.point(i[e+"Size"]);n="shadow"===e?h.point(i.shadowAnchor||i.iconAnchor):h.point(i.iconAnchor),!n&&o&&(n=o.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+i.className,n&&(t.style.marginLeft=-n.x+"px",t.style.marginTop=-n.y+"px"),o&&(t.style.width=o.x+"px",t.style.height=o.y+"px")},_createImg:function(t,e){return e=e||a.createElement("img"),e.src=t,e},_getIconUrl:function(t){return h.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),h.icon=function(t){return new h.Icon(t)},h.Icon.Default=h.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];h.Browser.retina&&"icon"===t&&(t+="-2x");var n=h.Icon.Default.imagePath;if(!n)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return n+"/marker-"+t+".png"}}),h.Icon.Default.imagePath=function(){var t,e,n,i,o,s=a.getElementsByTagName("script"),r=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,e=s.length;t<e;t++)if(n=s[t].src,i=n.match(r))return o=n.split(r)[0],(o?o+"/":"")+"images"}(),h.Marker=h.Class.extend({includes:h.Mixin.Events,options:{icon:new h.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){h.setOptions(this,e),this._latlng=h.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=h.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){return this._icon&&this._setPos(this._map.latLngToLayerPoint(this._latlng).round()),this},_initIcon:function(){var t=this.options,e=this._map,n=e.options.zoomAnimation&&e.options.markerZoomAnimation,i=n?"leaflet-zoom-animated":"leaflet-zoom-hide",o=t.icon.createIcon(this._icon),s=!1;o!==this._icon&&(this._icon&&this._removeIcon(),s=!0,t.title&&(o.title=t.title),t.alt&&(o.alt=t.alt)),h.DomUtil.addClass(o,i),t.keyboard&&(o.tabIndex="0"),this._icon=o,this._initInteraction(),t.riseOnHover&&h.DomEvent.on(o,"mouseover",this._bringToFront,this).on(o,"mouseout",this._resetZIndex,this);var a=t.icon.createShadow(this._shadow),r=!1;a!==this._shadow&&(this._removeShadow(),r=!0),a&&h.DomUtil.addClass(a,i),this._shadow=a,t.opacity<1&&this._updateOpacity();var l=this._map._panes;s&&l.markerPane.appendChild(this._icon),a&&r&&l.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&h.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(t){h.DomUtil.setPosition(this._icon,t),this._shadow&&h.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];h.DomUtil.addClass(t,"leaflet-clickable"),h.DomEvent.on(t,"click",this._onMouseClick,this),h.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var n=0;n<e.length;n++)h.DomEvent.on(t,e[n],this._fireMouseEvent,this);h.Handler.MarkerDrag&&(this.dragging=new h.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&h.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t,latlng:this._latlng})},_onKeyPress:function(t){13===t.keyCode&&this.fire("click",{originalEvent:t,latlng:this._latlng})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t,latlng:this._latlng}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&h.DomEvent.preventDefault(t),"mousedown"!==t.type?h.DomEvent.stopPropagation(t):h.DomEvent.preventDefault(t)},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){h.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&h.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),h.marker=function(t,e){return new h.Marker(t,e)},h.DivIcon=h.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:a.createElement("div"),n=this.options;return n.html!==!1?e.innerHTML=n.html:e.innerHTML="",n.bgPos&&(e.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(e,"icon"),e},createShadow:function(){return null}}),h.divIcon=function(t){return new h.DivIcon(t)},h.Map.mergeOptions({closePopupOnClick:!0}),h.Popup=h.Class.extend({includes:h.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(t,e){h.setOptions(this,t),this._source=e,this._animated=h.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(t){this._map=t,this._container||this._initLayout();var e=t.options.fadeAnimation;e&&h.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on(this._getEvents(),this),this.update(),e&&h.DomUtil.setOpacity(this._container,1),this.fire("open"),t.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),h.Util.falseFn(this._container.offsetWidth),t.off(this._getEvents(),this),t.options.fadeAnimation&&h.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),t.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=h.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t,e="leaflet-popup",n=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),i=this._container=h.DomUtil.create("div",n);this.options.closeButton&&(t=this._closeButton=h.DomUtil.create("a",e+"-close-button",i),t.href="#close",t.innerHTML="&#215;",h.DomEvent.disableClickPropagation(t),h.DomEvent.on(t,"click",this._onCloseButtonClick,this));var o=this._wrapper=h.DomUtil.create("div",e+"-content-wrapper",i);h.DomEvent.disableClickPropagation(o),this._contentNode=h.DomUtil.create("div",e+"-content",o),h.DomEvent.disableScrollPropagation(this._contentNode),h.DomEvent.on(o,"contextmenu",h.DomEvent.stopPropagation),this._tipContainer=h.DomUtil.create("div",e+"-tip-container",i),this._tip=h.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var n=t.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),e.width=n+1+"px",e.whiteSpace="",e.height="";var i=t.offsetHeight,o=this.options.maxHeight,s="leaflet-popup-scrolled";o&&i>o?(e.height=o+"px",h.DomUtil.addClass(t,s)):h.DomUtil.removeClass(t,s),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,n=h.point(this.options.offset);e&&h.DomUtil.setPosition(this._container,t),this._containerBottom=-n.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+n.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);h.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,n=this._containerWidth,i=new h.Point(this._containerLeft,-e-this._containerBottom);this._animated&&i._add(h.DomUtil.getPosition(this._container));var o=t.layerPointToContainerPoint(i),s=h.point(this.options.autoPanPadding),a=h.point(this.options.autoPanPaddingTopLeft||s),r=h.point(this.options.autoPanPaddingBottomRight||s),l=t.getSize(),c=0,u=0;o.x+n+r.x>l.x&&(c=o.x+n-l.x+r.x),o.x-c-a.x<0&&(c=o.x-a.x),o.y+e+r.y>l.y&&(u=o.y+e-l.y+r.y),o.y-u-a.y<0&&(u=o.y-a.y),(c||u)&&t.fire("autopanstart").panBy([c,u])}},_onCloseButtonClick:function(t){this._close(),h.DomEvent.stop(t)}}),h.popup=function(t,e){return new h.Popup(t,e)},h.Map.include({openPopup:function(t,e,n){if(this.closePopup(),!(t instanceof h.Popup)){var i=t;t=new h.Popup(n).setLatLng(e).setContent(i)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&(this.removeLayer(t),t._isOpen=!1),this}}),h.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(t,e){var n=h.point(this.options.icon.options.popupAnchor||[0,0]);return n=n.add(h.Popup.prototype.options.offset),e&&e.offset&&(n=n.add(e.offset)),e=h.extend({offset:n},e),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),t instanceof h.Popup?(h.setOptions(t,e),this._popup=t,t._source=this):this._popup=new h.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),h.LayerGroup=h.Class.extend({initialize:function(t){this._layers={};var e,n;if(t)for(e=0,n=t.length;e<n;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,n,i=Array.prototype.slice.call(arguments,1);for(e in this._layers)n=this._layers[e],n[t]&&n[t].apply(n,i);return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return h.stamp(t)}}),h.layerGroup=function(t){return new h.LayerGroup(t)},h.FeatureGroup=h.LayerGroup.extend({includes:h.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(t){return this.hasLayer(t)?this:("on"in t&&t.on(h.FeatureGroup.EVENTS,this._propagateEvent,this),h.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),"off"in t&&t.off(h.FeatureGroup.EVENTS,this._propagateEvent,this),h.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),
this.fire("layerremove",{layer:t})):this},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},openPopup:function(t){for(var e in this._layers){this._layers[e].openPopup(t);break}return this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new h.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof h.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t=h.extend({layer:t.target,target:this},t),this.fire(t.type,t)}}),h.featureGroup=function(t){return new h.FeatureGroup(t)},h.Path=h.Class.extend({includes:[h.Mixin.Events],statics:{CLIP_PADDING:function(){var t=h.Browser.mobile?1280:2e3,e=(t/Math.max(s.outerWidth,s.outerHeight)-1)/2;return Math.max(0,Math.min(.5,e))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){h.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,h.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return h.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),h.Map.include({_updatePathViewport:function(){var t=h.Path.CLIP_PADDING,e=this.getSize(),n=h.DomUtil.getPosition(this._mapPane),i=n.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),o=i.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new h.Bounds(i,o)}}),h.Path.SVG_NS="http://www.w3.org/2000/svg",h.Browser.svg=!(!a.createElementNS||!a.createElementNS(h.Path.SVG_NS,"svg").createSVGRect),h.Path=h.Path.extend({statics:{SVG:h.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,n=t.firstChild;return e&&n!==e&&t.insertBefore(e,n),this},getPathString:function(){},_createElement:function(t){return a.createElementNS(h.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&h.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){!h.Browser.svg&&h.Browser.vml||h.DomUtil.addClass(this._path,"leaflet-clickable"),h.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;e<t.length;e++)h.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this._map&&this.hasEventListeners(t.type)){var e=this._map,n=e.mouseEventToContainerPoint(t),i=e.containerPointToLayerPoint(n),o=e.layerPointToLatLng(i);this.fire(t.type,{latlng:o,layerPoint:i,containerPoint:n,originalEvent:t}),"contextmenu"===t.type&&h.DomEvent.preventDefault(t),"mousemove"!==t.type&&h.DomEvent.stopPropagation(t)}}}),h.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=h.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&h.Browser.any3d?(h.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):h.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),n=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[h.DomUtil.TRANSFORM]=h.DomUtil.getTranslateString(n)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,n=t.max,i=n.x-e.x,o=n.y-e.y,s=this._pathRoot,a=this._panes.overlayPane;h.Browser.mobileWebkit&&a.removeChild(s),h.DomUtil.setPosition(s,e),s.setAttribute("width",i),s.setAttribute("height",o),s.setAttribute("viewBox",[e.x,e.y,i,o].join(" ")),h.Browser.mobileWebkit&&a.appendChild(s)}}}),h.Path.include({bindPopup:function(t,e){return t instanceof h.Popup?this._popup=t:(this._popup&&!e||(this._popup=new h.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),h.Browser.vml=!h.Browser.svg&&function(){try{var t=a.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}(),h.Path=h.Browser.svg||!h.Browser.vml?h.Path:h.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return a.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return a.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return a.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");h.DomUtil.addClass(t,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&h.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,n=this.options,i=this._container;i.stroked=n.stroke,i.filled=n.fill,n.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",i.appendChild(t)),t.weight=n.weight+"px",t.color=n.color,t.opacity=n.opacity,n.dashArray?t.dashStyle=h.Util.isArray(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):t.dashStyle="",n.lineCap&&(t.endcap=n.lineCap.replace("butt","flat")),n.lineJoin&&(t.joinstyle=n.lineJoin)):t&&(i.removeChild(t),this._stroke=null),n.fill?(e||(e=this._fill=this._createElement("fill"),i.appendChild(e)),e.color=n.fillColor||n.color,e.opacity=n.fillOpacity):e&&(i.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),h.Map.include(h.Browser.svg||!h.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=a.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),h.Browser.canvas=function(){return!!a.createElement("canvas").getContext}(),h.Path=h.Path.SVG&&!s.L_PREFER_CANVAS||!h.Browser.canvas?h.Path:h.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return h.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!h.Path._updateRequest&&(h.Path._updateRequest=h.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){h.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color),t.lineCap&&(this._ctx.lineCap=t.lineCap),t.lineJoin&&(this._ctx.lineJoin=t.lineJoin)},_drawPath:function(){var t,e,n,i,o,s;for(this._ctx.beginPath(),t=0,n=this._parts.length;t<n;t++){for(e=0,i=this._parts[t].length;e<i;e++)o=this._parts[t][e],s=(0===e?"move":"line")+"To",this._ctx[s](o.x,o.y);this instanceof h.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill(e.fillRule||"evenodd")),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click dblclick contextmenu",this._fireMouseEvent,this))},_fireMouseEvent:function(t){this._containsPoint(t.layerPoint)&&this.fire(t.type,t)},_onMouseMove:function(t){this._map&&!this._map._animatingZoom&&(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),h.Map.include(h.Path.SVG&&!s.L_PREFER_CANVAS||!h.Browser.canvas?{}:{_initPathRoot:function(){var t,e=this._pathRoot;e||(e=this._pathRoot=a.createElement("canvas"),e.style.position="absolute",t=this._canvasCtx=e.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(e),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,n=t.max.subtract(e),i=this._pathRoot;h.DomUtil.setPosition(i,e),i.width=n.x,i.height=n.y,i.getContext("2d").translate(-e.x,-e.y)}}}),h.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var n=e*e;return t=this._reducePoints(t,n),t=this._simplifyDP(t,n)},pointToSegmentDistance:function(t,e,n){return Math.sqrt(this._sqClosestPointOnSegment(t,e,n,!0))},closestPointOnSegment:function(t,e,n){return this._sqClosestPointOnSegment(t,e,n)},_simplifyDP:function(t,e){var n=t.length,i=typeof Uint8Array!=r+""?Uint8Array:Array,o=new i(n);o[0]=o[n-1]=1,this._simplifyDPStep(t,o,e,0,n-1);var s,a=[];for(s=0;s<n;s++)o[s]&&a.push(t[s]);return a},_simplifyDPStep:function(t,e,n,i,o){var s,a,r,l=0;for(a=i+1;a<=o-1;a++)r=this._sqClosestPointOnSegment(t[a],t[i],t[o],!0),r>l&&(s=a,l=r);l>n&&(e[s]=1,this._simplifyDPStep(t,e,n,i,s),this._simplifyDPStep(t,e,n,s,o))},_reducePoints:function(t,e){for(var n=[t[0]],i=1,o=0,s=t.length;i<s;i++)this._sqDist(t[i],t[o])>e&&(n.push(t[i]),o=i);return o<s-1&&n.push(t[s-1]),n},clipSegment:function(t,e,n,i){var o,s,a,r=i?this._lastCode:this._getBitCode(t,n),l=this._getBitCode(e,n);for(this._lastCode=l;;){if(!(r|l))return[t,e];if(r&l)return!1;o=r||l,s=this._getEdgeIntersection(t,e,o,n),a=this._getBitCode(s,n),o===r?(t=s,r=a):(e=s,l=a)}},_getEdgeIntersection:function(t,e,n,i){var o=e.x-t.x,s=e.y-t.y,a=i.min,r=i.max;return 8&n?new h.Point(t.x+o*(r.y-t.y)/s,r.y):4&n?new h.Point(t.x+o*(a.y-t.y)/s,a.y):2&n?new h.Point(r.x,t.y+s*(r.x-t.x)/o):1&n?new h.Point(a.x,t.y+s*(a.x-t.x)/o):void 0},_getBitCode:function(t,e){var n=0;return t.x<e.min.x?n|=1:t.x>e.max.x&&(n|=2),t.y<e.min.y?n|=4:t.y>e.max.y&&(n|=8),n},_sqDist:function(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i},_sqClosestPointOnSegment:function(t,e,n,i){var o,s=e.x,a=e.y,r=n.x-s,l=n.y-a,c=r*r+l*l;return c>0&&(o=((t.x-s)*r+(t.y-a)*l)/c,o>1?(s=n.x,a=n.y):o>0&&(s+=r*o,a+=l*o)),r=t.x-s,l=t.y-a,i?r*r+l*l:new h.Point(s,a)}},h.Polyline=h.Path.extend({initialize:function(t,e){h.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;t<e;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,n="";t<e;t++)n+=this._getPathPartStr(this._parts[t]);return n},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(h.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,n,i=1/0,o=this._parts,s=null,a=0,r=o.length;a<r;a++)for(var l=o[a],c=1,u=l.length;c<u;c++){e=l[c-1],n=l[c];var d=h.LineUtil._sqClosestPointOnSegment(t,e,n,!0);d<i&&(i=d,s=h.LineUtil._sqClosestPointOnSegment(t,e,n))}return s&&(s.distance=Math.sqrt(i)),s},getBounds:function(){return new h.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var n,i,o=e?t:[];for(n=0,i=t.length;n<i;n++){if(h.Util.isArray(t[n])&&"number"!=typeof t[n][0])return;o[n]=h.latLng(t[n])}return o},_initEvents:function(){h.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,n=h.Path.VML,i=0,o=t.length,s="";i<o;i++)e=t[i],n&&e._round(),s+=(i?"L":"M")+e.x+" "+e.y;return s},_clipPoints:function(){var t,e,n,i=this._originalPoints,o=i.length;if(this.options.noClip)return void(this._parts=[i]);this._parts=[];var s=this._parts,a=this._map._pathViewport,r=h.LineUtil;for(t=0,e=0;t<o-1;t++)n=r.clipSegment(i[t],i[t+1],a,t),n&&(s[e]=s[e]||[],s[e].push(n[0]),n[1]===i[t+1]&&t!==o-2||(s[e].push(n[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=h.LineUtil,n=0,i=t.length;n<i;n++)t[n]=e.simplify(t[n],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),h.Path.prototype._updatePath.call(this))}}),h.polyline=function(t,e){return new h.Polyline(t,e)},h.PolyUtil={},h.PolyUtil.clipPolygon=function(t,e){var n,i,o,s,a,r,l,c,u,d=[1,4,2,8],p=h.LineUtil;for(i=0,l=t.length;i<l;i++)t[i]._code=p._getBitCode(t[i],e);for(s=0;s<4;s++){for(c=d[s],n=[],i=0,l=t.length,o=l-1;i<l;o=i++)a=t[i],r=t[o],a._code&c?r._code&c||(u=p._getEdgeIntersection(r,a,c,e),u._code=p._getBitCode(u,e),n.push(u)):(r._code&c&&(u=p._getEdgeIntersection(r,a,c,e),u._code=p._getBitCode(u,e),n.push(u)),n.push(a));t=n}return t},h.Polygon=h.Polyline.extend({options:{fill:!0},initialize:function(t,e){h.Polyline.prototype.initialize.call(this,t,e),this._initWithHoles(t)},_initWithHoles:function(t){var e,n,i;if(t&&h.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),e=0,n=this._holes.length;e<n;e++)i=this._holes[e]=this._convertLatLngs(this._holes[e]),i[0].equals(i[i.length-1])&&i.pop();t=this._latlngs,t.length>=2&&t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(h.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,n,i;for(t=0,n=this._holes.length;t<n;t++)for(this._holePoints[t]=[],e=0,i=this._holes[t].length;e<i;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},setLatLngs:function(t){return t&&h.Util.isArray(t[0])&&"number"!=typeof t[0][0]?(this._initWithHoles(t),this.redraw()):h.Polyline.prototype.setLatLngs.call(this,t)},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var n=0,i=this._parts.length;n<i;n++){var o=h.PolyUtil.clipPolygon(this._parts[n],this._map._pathViewport);o.length&&e.push(o)}this._parts=e}},_getPathPartStr:function(t){var e=h.Polyline.prototype._getPathPartStr.call(this,t);return e+(h.Browser.svg?"z":"x")}}),h.polygon=function(t,e){return new h.Polygon(t,e)},function(){function t(t){return h.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var n=0,i=e.length;for(this.eachLayer(function(t){n<i?t.setLatLngs(e[n++]):this.removeLayer(t)},this);n<i;)this.addLayer(new t(e[n++],this._options));return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t.push(e.getLatLngs())}),t}})}h.MultiPolyline=t(h.Polyline),h.MultiPolygon=t(h.Polygon),h.multiPolyline=function(t,e){return new h.MultiPolyline(t,e)},h.multiPolygon=function(t,e){return new h.MultiPolygon(t,e)}}(),h.Rectangle=h.Polygon.extend({initialize:function(t,e){h.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=h.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),h.rectangle=function(t,e){return new h.Rectangle(t,e)},h.Circle=h.Path.extend({initialize:function(t,e,n){h.Path.prototype.initialize.call(this,n),this._latlng=h.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=h.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=this._latlng,n=this._map.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this._map.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-n.x,1)},getBounds:function(){var t=this._getLngRadius(),e=this._mRadius/40075017*360,n=this._latlng;return new h.LatLngBounds([n.lat-e,n.lng-t],[n.lat+e,n.lng+t])},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":h.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(h.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,n=this._point;return n.x-e>t.max.x||n.y-e>t.max.y||n.x+e<t.min.x||n.y+e<t.min.y}}),h.circle=function(t,e,n){return new h.Circle(t,e,n)},h.CircleMarker=h.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){h.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){h.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(t){return h.Circle.prototype.setLatLng.call(this,t),this._popup&&this._popup._isOpen&&this._popup.setLatLng(t),this},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius}}),h.circleMarker=function(t,e){return new h.CircleMarker(t,e)},h.Polyline.include(h.Path.CANVAS?{_containsPoint:function(t,e){var n,i,o,s,a,r,l,c=this.options.weight/2;for(h.Browser.touch&&(c+=10),n=0,s=this._parts.length;n<s;n++)for(l=this._parts[n],i=0,a=l.length,o=a-1;i<a;o=i++)if((e||0!==i)&&(r=h.LineUtil.pointToSegmentDistance(t,l[o],l[i]),r<=c))return!0;return!1}}:{}),h.Polygon.include(h.Path.CANVAS?{_containsPoint:function(t){var e,n,i,o,s,a,r,l,c=!1;if(h.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(o=0,r=this._parts.length;o<r;o++)for(e=this._parts[o],s=0,l=e.length,a=l-1;s<l;a=s++)n=e[s],i=e[a],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(c=!c);return c}}:{}),h.Circle.include(h.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,n=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+n}}:{}),h.CircleMarker.include(h.Path.CANVAS?{_updateStyle:function(){h.Path.prototype._updateStyle.call(this)}}:{}),h.GeoJSON=h.FeatureGroup.extend({initialize:function(t,e){h.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,n,i,o=h.Util.isArray(t)?t:t.features;if(o){for(e=0,n=o.length;e<n;e++)i=o[e],(i.geometries||i.geometry||i.features||i.coordinates)&&this.addData(o[e]);return this}var s=this.options;if(!s.filter||s.filter(t)){var a=h.GeoJSON.geometryToLayer(t,s.pointToLayer,s.coordsToLatLng,s);return a.feature=h.GeoJSON.asFeature(t),a.defaultOptions=a.options,this.resetStyle(a),s.onEachFeature&&s.onEachFeature(t,a),this.addLayer(a)}},resetStyle:function(t){var e=this.options.style;e&&(h.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),h.extend(h.GeoJSON,{geometryToLayer:function(t,e,n,i){var o,s,a,r,l="Feature"===t.type?t.geometry:t,c=l.coordinates,u=[];switch(n=n||this.coordsToLatLng,l.type){case"Point":return o=n(c),e?e(t,o):new h.Marker(o);case"MultiPoint":for(a=0,r=c.length;a<r;a++)o=n(c[a]),u.push(e?e(t,o):new h.Marker(o));return new h.FeatureGroup(u);case"LineString":return s=this.coordsToLatLngs(c,0,n),new h.Polyline(s,i);case"Polygon":if(2===c.length&&!c[1].length)throw new Error("Invalid GeoJSON object.");return s=this.coordsToLatLngs(c,1,n),new h.Polygon(s,i);case"MultiLineString":return s=this.coordsToLatLngs(c,1,n),new h.MultiPolyline(s,i);case"MultiPolygon":return s=this.coordsToLatLngs(c,2,n),new h.MultiPolygon(s,i);case"GeometryCollection":for(a=0,r=l.geometries.length;a<r;a++)u.push(this.geometryToLayer({geometry:l.geometries[a],type:"Feature",properties:t.properties},e,n,i));return new h.FeatureGroup(u);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new h.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,n){var i,o,s,a=[];for(o=0,s=t.length;o<s;o++)i=e?this.coordsToLatLngs(t[o],e-1,n):(n||this.coordsToLatLng)(t[o]),a.push(i);return a},latLngToCoords:function(t){var e=[t.lng,t.lat];return t.alt!==r&&e.push(t.alt),e},latLngsToCoords:function(t){for(var e=[],n=0,i=t.length;n<i;n++)e.push(h.GeoJSON.latLngToCoords(t[n]));return e},getFeature:function(t,e){return t.feature?h.extend({},t.feature,{geometry:e}):h.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var u={toGeoJSON:function(){return h.GeoJSON.getFeature(this,{type:"Point",coordinates:h.GeoJSON.latLngToCoords(this.getLatLng())})}};h.Marker.include(u),h.Circle.include(u),h.CircleMarker.include(u),h.Polyline.include({toGeoJSON:function(){return h.GeoJSON.getFeature(this,{type:"LineString",coordinates:h.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),h.Polygon.include({toGeoJSON:function(){var t,e,n,i=[h.GeoJSON.latLngsToCoords(this.getLatLngs())];if(i[0].push(i[0][0]),this._holes)for(t=0,e=this._holes.length;t<e;t++)n=h.GeoJSON.latLngsToCoords(this._holes[t]),n.push(n[0]),i.push(n);return h.GeoJSON.getFeature(this,{type:"Polygon",coordinates:i})}}),function(){function t(t){return function(){var e=[];return this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)}),h.GeoJSON.getFeature(this,{type:t,coordinates:e})}}h.MultiPolyline.include({toGeoJSON:t("MultiLineString")}),h.MultiPolygon.include({toGeoJSON:t("MultiPolygon")}),h.LayerGroup.include({toGeoJSON:function(){var e,n=this.feature&&this.feature.geometry,i=[];if(n&&"MultiPoint"===n.type)return t("MultiPoint").call(this);var o=n&&"GeometryCollection"===n.type;return this.eachLayer(function(t){t.toGeoJSON&&(e=t.toGeoJSON(),i.push(o?e.geometry:h.GeoJSON.asFeature(e)))}),o?h.GeoJSON.getFeature(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}})}(),h.geoJson=function(t,e){return new h.GeoJSON(t,e)},h.DomEvent={addListener:function(t,e,n,i){var o,s,a,r=h.stamp(n),l="_leaflet_"+e+r;return t[l]?this:(o=function(e){return n.call(i||t,e||h.DomEvent._getEvent())},h.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(t,e,o,r):(h.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,o,r),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",o,!1),t.addEventListener(e,o,!1)):"mouseenter"===e||"mouseleave"===e?(s=o,a="mouseenter"===e?"mouseover":"mouseout",o=function(e){if(h.DomEvent._checkMouse(t,e))return s(e)},t.addEventListener(a,o,!1)):"click"===e&&h.Browser.android?(s=o,o=function(t){return h.DomEvent._filterClick(t,s)},t.addEventListener(e,o,!1)):t.addEventListener(e,o,!1):"attachEvent"in t&&t.attachEvent("on"+e,o),t[l]=o,this))},removeListener:function(t,e,n){var i=h.stamp(n),o="_leaflet_"+e+i,s=t[o];return s?(h.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,i):h.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,i):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",s,!1),t.removeEventListener(e,s,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",s,!1):t.removeEventListener(e,s,!1):"detachEvent"in t&&t.detachEvent("on"+e,s),t[o]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,h.DomEvent._skipped(t),this},disableScrollPropagation:function(t){var e=h.DomEvent.stopPropagation;return h.DomEvent.on(t,"mousewheel",e).on(t,"MozMousePixelScroll",e)},disableClickPropagation:function(t){for(var e=h.DomEvent.stopPropagation,n=h.Draggable.START.length-1;n>=0;n--)h.DomEvent.on(t,h.Draggable.START[n],e);return h.DomEvent.on(t,"click",h.DomEvent._fakeStop).on(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return h.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new h.Point(t.clientX,t.clientY);var n=e.getBoundingClientRect();return new h.Point(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_skipEvents:{},_fakeStop:function(t){h.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_checkMouse:function(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch(t){return!1}return n!==t},_getEvent:function(){var t=s.event;if(!t)for(var e=arguments.callee.caller;e&&(t=e.arguments[0],!t||s.Event!==t.constructor);)e=e.caller;return t},_filterClick:function(t,e){var n=t.timeStamp||t.originalEvent.timeStamp,i=h.DomEvent._lastClick&&n-h.DomEvent._lastClick;return i&&i>100&&i<500||t.target._simulatedClick&&!t._simulated?void h.DomEvent.stop(t):(h.DomEvent._lastClick=n,e(t))}},h.DomEvent.on=h.DomEvent.addListener,h.DomEvent.off=h.DomEvent.removeListener,h.Draggable=h.Class.extend({includes:h.Mixin.Events,statics:{START:h.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e){this._element=t,this._dragStartTarget=e||t},enable:function(){if(!this._enabled){for(var t=h.Draggable.START.length-1;t>=0;t--)h.DomEvent.on(this._dragStartTarget,h.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=h.Draggable.START.length-1;t>=0;t--)h.DomEvent.off(this._dragStartTarget,h.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(this._moved=!1,!t.shiftKey&&(1===t.which||1===t.button||t.touches)&&(h.DomEvent.stopPropagation(t),!h.Draggable._disabled&&(h.DomUtil.disableImageDrag(),h.DomUtil.disableTextSelection(),!this._moving))){var e=t.touches?t.touches[0]:t;this._startPoint=new h.Point(e.clientX,e.clientY),this._startPos=this._newPos=h.DomUtil.getPosition(this._element),h.DomEvent.on(a,h.Draggable.MOVE[t.type],this._onMove,this).on(a,h.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new h.Point(e.clientX,e.clientY),i=n.subtract(this._startPoint);(i.x||i.y)&&(h.Browser.touch&&Math.abs(i.x)+Math.abs(i.y)<3||(h.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=h.DomUtil.getPosition(this._element).subtract(i),h.DomUtil.addClass(a.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,h.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,h.Util.cancelAnimFrame(this._animRequest),this._animRequest=h.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),h.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){h.DomUtil.removeClass(a.body,"leaflet-dragging"),this._lastTarget&&(h.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in h.Draggable.MOVE)h.DomEvent.off(a,h.Draggable.MOVE[t],this._onMove).off(a,h.Draggable.END[t],this._onUp);h.DomUtil.enableImageDrag(),h.DomUtil.enableTextSelection(),this._moved&&this._moving&&(h.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),h.Handler=h.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),h.Map.mergeOptions({dragging:!0,inertia:!h.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:h.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1
}),h.Map.Drag=h.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new h.Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this),t.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),n=this._initialWorldOffset,i=this._draggable._newPos.x,o=(i-e+n)%t+e-n,s=(i+e+n)%t-e-n,a=Math.abs(o+n)<Math.abs(s+n)?o:s;this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,n=e.options,i=+new Date-this._lastTime,o=!n.inertia||i>n.inertiaThreshold||!this._positions[0];if(e.fire("dragend",t),o)e.fire("moveend");else{var s=this._lastPos.subtract(this._positions[0]),a=(this._lastTime+i-this._times[0])/1e3,r=n.easeLinearity,l=s.multiplyBy(r/a),c=l.distanceTo([0,0]),u=Math.min(n.inertiaMaxSpeed,c),d=l.multiplyBy(u/c),p=u/(n.inertiaDeceleration*r),m=d.multiplyBy(-p/2).round();m.x&&m.y?(m=e._limitOffset(m,e.options.maxBounds),h.Util.requestAnimFrame(function(){e.panBy(m,{duration:p,easeLinearity:r,noMoveStart:!0})})):e.fire("moveend")}}}),h.Map.addInitHook("addHandler","dragging",h.Map.Drag),h.Map.mergeOptions({doubleClickZoom:!0}),h.Map.DoubleClickZoom=h.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,n=e.getZoom()+(t.originalEvent.shiftKey?-1:1);"center"===e.options.doubleClickZoom?e.setZoom(n):e.setZoomAround(t.containerPoint,n)}}),h.Map.addInitHook("addHandler","doubleClickZoom",h.Map.DoubleClickZoom),h.Map.mergeOptions({scrollWheelZoom:!0}),h.Map.ScrollWheelZoom=h.Handler.extend({addHooks:function(){h.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),h.DomEvent.on(this._map._container,"MozMousePixelScroll",h.DomEvent.preventDefault),this._delta=0},removeHooks:function(){h.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),h.DomEvent.off(this._map._container,"MozMousePixelScroll",h.DomEvent.preventDefault)},_onWheelScroll:function(t){var e=h.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var n=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(h.bind(this._performZoom,this),n),h.DomEvent.preventDefault(t),h.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,n=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(n+e)-n,this._delta=0,this._startTime=null,e&&("center"===t.options.scrollWheelZoom?t.setZoom(n+e):t.setZoomAround(this._lastMousePos,n+e))}}),h.Map.addInitHook("addHandler","scrollWheelZoom",h.Map.ScrollWheelZoom),h.extend(h.DomEvent,{_touchstart:h.Browser.msPointer?"MSPointerDown":h.Browser.pointer?"pointerdown":"touchstart",_touchend:h.Browser.msPointer?"MSPointerUp":h.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,e,n){function i(t){var e;if(h.Browser.pointer?(m.push(t.pointerId),e=m.length):e=t.touches.length,!(e>1)){var n=Date.now(),i=n-(s||n);r=t.touches?t.touches[0]:t,l=i>0&&i<=c,s=n}}function o(t){if(h.Browser.pointer){var n=m.indexOf(t.pointerId);if(n===-1)return;m.splice(n,1)}if(l){if(h.Browser.pointer){var i,o={};for(var a in r)i=r[a],"function"==typeof i?o[a]=i.bind(r):o[a]=i;r=o}r.type="dblclick",e(r),s=null}}var s,r,l=!1,c=250,u="_leaflet_",d=this._touchstart,p=this._touchend,m=[];t[u+d+n]=i,t[u+p+n]=o;var _=h.Browser.pointer?a.documentElement:t;return t.addEventListener(d,i,!1),_.addEventListener(p,o,!1),h.Browser.pointer&&_.addEventListener(h.DomEvent.POINTER_CANCEL,o,!1),this},removeDoubleTapListener:function(t,e){var n="_leaflet_";return t.removeEventListener(this._touchstart,t[n+this._touchstart+e],!1),(h.Browser.pointer?a.documentElement:t).removeEventListener(this._touchend,t[n+this._touchend+e],!1),h.Browser.pointer&&a.documentElement.removeEventListener(h.DomEvent.POINTER_CANCEL,t[n+this._touchend+e],!1),this}}),h.extend(h.DomEvent,{POINTER_DOWN:h.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:h.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:h.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:h.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(t,e,n,i){switch(e){case"touchstart":return this.addPointerListenerStart(t,e,n,i);case"touchend":return this.addPointerListenerEnd(t,e,n,i);case"touchmove":return this.addPointerListenerMove(t,e,n,i);default:throw"Unknown touch event type"}},addPointerListenerStart:function(t,e,n,i){var o="_leaflet_",s=this._pointers,r=function(t){"mouse"!==t.pointerType&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&h.DomEvent.preventDefault(t);for(var e=!1,i=0;i<s.length;i++)if(s[i].pointerId===t.pointerId){e=!0;break}e||s.push(t),t.touches=s.slice(),t.changedTouches=[t],n(t)};if(t[o+"touchstart"+i]=r,t.addEventListener(this.POINTER_DOWN,r,!1),!this._pointerDocumentListener){var l=function(t){for(var e=0;e<s.length;e++)if(s[e].pointerId===t.pointerId){s.splice(e,1);break}};a.documentElement.addEventListener(this.POINTER_UP,l,!1),a.documentElement.addEventListener(this.POINTER_CANCEL,l,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(t,e,n,i){function o(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons){for(var e=0;e<a.length;e++)if(a[e].pointerId===t.pointerId){a[e]=t;break}t.touches=a.slice(),t.changedTouches=[t],n(t)}}var s="_leaflet_",a=this._pointers;return t[s+"touchmove"+i]=o,t.addEventListener(this.POINTER_MOVE,o,!1),this},addPointerListenerEnd:function(t,e,n,i){var o="_leaflet_",s=this._pointers,a=function(t){for(var e=0;e<s.length;e++)if(s[e].pointerId===t.pointerId){s.splice(e,1);break}t.touches=s.slice(),t.changedTouches=[t],n(t)};return t[o+"touchend"+i]=a,t.addEventListener(this.POINTER_UP,a,!1),t.addEventListener(this.POINTER_CANCEL,a,!1),this},removePointerListener:function(t,e,n){var i="_leaflet_",o=t[i+e+n];switch(e){case"touchstart":t.removeEventListener(this.POINTER_DOWN,o,!1);break;case"touchmove":t.removeEventListener(this.POINTER_MOVE,o,!1);break;case"touchend":t.removeEventListener(this.POINTER_UP,o,!1),t.removeEventListener(this.POINTER_CANCEL,o,!1)}return this}}),h.Map.mergeOptions({touchZoom:h.Browser.touch&&!h.Browser.android23,bounceAtZoomLimits:!0}),h.Map.TouchZoom=h.Handler.extend({addHooks:function(){h.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){h.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var n=e.mouseEventToLayerPoint(t.touches[0]),i=e.mouseEventToLayerPoint(t.touches[1]),o=e._getCenterLayerPoint();this._startCenter=n.add(i)._divideBy(2),this._startDist=n.distanceTo(i),this._moved=!1,this._zooming=!0,this._centerOffset=o.subtract(this._startCenter),e._panAnim&&e._panAnim.stop(),h.DomEvent.on(a,"touchmove",this._onTouchMove,this).on(a,"touchend",this._onTouchEnd,this),h.DomEvent.preventDefault(t)}},_onTouchMove:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&this._zooming){var n=e.mouseEventToLayerPoint(t.touches[0]),i=e.mouseEventToLayerPoint(t.touches[1]);this._scale=n.distanceTo(i)/this._startDist,this._delta=n._add(i)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(!e.options.bounceAtZoomLimits&&(e.getZoom()===e.getMinZoom()&&this._scale<1||e.getZoom()===e.getMaxZoom()&&this._scale>1)||(this._moved||(h.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),h.Util.cancelAnimFrame(this._animRequest),this._animRequest=h.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),h.DomEvent.preventDefault(t)))}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),n=t.layerPointToLatLng(e),i=t.getScaleZoom(this._scale);t._animateZoom(n,i,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var t=this._map;this._zooming=!1,h.DomUtil.removeClass(t._mapPane,"leaflet-touching"),h.Util.cancelAnimFrame(this._animRequest),h.DomEvent.off(a,"touchmove",this._onTouchMove).off(a,"touchend",this._onTouchEnd);var e=this._getScaleOrigin(),n=t.layerPointToLatLng(e),i=t.getZoom(),o=t.getScaleZoom(this._scale)-i,s=o>0?Math.ceil(o):Math.floor(o),r=t._limitZoom(i+s),l=t.getZoomScale(r)/this._scale;t._animateZoom(n,r,e,l)},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),h.Map.addInitHook("addHandler","touchZoom",h.Map.TouchZoom),h.Map.mergeOptions({tap:!0,tapTolerance:15}),h.Map.Tap=h.Handler.extend({addHooks:function(){h.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){h.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(h.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var e=t.touches[0],n=e.target;this._startPos=this._newPos=new h.Point(e.clientX,e.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&h.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(h.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))},this),1e3),h.DomEvent.on(a,"touchmove",this._onMove,this).on(a,"touchend",this._onUp,this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),h.DomEvent.off(a,"touchmove",this._onMove,this).off(a,"touchend",this._onUp,this),this._fireClick&&t&&t.changedTouches){var e=t.changedTouches[0],n=e.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&h.DomUtil.removeClass(n,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",e)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new h.Point(e.clientX,e.clientY)},_simulateEvent:function(t,e){var n=a.createEvent("MouseEvents");n._simulated=!0,e.target._simulatedClick=!0,n.initMouseEvent(t,!0,!0,s,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n)}}),h.Browser.touch&&!h.Browser.pointer&&h.Map.addInitHook("addHandler","tap",h.Map.Tap),h.Map.mergeOptions({boxZoom:!0}),h.Map.BoxZoom=h.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._moved=!1},addHooks:function(){h.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){h.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(t){return this._moved=!1,!(!t.shiftKey||1!==t.which&&1!==t.button)&&(h.DomUtil.disableTextSelection(),h.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),void h.DomEvent.on(a,"mousemove",this._onMouseMove,this).on(a,"mouseup",this._onMouseUp,this).on(a,"keydown",this._onKeyDown,this))},_onMouseMove:function(t){this._moved||(this._box=h.DomUtil.create("div","leaflet-zoom-box",this._pane),h.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var e=this._startLayerPoint,n=this._box,i=this._map.mouseEventToLayerPoint(t),o=i.subtract(e),s=new h.Point(Math.min(i.x,e.x),Math.min(i.y,e.y));h.DomUtil.setPosition(n,s),this._moved=!0,n.style.width=Math.max(0,Math.abs(o.x)-4)+"px",n.style.height=Math.max(0,Math.abs(o.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),h.DomUtil.enableTextSelection(),h.DomUtil.enableImageDrag(),h.DomEvent.off(a,"mousemove",this._onMouseMove).off(a,"mouseup",this._onMouseUp).off(a,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,n=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(n)){var i=new h.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(n));e.fitBounds(i),e.fire("boxzoomend",{boxZoomBounds:i})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),h.Map.addInitHook("addHandler","boxZoom",h.Map.BoxZoom),h.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),h.Map.Keyboard=h.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;t.tabIndex===-1&&(t.tabIndex="0"),h.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;h.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var t=a.body,e=a.documentElement,n=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),s.scrollTo(i,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,n,i=this._panKeys={},o=this.keyCodes;for(e=0,n=o.left.length;e<n;e++)i[o.left[e]]=[-1*t,0];for(e=0,n=o.right.length;e<n;e++)i[o.right[e]]=[t,0];for(e=0,n=o.down.length;e<n;e++)i[o.down[e]]=[0,t];for(e=0,n=o.up.length;e<n;e++)i[o.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,n,i=this._zoomKeys={},o=this.keyCodes;for(e=0,n=o.zoomIn.length;e<n;e++)i[o.zoomIn[e]]=t;for(e=0,n=o.zoomOut.length;e<n;e++)i[o.zoomOut[e]]=-t},_addHooks:function(){h.DomEvent.on(a,"keydown",this._onKeyDown,this)},_removeHooks:function(){h.DomEvent.off(a,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,n=this._map;if(e in this._panKeys){if(n._panAnim&&n._panAnim._inProgress)return;n.panBy(this._panKeys[e]),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds)}else{if(!(e in this._zoomKeys))return;n.setZoom(n.getZoom()+this._zoomKeys[e])}h.DomEvent.stop(t)}}),h.Map.addInitHook("addHandler","keyboard",h.Map.Keyboard),h.Handler.MarkerDrag=h.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new h.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),h.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),h.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,n=h.DomUtil.getPosition(t._icon),i=t._map.layerPointToLatLng(n);e&&h.DomUtil.setPosition(e,n),t._latlng=i,t.fire("move",{latlng:i}).fire("drag")},_onDragEnd:function(t){this._marker.fire("moveend").fire("dragend",t)}}),h.Control=h.Class.extend({options:{position:"topright"},initialize:function(t){h.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),n=this.getPosition(),i=t._controlCorners[n];return h.DomUtil.addClass(e,"leaflet-control"),n.indexOf("bottom")!==-1?i.insertBefore(e,i.firstChild):i.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),n=t._controlCorners[e];return n.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),h.control=function(t){return new h.Control(t)},h.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,o){var s=n+t+" "+n+o;e[t+o]=h.DomUtil.create("div",s,i)}var e=this._controlCorners={},n="leaflet-",i=this._controlContainer=h.DomUtil.create("div",n+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),h.Control.Zoom=h.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",n=h.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,e+"-in",n,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,e+"-out",n,this._zoomOut,this),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,n,i,o,s){var a=h.DomUtil.create("a",n,i);a.innerHTML=t,a.href="#",a.title=e;var r=h.DomEvent.stopPropagation;return h.DomEvent.on(a,"click",r).on(a,"mousedown",r).on(a,"dblclick",r).on(a,"click",h.DomEvent.preventDefault).on(a,"click",o,s).on(a,"click",this._refocusOnMap,s),a},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";h.DomUtil.removeClass(this._zoomInButton,e),h.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&h.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&h.DomUtil.addClass(this._zoomInButton,e)}}),h.Map.mergeOptions({zoomControl:!0}),h.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new h.Control.Zoom,this.addControl(this.zoomControl))}),h.control.zoom=function(t){return new h.Control.Zoom(t)},h.Control.Attribution=h.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){h.setOptions(this,t),this._attributions={}},onAdd:function(t){this._container=h.DomUtil.create("div","leaflet-control-attribution"),h.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){if(t)return this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this},removeAttribution:function(t){if(t)return this._attributions[t]&&(this._attributions[t]--,this._update()),this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var n=[];this.options.prefix&&n.push(this.options.prefix),t.length&&n.push(t.join(", ")),this._container.innerHTML=n.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),h.Map.mergeOptions({attributionControl:!0}),h.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new h.Control.Attribution).addTo(this))}),h.control.attribution=function(t){return new h.Control.Attribution(t)},h.Control.Scale=h.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;var e="leaflet-control-scale",n=h.DomUtil.create("div",e),i=this.options;return this._addScales(i,e,n),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),n},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,n){t.metric&&(this._mScale=h.DomUtil.create("div",e+"-line",n)),t.imperial&&(this._iScale=h.DomUtil.create("div",e+"-line",n))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,n=6378137*Math.PI*Math.cos(e*Math.PI/180),i=n*(t.getNorthEast().lng-t.getSouthWest().lng)/180,o=this._map.getSize(),s=this.options,a=0;o.x>0&&(a=i*(s.maxWidth/o.x)),this._updateScales(s,a)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=e<1e3?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,n,i,o=3.2808399*t,s=this._iScale;o>5280?(e=o/5280,n=this._getRoundNum(e),s.style.width=this._getScaleWidth(n/e)+"px",s.innerHTML=n+" mi"):(i=this._getRoundNum(o),s.style.width=this._getScaleWidth(i/o)+"px",s.innerHTML=i+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,e*n}}),h.control.scale=function(t){return new h.Control.Scale(t)},h.Control.Layers=h.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,n){h.setOptions(this,n),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var i in t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=h.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=h.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),h.Browser.touch?h.DomEvent.on(e,"click",h.DomEvent.stopPropagation):h.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);var n=this._form=h.DomUtil.create("form",t+"-list");if(this.options.collapsed){h.Browser.android||h.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var i=this._layersLink=h.DomUtil.create("a",t+"-toggle",e);i.href="#",i.title="Layers",h.Browser.touch?h.DomEvent.on(i,"click",h.DomEvent.stop).on(i,"click",this._expand,this):h.DomEvent.on(i,"focus",this._expand,this),h.DomEvent.on(n,"click",function(){setTimeout(h.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=h.DomUtil.create("div",t+"-base",n),this._separator=h.DomUtil.create("div",t+"-separator",n),this._overlaysList=h.DomUtil.create("div",t+"-overlays",n),e.appendChild(n)},_addLayer:function(t,e,n){var i=h.stamp(t);this._layers[i]={layer:t,name:e,overlay:n},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,n=!1,i=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),i=i||e.overlay,n=n||!e.overlay;this._separator.style.display=i&&n?"":"none"}},_onLayerChange:function(t){var e=this._layers[h.stamp(t.layer)];if(e){this._handlingClick||this._update();var n=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;n&&this._map.fire(n,e)}},_createRadioElement:function(t,e){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';e&&(n+=' checked="checked"'),n+="/>";var i=a.createElement("div");return i.innerHTML=n,i.firstChild},_addItem:function(t){var e,n=a.createElement("label"),i=this._map.hasLayer(t.layer);t.overlay?(e=a.createElement("input"),e.type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=i):e=this._createRadioElement("leaflet-base-layers",i),e.layerId=h.stamp(t.layer),h.DomEvent.on(e,"click",this._onInputClick,this);var o=a.createElement("span");o.innerHTML=" "+t.name,n.appendChild(e),n.appendChild(o);var s=t.overlay?this._overlaysList:this._baseLayersList;return s.appendChild(n),n},_onInputClick:function(){var t,e,n,i=this._form.getElementsByTagName("input"),o=i.length;for(this._handlingClick=!0,t=0;t<o;t++)e=i[t],n=this._layers[e.layerId],e.checked&&!this._map.hasLayer(n.layer)?this._map.addLayer(n.layer):!e.checked&&this._map.hasLayer(n.layer)&&this._map.removeLayer(n.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){h.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),h.control.layers=function(t,e,n){return new h.Control.Layers(t,e,n)},h.PosAnimation=h.Class.extend({includes:h.Mixin.Events,run:function(t,e,n,i){this.stop(),this._el=t,this._inProgress=!0,this._newPos=e,this.fire("start"),t.style[h.DomUtil.TRANSITION]="all "+(n||.25)+"s cubic-bezier(0,0,"+(i||.5)+",1)",h.DomEvent.on(t,h.DomUtil.TRANSITION_END,this._onTransitionEnd,this),h.DomUtil.setPosition(t,e),h.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(h.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(h.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),h.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var t=this._getPos();return t?(this._el._leaflet_pos=t,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var t,e,n,i=this._el,o=s.getComputedStyle(i);if(h.Browser.any3d){if(n=o[h.DomUtil.TRANSFORM].match(this._transformRe),!n)return;t=parseFloat(n[1]),e=parseFloat(n[2])}else t=parseFloat(o.left),e=parseFloat(o.top);return new h.Point(t,e,!0)},_onTransitionEnd:function(){h.DomEvent.off(this._el,h.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[h.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),h.Map.include({setView:function(t,e,n){if(e=e===r?this._zoom:this._limitZoom(e),t=this._limitCenter(h.latLng(t),e,this.options.maxBounds),n=n||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==r&&(n.zoom=h.extend({animate:n.animate},n.zoom),n.pan=h.extend({animate:n.animate},n.pan));var i=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(i)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=h.point(t).round(),e=e||{},!t.x&&!t.y)return this;if(this._panAnim||(this._panAnim=new h.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){h.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,n,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){h.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var n=this._getCenterOffset(t)._floor();return!((e&&e.animate)!==!0&&!this.getSize().contains(n))&&(this.panBy(n,e),!0)}}),h.PosAnimation=h.DomUtil.TRANSITION?h.PosAnimation:h.PosAnimation.extend({run:function(t,e,n,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=h.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=h.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;t<e?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));h.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){h.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),h.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),h.DomUtil.TRANSITION&&h.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&h.DomUtil.TRANSITION&&h.Browser.any3d&&!h.Browser.android23&&!h.Browser.mobileOpera,this._zoomAnimated&&h.DomEvent.on(this._mapPane,h.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),h.Map.include(h.DomUtil.TRANSITION?{_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||n.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/i),s=this._getCenterLayerPoint()._add(o);return!(n.animate!==!0&&!this.getSize().contains(o))&&(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,s,i,null,!0),!0)},_animateZoom:function(t,e,n,i,o,s,a){a||(this._animatingZoom=!0),h.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,h.Draggable&&(h.Draggable._disabled=!0),h.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:t,zoom:e,origin:n,scale:i,delta:o,backwards:s}),setTimeout(h.bind(this._onZoomTransitionEnd,this),250)},this)},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._animatingZoom=!1,h.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),h.Util.requestAnimFrame(function(){this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),h.Draggable&&(h.Draggable._disabled=!1)},this))}}:{}),h.TileLayer.include({_animateZoom:function(t){this._animating||(this._animating=!0,this._prepareBgBuffer());var e=this._bgBuffer,n=h.DomUtil.TRANSFORM,i=t.delta?h.DomUtil.getTranslateString(t.delta):e.style[n],o=h.DomUtil.getScaleString(t.scale,t.origin);
e.style[n]=t.backwards?o+" "+i:i+" "+o},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.parentNode.appendChild(t),h.Util.falseFn(e.offsetWidth);var n=this._map.getZoom();(n>this.options.maxZoom||n<this.options.minZoom)&&this._clearBgBuffer(),this._animating=!1},_clearBgBuffer:function(){var t=this._map;!t||t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[h.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer,n=this._getLoadedTilesPercentage(e),i=this._getLoadedTilesPercentage(t);return e&&n>.5&&i<.5?(t.style.visibility="hidden",void this._stopLoadingImages(t)):(e.style.visibility="hidden",e.style[h.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(t){var e,n,i=t.getElementsByTagName("img"),o=0;for(e=0,n=i.length;e<n;e++)i[e].complete&&o++;return o/n},_stopLoadingImages:function(t){var e,n,i,o=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,n=o.length;e<n;e++)i=o[e],i.complete||(i.onload=h.Util.falseFn,i.onerror=h.Util.falseFn,i.src=h.Util.emptyImageUrl,i.parentNode.removeChild(i))}}),h.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locateOptions=h.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=h.bind(this._handleGeolocationResponse,this),n=h.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,n,t):navigator.geolocation.getCurrentPosition(e,n,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,n=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+n+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,n=t.coords.longitude,i=new h.LatLng(e,n),o=180*t.coords.accuracy/40075017,s=o/Math.cos(h.LatLng.DEG_TO_RAD*e),a=h.latLngBounds([e-o,n-s],[e+o,n+s]),r=this._locateOptions;if(r.setView){var l=Math.min(this.getBoundsZoom(a),r.maxZoom);this.setView(i,l)}var c={latlng:i,bounds:a,timestamp:t.timestamp};for(var u in t.coords)"number"==typeof t.coords[u]&&(c[u]=t.coords[u]);this.fire("locationfound",c)}})}(window,document)},function(module,exports,__webpack_require__){(function(_){module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="map-book-item">\n\t<div class="img-wrap">\n\t\t<a href="'+__e(bookUrl)+'" class="link-to-localize">\n\t\t\t<img src="'+__e(imgCdn)+"assets/images/"+__e(coverUrl)+'">\n\t\t</a>\n\t</div>\n\t<div class="info-wrap">\n\t\t<p class="item-loc">\n\t\t\tSomeone in <span class="item-bold">'+(null==(__t=displayName)?"":__t)+'</span> bought\n\t\t</p>\n\t\t<p class="item-title">\n\t\t\t<a href="'+__e(bookUrl)+'" class="link-to-localize">'+(null==(__t=title)?"":__t)+'</a>\n\t\t</p>\n\t\t<p class="item-time">\n\t\t    with <span class="item-bold">free delivery</span> <br>\n\t\t    '+(null==(__t=timeDiff)?"":__t)+"\n\t\t</p>\n\t</div>\n</div>";return __p}}).call(exports,__webpack_require__(3))},function(t,e,n){(function(e,n,i){t.exports=e.View.extend({el:"body",initialize:function(t){this.$window=n(window),this.isMobile=t.isMobile,this.stringLocalizer=t.stringLocalizer},loadAll:function(){this.loadAffiliate(),this.isMobile||this.loadZopim()},loadZopim:function(){window.$zopim||function(t,e){var n=window.$zopim=function(t){n._.push(t)},i=n.s=t.createElement(e),o=t.getElementsByTagName(e)[0];n.set=function(t){n.set._.push(t)},n._=[],n.set._=[],i.async=!0,i.setAttribute("charset","utf-8"),i.src="//v2.zopim.com/?2idAW3AKZ28UUWgitXg7WMvt1MrRI4pX",n.t=+new Date,i.type="text/javascript",o.parentNode.insertBefore(i,o)}(document,"script");var t=location.pathname,e=this;$zopim(function(){if(null==sessionStorage.getItem("showZopimHomepage")&&sessionStorage.setItem("showZopimHomepage",Math.floor(101*Math.random())<60),i.contains([e.stringLocalizer.localizedLink("/contactus"),e.stringLocalizer.localizedLink("/help")],t)||t.startsWith(e.stringLocalizer.localizedLink("/help/topic/"))||t==e.stringLocalizer.localizedLink("/")&&"true"==sessionStorage.getItem("showZopimHomepage")){$zopim.livechat.theme.setColor("#4C394E");var n=!0;$zopim.livechat.setOnStatus(function(t){n&&(n=!1,"online"==t?$zopim.livechat.button.show():"false"==$zopim.livechat.isChatting()&&$zopim.livechat.button.hide())}),$zopim.livechat.setOnChatStart(function(){"true"==$zopim.livechat.isChatting()&&($zopim.livechat.window.show(),$zopim.livechat.bubble.show())}),$zopim.livechat.window.onHide(function(){$zopim.livechat.button.show()}),$zopim.livechat.window.onShow(function(){$zopim.livechat.window.show()}),"true"==$zopim.livechat.window.getDisplay()&&$zopim.livechat.hideAll()}else $zopim.livechat.hideAll()})},loadAffiliate:function(){this.$("#pap_x2s6df8d")&&this.$("#pap_x2s6df8d").length>0&&this.$("#pap_x2s6df8d").remove(),this._inject("pap_x2s6df8d","//affiliates.bookdepository.com/scripts/trackjs.js",function(){try{PostAffTracker._cmanager.setDoNotUseFlashCookie(!0),PostAffTracker.setAccountId("default1"),PostAffTracker.track(),window.ue&&window.ue.count("clickCreditedToAffiliate",1)}catch(t){}})},_inject:function(t,e,n,i,o){var s=document.createElement("script");s.src=e,t&&(s.id=t),"undefined"==typeof o&&(o=!0),s.type="text/javascript",s.async=o;try{n&&("undefined"==typeof i&&(i=window),s.onload=function(){n.apply(i)})}catch(t){}var a=this.$(">script").get();this.el.insertBefore(s,a[0])}})}).call(e,n(1),n(2),n(3))},function(t,e,n){(function(e,n){var i=e.View.extend({events:{"change [data-block-selector-class]":"blockSelector"},initialize:function(){var t=".selector-default";this.$("[data-block-selector-class]").each(function(){(n(this).is(":checked")||n(this).is(":selected"))&&(t=n(this).data("block-selector-class"))}),this._blockSelector(t)},blockSelector:function(t){var e=n(t.target).data("block-selector-class");this._blockSelector(e)},_blockSelector:function(t){var e=this.$(t);n(".selector-default").hide(),this.$("[data-block-selector-class]").each(function(){classAffected=n(this).data("block-selector-class"),n(classAffected).hide()}),e.show()}});t.exports=i}).call(e,n(1),n(2))},function(t,e,n){(function(e,n){var i=e(".ratings-credit-wrap .goodreads-credit-extended"),o=n.View.extend({events:{"click #goodreads-credit":"showGoodreadsExtended","click .goodreads-credit-extended .exit-to-goodreads":"exitToGoodreads","click .goodreads-credit-extended":"hideGoodreadsExtended"},showGoodreadsExtended:function(){this.logCounter("goodreadsCreditClick"),i.slideToggle()},hideGoodreadsExtended:function(){i.slideUp()},exitToGoodreads:function(t){this.logCounter("exitToGoodreads"),t.stopPropagation()},logCounter:function(t){window.ue&&window.ue.count(t,1)}});t.exports=o}).call(e,n(2),n(1))},function(t,e,n){(function(e,n){var i=e.View.extend({events:{"click .show-more":"showMoreCategories"},showMoreCategories:function(t){var e=n(t.currentTarget),i="See more",o="+";e.hasClass("more")&&(o="-",i="See less"),e.toggleClass("more"),e.find(".show-more-sign").html(o),e.find(".show-more-text").html(i),n(".hidden-categories").slideToggle()}});t.exports=i}).call(e,n(1),n(2))},function(t,e,n){(function(e,n){var i="tab-",o=e.View.extend({events:{"click .tab-triggers a":"switchTab"},initialize:function(t){this.app=t.app||window.app,this.$window=n(window),n(".tab-triggers-wrap").length||this.$(".tab-triggers").wrap('<div class="tab-triggers-wrap"></div>');var e=window.location.hash;if(e&&e.startsWith("#"+i)){e=e.substring(i.length+1);var o=this.$(".tab-triggers-wrap #"+e);o.length&&(this._switchTab(o),this.app.scrollTop(o.offset().top))}this.$(".tab-triggers").css({flexWrap:"nowrap"})},switchTab:function(t){var e=n(t.currentTarget);this._switchTab(e)},_switchTab:function(t){selectClass=t.data("target"),this.$(".tab-wrap.tab-active").removeClass("tab-active"),this.$(selectClass).addClass("tab-active"),this.$(".carousel-wrap").removeClass("carousel-active"),this.$(".tab-triggers .tab-active").removeClass("tab-active"),t.addClass("tab-active"),this.$(selectClass).parent().addClass("carousel-active"),this.$window.trigger("scroll"),this.$window.trigger("refresh"),window.location.hash=i+t.attr("id")}});t.exports=o}).call(e,n(1),n(2))},function(t,e,n){(function(e,i){var o=n(18),s=n(20),a=(n(21),n(23)),r=n(26),l="/basket/addisbn",h=e.Model.extend({}),c=e.Collection.extend({model:h,comparator:"modified"}),u=e.Model.extend({}),d=e.View.extend({el:".basket-wrap",initialize:function(){this.listenTo(this.model,"change:totalCostWithSymbol",this.costChange),this.listenTo(this.model,"change:numItems",this.itemChange)},costChange:function(t){t.get("totalCostWithSymbol")&&this.$(".total").html(t.get("totalCostWithSymbol"))},itemChange:function(t){var e="items";1==t.get("numItems")&&(e="item"),this.$(".item-count").attr("data-item-count",t.get("numItems")),this.$(".item-count").html(t.get("numItems")),this.$(".item-text").html(e)}}),p=e.View.extend({className:"basket-popup-wrap",initialize:function(t){this.items=t.items,this.stringLocalizer=t.stringLocalizer,this.listenTo(this.model,"change:totalCostWithSymbol",this.costChange),this.listenTo(this.model,"change:numItems",this.itemChange)},costChange:function(t){t.get("totalCostWithSymbol")&&this.$(".total").html(t.get("totalCostWithSymbol"))},itemChange:function(t){var e="items";1==t.get("numItems")&&(e="item"),this.$(".item-count").attr("data-item-count",t.get("numItems")),this.$(".item-count").html(t.get("numItems")),this.$(".item-text").html(e)},renderBasketInfo:function(){var t=this.stringLocalizer.localizeTemplate(r(this.model.attributes));this.$(".basket-info").html(t)},renderRelated:function(){var t=new s({params:{isbns:this.items.pluck("isbn13").reverse().join(","),type:i("body").hasClass("page-type-home")>0?"home":"detail"},url:this.stringLocalizer.localizedLink("/json/p13n/atc"),currency:this.model.get("currencySmall"),stringLocalizer:this.stringLocalizer});this.$(".basket-related-items").append(t.render().el)},render:function(){return this.$el.empty()&&this.$el.html("<div class='basket-info'></div><div class='basket-related-items'></div>"),this.renderBasketInfo(),this.model.get("showRelated")===!0&&this.renderRelated(),this}}),m=e.View.extend({events:{"click .content-wrap > div:not(.basket-page) .add-to-basket, .modal .add-to-basket":"addToBasket","click .basket-recommendation-carousel .add-to-basket":"logBasketCarouselClick"},initialize:function(t){this.app=t.app,this.stringLocalizer=t.stringLocalizer,this.basketModel=new u,this.basketItems=new c,this.basketWrap=new d({model:this.basketModel}),this.listenTo(this.basketModel,"announce",this.popup)},addToBasket:function(t){t.preventDefault();var e=i(t.currentTarget);window.firstLoadApp.trackingEvents.addToBasketEvent(e);var n=e.data("isbn"),o=e.data("show-related")&&!app.isMobile();this.addItem(n,o,e)},logBasketCarouselClick:function(){window.ue&&window.ue.count("ClickBasketPageCarouselCount",1)},popup:function(t){if(!this.basketPopup){var e=this,n=this.stringLocalizer.localizeString("bd_js_item_added_to_your_basket","Item added to your basket"),i=n;t.get("error")===!0&&(i=t.get("errorTitle")),this.basketPopup=new p({model:this.basketModel,items:this.basketItems,stringLocalizer:this.stringLocalizer});var o=new a({title:i,child:this.basketPopup.render().el,size:"md",status:t.get("error")===!0?"error":"success"});o.on("hidden",function(){e.basketPopup.el.remove(),e.basketPopup=null}),o.open()}this.trackCartContents()},trackCartContents:function(){var t=[];this.basketItems.each(function(e){var n={};n.item=e.get("isbn13"),n.quantity=e.get("quantity"),n.price=e.get("totalCostGBP"),n.unique_id=e.get("isbn13"),t.push(n)}),window.firstLoadApp.trackingEvents.salesforceAPI&&window.firstLoadApp.trackingEvents.salesforceAPI.push(["trackCart",{cart:o(t)}])},addItem:function(t,e,n){var o=this;n.addClass("loading"),this.basketModel.clear(),this.basketModel.set({showRelated:e}),i.ajax({url:this.stringLocalizer.localizedLink(l),data:{isbn13:t,call:"ajax",time:(new Date).getTime()},success:function(t){t.info.currency=t.currency,t.info.currencySmall=t.currencySmall,o.basketModel.set(t.info),t.error===!0&&(o.basketModel.set("error",t.error),o.basketModel.set("errorMessage",t.errorMessage),o.basketModel.set("errorTitle",t.errorTitle)),o.basketItems.set(t.items),o.basketModel.trigger("announce",o.basketModel),n.removeClass("loading")}})}});t.exports=m}).call(e,n(1),n(2))},function(t,e,n){"use strict";function i(t,e,n,i){i||(i={});var a=s(t,e,n,i.decycler);if(!n)return a;var r=i.offset||0,l=o(r);return a=a.replace(/^|\n/g,function(t){return t?t+l:l}).slice(r)}function o(t){for(var e="";t--;)e+=" ";return e}t.exports=i;var s=n(19);i._space=o},function(t,e){function n(t,e,n,o){return JSON.stringify(t,i(e,o),n)}function i(t,e){var n=[],i=[];return null==e&&(e=function(t,e){return n[0]===e?"[Circular ~]":"[Circular ~."+i.slice(0,n.indexOf(e)).join(".")+"]"}),function(o,s){if(n.length>0){var a=n.indexOf(this);~a?n.splice(a+1):n.push(this),~a?i.splice(a,1/0,o):i.push(o),~n.indexOf(s)&&(s=e.call(this,o,s))}else n.push(s);return null==t?s:t.call(this,o,s)}}e=t.exports=n,e.getSerialize=i},function(t,e,n){(function(e,i){var o=n(8),s=n(21),a=s.cdns,r=n(22),l=e.Model.extend({defaults:{title:null,fallback:null,reference:null},getReference:function(){return this.get("reference")}}),h=e.Model.extend({getUrl:function(){return"/"+this.get("url")},getTitle:function(){return this.get("title")},getAuthorName:function(){return this.get("author")?this.get("author").name:null},getRatingStars:function(){var t=i("<div>").addClass("stars");if(this.get("rating")){var e=parseInt(this.get("rating").starCount);if(e)for(var n=1;n<=5;n++)e>=n?t.append(i("<span>").addClass("star full-star")):e>n-1&&e<n?t.append(i("<span>").addClass("star half-star")):t.append(i("<span>").addClass("star"))}return t.html()},getPrice:function(){return this.get("price")?this.get("price").formattedPrice:null},getRrp:function(){var t=this.get("price");return t&&t.rrp>t.price?t.formattedRrp:null},getSavings:function(){return this.get("price")?this.get("price").formattedSaving:null},getSavingsPercent:function(){return this.get("price")&&this.get("price").savingPercent&&this.get("price").savingPercent>10?Math.floor(this.get("price").savingPercent):null},getFormat:function(){return this.get("format")},getIsbn:function(){return this.get("isbn")},getImgUrl:function(){var t=a[0];return"//"+t+".cloudfront.net/assets/images/book/mid/"+this.get("image")}}),c=e.Collection.extend({model:h,initialize:function(t){this.params=t.params,this.baseUrl=t.baseUrl,this.meta=new l},url:function(){return this.baseUrl+"?"+i.param(this.params)},parse:function(t){return this.meta.set(t.recommendation),t.data}}),u=e.View.extend({className:"related-items-wrap",initialize:function(t){this.params=t.params,this.url=t.url,this.stringLocalizer=t.stringLocalizer;var e=new c({baseUrl:this.url,params:this.params});this.meta=e.meta,this.listenTo(this.meta,"change:title",this.renderTitle),this.listenTo(this.meta,"change:fallback",this.checkFallback),this.listenTo(e,"add",this.renderItem),this.listenTo(e,"update",this.notifyCarousel),this.$el.html("<h3 class='carousel-title'></h3><div class='carousel-wrap'><a class='prev-btn'><i class='icon-chevron-left'></i></a><div class='carousel module tab-wrap'><div class='tab'></div></div><a class='next-btn'><i class='icon-chevron-right'></i></a></div>"),e.fetch()},checkFallback:function(t){t.get("fallback")===!1&&this.$el.addClass("active")},renderItem:function(t){var e=this.stringLocalizer.localizeTemplate(r({item:t,meta:this.meta}));this.$(".carousel-wrap .tab").append(e),i(window).trigger("refresh")},renderTitle:function(t){this.$(".carousel-title").html(t.get("title"))},render:function(){return this.carousel=new o({el:this.$(".carousel-wrap"),mode:"modal"}),this},notifyCarousel:function(){this.carousel&&this.carousel.trigger("updated:carousel")}});t.exports=u}).call(e,n(1),n(2))},function(t,e){t.exports={sizes:{sm:480,md:668,lg:1024,xl:1280,xxl:1440},cdns:["d1w7fb2mkkr3kw"],analytics_id:"UA-69165239-1"}},function(module,exports){module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj){var url=item.getUrl()+"?ref="+meta.getReference(),img_url=item.getImgUrl();__p+='\n\n<div class="book-item">\n\t<div class="item-img">\n\t\t<a href="'+(null==(__t=url)?"":__t)+'" class="link-to-localize">\n\t\t\t<img src="'+(null==(__t=img_url)?"":__t)+'" alt="'+(null==(__t=item.getTitle())?"":__t)+'">\n\t\t\t',item.getSavingsPercent()&&(__p+='\n                <div class="savings-splat string-to-localize" data-localizer-string-id="bd_saving_percent_off"\n\t\t\t\t\t data-parameters=\'{"0":"'+(null==(__t=item.getSavingsPercent())?"":__t)+'"}\'\n\t\t\t\t\t data-default-localized-pattern="{0}%&lt;br&gt; off"></div>\n            '),__p+='\n\t\t</a>\n\t</div>\n\n\t<div class="item-info">\n\t\t<h3 class="title">\n\t\t\t<a href="'+(null==(__t=url)?"":__t)+'" class="link-to-localize">\n\t\t\t\t'+(null==(__t=item.getTitle())?"":__t)+'\n\t\t\t</a>\n\t\t</h3>\n\t\t<p class="author">\n\t\t\t'+(null==(__t=item.getAuthorName())?"":__t)+'\n\t\t</p>\n\t\t<div class="rating-wrap">\n\t\t\t'+(null==(__t=item.getRatingStars())?"":__t)+'\n\t\t</div>\n\n\t\t<p class="format">\n\t\t\t'+(null==(__t=item.getFormat())?"":__t)+'\n\t\t</p>\n\n        <div class="price-wrap">\n            <p class="price">\n                '+(null==(__t=item.getPrice())?"":__t)+'\n                <span class="rrp">'+(null==(__t=item.getRrp())?"":__t)+"</span>\n            </p>\n\t\t\t",item.getSavings()&&(__p+='\n\t\t\t\t<p class="price-save string-to-localize" data-localizer-string-id="bd_price_save"\n\t\t\t\t   data-parameters=\'{"0":"'+(null==(__t=item.getSavings())?"":__t)+'"}\'\n\t\t\t\t   data-default-localized-pattern="Save {0}"></p>\n\t\t\t'),__p+='\n\t\t</div>\n\t</div>\n\n\t<div class="item-actions">\n\t\t<div class="btn-wrap">\n\t\t\t<a href="" class="btn btn-sm btn-primary add-to-basket string-to-localize link-to-localize"\n\t\t\t   data-localizer-string-id="bd_add_to_basket" data-default-localized-pattern="Add to basket"\n\t\t\t   data-ref="'+(null==(__t=meta.getReference())?"":__t)+'" data-isbn="'+(null==(__t=item.getIsbn())?"":__t)+'"></a>\n\t\t</div>\n\t</div>\n</div>'}return __p}},function(t,e,n){(function(e,i){var o=n(24),s=n(25);t.exports=e.View.extend({className:"modal fade",initialize:function(t){if(t.child)this.child=t.child;else{var n=new e.View;n.$el.html(t.template(t.model.attributes)),this.child=n.el}this.size=t.size||"",this.title=t.title||"",this.usePlain=t.usePlain||!1,this.status=t.status||"normal"},open:function(){this.render().appendTo("body"),this.$el.addClass("status-"+this.status),this.size&&this.$(".modal-dialog").addClass("modal-"+this.size);var t=this;this.$el.on("hidden.bs.modal",function(){t.$el.remove(),t.trigger("hidden"),window.location.hash=""}),this.$el.on("shown.bs.modal",function(){i(window).trigger("resize"),t.trigger("open")}),this.$el.modal({show:!0,keyboard:!0})},render:function(){return this.usePlain?this.$el.html(s({title:this.title})):this.$el.html(o({title:this.title})),this.$(".modal-body").append(this.child),this.$el}})}).call(e,n(1),n(2))},function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="modal-dialog">\n  <div class="modal-content">\n    <div class="modal-header">\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n      <h3 class="modal-title">'+(null==(__t=title)?"":__t)+'</h3>\n    </div>\n    <div class="modal-body">\n      \n    </div>\n  </div>\n</div>';return __p}},function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="modal-dialog">\n  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <div class="modal-content-plain">\n    <div class="modal-body">\n\n    </div>\n  </div>\n</div>';return __p}},function(module,exports){module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)"undefined"!=typeof errorMessage&&(__p+='\n\t<div class="message-wrap">\n\t\t<div class="message-error">'+(null==(__t=errorMessage)?"":__t)+"</div>\n\t</div>\n"),__p+='\n<span id="basket-total-count" class="string-to-localize" data-parameters=\'{"0":"'+(null==(__t=numItems)?"":__t)+'"}\'\n\t  data-localizer-string-id="bd_js_total_basket_count"\n\t  data-default-localized-pattern="{0, plural,\n\t\t  one {You have &lt;b&gt;&lt;span class=\'item-count\'&gt;1&lt;/span&gt;\n\t\t\t\t&lt;span class=\'item-text\'&gt;item&lt;/span&gt;&lt;/b&gt; in your basket}\n\t\t  other {You have &lt;b&gt;&lt;span class=\'item-count\'&gt;{0}&lt;/span&gt;\n\t\t\t\t\t&lt;span class=\'item-text\'&gt;items&lt;/span&gt;&lt;/b&gt; in your basket}}"></span>\n<br>\n<span id="basket-total-cost" class="string-to-localize" data-parameters=\'{"0":"'+(null==(__t=totalCostWithSymbol)?"":__t)+'"}\'\n\t  data-localizer-string-id="bd_js_total_cost"\n\t  data-default-localized-pattern="Total cost: &lt;b class=\'pink-text big total\'&gt;{0}&lt;/b&gt;"></span>\n<br>\n<br>\n\n<a data-dismiss="modal" class="btn btn-grey pull-left continue-shopping string-to-localize"\n   data-localizer-string-id="bd_js_continue_shopping" data-default-localized-pattern="Continue shopping"></a>\n<a href="/basket" class="btn btn-primary pull-right continue-to-basket string-to-localize link-to-localize"\n   data-localizer-string-id="bd_js_basket_checkout" data-default-localized-pattern="Basket / Checkout"></a>';return __p}},function(t,e,n){(function(e,i){var o=n(23),s=n(28),a=n(29),r=n(30),l=n(31),h=n(32),c=e.Collection.extend({initialize:function(t){this.stringLocalizer=t.stringLocalizer},url:function(){return this.stringLocalizer.localizedLink("/account/wishlistlist")},parse:function(t){return t.error?(this.trigger("error",t),this.error=t,!1):(this.error=!1,t.items)}}),u=e.View.extend({current_wishlist:null,events:{"click .tab-trigger":"switchTab","submit form.item-form":"processItem"},processItem:function(t){t.preventDefault();var e=i(t.currentTarget),n=e.serialize(),o=this;return i.ajax({url:this.stringLocalizer.localizedLink("/account/wishlistItemupdate"),data:n,method:"GET",success:function(t){o.processItemResult.apply(o,[t])}}),!1},processItemResult:function(t){if(t.status===!1)this.addError(t.messageCode,t.message);else{var e=h({id:t.wishlistId,label:t.wishlistLabel}),n=this.stringLocalizer.localizeTemplate(e);this.$el.replaceWith(n)}},addError:function(t,e){var n=this.$(".error");n.length||(n=i('<div class="error-box error"></div>').prependTo(this.el)),n.html(e)},switchTab:function(t){t.preventDefault();var e=i(t.currentTarget),n=this.$(e.data("target"));this.$(".tab.active").removeClass("active"),n.addClass("active")},initialize:function(t){t.current_wishlist&&(this.current_wishlist=t.current_wishlist),this.stringLocalizer=t.stringLocalizer,this.list=new c({stringLocalizer:this.stringLocalizer}),this.listenTo(this.list,"error",this.showErrorModal)},showModal:function(){this.list.error||(this.render(),this.delegateEvents(this.events),this.modal=new o({title:"Add item to wishlist",size:"md",child:this.$el}),this.modal.open())},showErrorModal:function(t){if(400===t.error){var e=s(),n=this.stringLocalizer.localizeTemplate(e);this.modal=new o({title:"Not logged in",size:"sm",child:n}),this.modal.open()}},editNote:function(t){t.attr("disabled","disabled");var e=this,n=t.data("isbn"),i=t.data("wishlist");this.renderNote(n,i,t.html()),this.delegateEvents(this.events),this.modal=new o({title:"Notes",size:"md",child:this.$el}),this.modal.on("open",function(){var t=e.$("textarea");t.focus();var n=t.val();t.val(""),t.val(n)}),this.modal.on("hidden",function(){t.removeAttr("disabled")}),this.modal.open()},addItem:function(t,e){this.current_isbn=t,e.addClass("loading"),this.list.fetch(),this.listenToOnce(this.list,"sync",this.showModal),this.listenToOnce(this.list,"sync",function(){e.removeClass("loading")})},newWishlist:function(){this.renderCreate(),this.delegateEvents(this.events),this.modal=new o({title:"Create new wishlist",size:"md",child:this.$el}),this.modal.open()},renderCreate:function(){var t=r({items:this.list,isbn:this.current_isbn,current_wishlist:this.current_wishlist}),e=this.stringLocalizer.localizeTemplate(t);this.$el.html(e)},renderNote:function(t,e,n){var i=l({isbn:t,text:n,wishlist_id:e}),o=this.stringLocalizer.localizeTemplate(i);this.$el.html(o)},render:function(){var t=this.$el,e=a({items:this.list,isbn:this.current_isbn,current_wishlist:this.current_wishlist}),n=this.stringLocalizer.localizeTemplate(e);t.html(n),null!==t.find("#select-wishlists").val()&&""!==t.find("#select-wishlists").val()||(t.find(".select-wishlists-wrap").hide(),t.find(".btn-add").hide())}});t.exports=u}).call(e,n(1),n(2))},function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='Please <a href="/account/login?returnAction=addToWishlist" class="link-to-localize">sign in</a> to add item to your wishlists.';return __p}},function(module,exports){module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="wishlist-wrap">\n\t<div class="tab new-wl ',0==items.length&&(__p+="active"),__p+='">\n\t\t<form class="item-form">\n\t\t\t<input type="hidden" name="isbn13" value="'+(null==(__t=isbn)?"":__t)+'">\n\t\t\t<input type="hidden" name="mainAction" value="createwishlist">\n\t\t\t<div class="form-group">\n\t\t\t\t<label for="">Create new wishlist</label>\n\t\t\t\t<input type="text" class="form-control" name="wishlistLabel" placeholder="Wishlist name">\n\t\t\t</div>\n\t\t\t<div class="form-group clearfix">\n\t\t\t\t',items.length>0&&(__p+='\n\t\t\t\t\t<a class="tab-trigger btn btn-dark-grey" data-target=".existing-wl">Select existing wishlist</a>\n\t\t\t\t'),__p+='\n\t\t\t\t<button type="submit" class="btn btn-primary pull-right">Add</button>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\n\t<div class="tab existing-wl ',items.length>0&&(__p+=" active"),__p+='">\n\t\t<form class="item-form">\n\t\t\t<input type="hidden" name="isbn13" value="'+(null==(__t=isbn)?"":__t)+'">\n\t\t\t<input type="hidden" name="mainAction" value="add">\n\t\t\t<div class="form-group select-wishlists-wrap">\n\t\t\t\t<label for="">Select wishlist</label>\n\t\t\t\t<select id="select-wishlists" name="wishlistId" class="wishlist-id form-control">\n\t\t\t\t\t',items.forEach(function(t){t.get("id")!=current_wishlist&&(__p+='\n\t\t\t\t\t<option value="'+(null==(__t=t.get("id"))?"":__t)+'" ',t.get("isDefault")&&(__p+=' selected="selected" '),__p+=">"+(null==(__t=t.get("label"))?"":__t)+"</option>\n\t\t\t\t\t")}),__p+='\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t\t<div class="form-group clearfix">\n\t\t\t\t<a class="tab-trigger btn btn-dark-grey" data-target=".new-wl">Create new wishlist</a>\n\t\t\t\t<button type="submit" class="btn btn-primary btn-add pull-right">Add</button>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n</div>';return __p}},function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="wishlist-wrap">\n\t<form action="/account/wishlistupdate" method="post" class="link-to-localize">\n\t\t<input type="hidden" name="mainAction" value="create">\n\t\t<div class="form-group">\n\t\t\t<input type="text" class="form-control" name="label" placeholder="Wishlist name" required maxlength="250">\n\t\t</div>\n\t\t<div class="form-group clearfix">\n\t\t\t<button type="submit" class="btn btn-primary pull-right">Create</button>\n\t\t</div>\n\t</form>\n</div>';return __p}},function(module,exports,__webpack_require__){(function(_){module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="wishlist-wrap">\n\t<div class="messages"></div>\n\t<form action="/account/wishlistItemupdate" method="post" class="link-to-localize">\n\t\t<input type="hidden" name="mainAction" value="update">\n\t\t<input type="hidden" name="isbn13" value="'+__e(isbn)+'">\n\t\t<input type="hidden" name="wishlistId" value="'+__e(wishlist_id)+'">\n\t\t<div class="form-group">\n\t\t\t<textarea name="notes" class="form-control">'+__e(text)+'</textarea>\n\t\t</div>\n\t\t<div class="form-group clearfix">\n\t\t\t<button type="submit" class="btn btn-primary pull-right">Save</button>\n\t\t</div>\n\t</form>\n</div>';return __p}}).call(exports,__webpack_require__(3))},function(module,exports,__webpack_require__){(function(_){module.exports=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="Item added to <b>"+(null==(__t=label)?"":__t)+'</b>\n<div class="clearfix">\n\t<a href="/account/wishlist?wishlistId='+__e(id)+'" class="btn btn-primary pull-right link-to-localize">Go to '+(null==(__t=label)?"":__t)+"</a>\n</div>\n\n";return __p}}).call(exports,__webpack_require__(3))},function(t,e,n){(function(e,i){function o(t){var e=i("<div/>").html(r(t.attributes)),n=e.find("div.modal-heading").html(),o=e.find("div.modal-text"),a=new s({title:n,size:"sm",child:o});a.open()}var s=n(23),a=n(34),r=n(35),l=e.Model.extend({}),h=e.View.extend({events:{"submit form":"signUp"},initialize:function(){this.form=this.$el.find("form"),this.endpointUrl=this.form.attr("action"),this.counter=new a},signUp:function(t){this.counter.count("newsletterSubmit"),t.preventDefault();var e=this;i.ajax({url:this.endpointUrl,method:"GET",data:this.form.serialize(),success:function(t){switch(o(new l(t)),t.outcome){case 0:e.counter.count("newsletterInvalidEmail");break;case 1:e.counter.count("newsletterSuccess");break;case 2:e.counter.count("newsletterAlreadySubscribed")}e.form[0].reset()},error:function(){o(new l({outcome:-1})),e.counter.count("newsletterUnsuccessfulRequest")}})}});t.exports=h}).call(e,n(1),n(2))},function(t,e,n){(function(e,n){var i=e.View.extend({el:"body",events:{"click .rating-wrap a":"logClickRatingStars","click .content-wrap .sidebar a":"logHomePageSideBarClick","click .tbd-dropdown-menu.dropdown-menu a":"logGlobalDropdownClick"},initialize:function(){var t=this;n("[data-counter]").each(function(){var e=n(this).data("counter");e.length>1&&t.count(e)})},logClickRatingStars:function(){this.count("clickRatingStars")},logHomePageSideBarClick:function(){n("body").hasClass("page-type-home")&&this.count("sideBarClick")},logGlobalDropdownClick:function(){this.count("clickGlobalDropdownClick")},logMobileJacketLightboxClick:function(){this.count("clickJacketLightbox")},count:function(t){window.ue&&window.ue.count(t,1)}});t.exports=i}).call(e,n(1),n(2))},function(module,exports){module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)0==outcome&&(__p+='\n  <div class="modal-heading">\n\t\tError signing up to newsletter\n\t</div>\n\t<div class="modal-text red-text">\n\t\tSorry that isn\'t a valid e-mail address, please try again.\n\t</div>\n'),__p+="\n\n",1==outcome&&(__p+='\n  <div class="modal-heading">\n\t\tSigned up to newsletter\n\t</div>\n\t<div class="modal-text green-text">\n\t\tThank you - we\'ve added you to the newsletter.\n\t</div>\n'),__p+="\n\n",2==outcome&&(__p+='\n  <div class="modal-heading">\n\t\tYoure already signed up\n\t</div>\n\t<div class="modal-text red-text">\n\t\t If you\'d like to edit your contact preferences, please go to your account.\n\t</div>\n'),
__p+="\n\n",outcome==-1&&(__p+='\n  <div class="modal-heading">\n\t\tError signing up to newsletter\n\t</div>\n\t<div class="modal-text red-text">\n\t\tIt looks like we can\'t process your request at the moment. Please try again later.\n\t</div>\n'),__p+="\n";return __p}},function(t,e,n){(function(e,i){n(37);var o=n(3),s=n(38);cdnList=n(21).cdns;var a=e.Model.extend({url:function(){return this.base_url+"?searchTerm="+r(this.get("keyword"))},parse:function(t){return t.content}}),r=function(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16)})},l=e.View.extend({events:{"keyup .text-input":"keypress","click .suggest-book-wrap":"bookClick","click .bg-screen":"reset"},bookClick:function(t){location.href=i(t.currentTarget).data("url")},initialize:function(t){this.stringLocalizer=t.stringLocalizer,this.$input=this.$(".text-input"),this.$("form").attr("autocomplete","off"),this.model=new a,this.model.base_url=this.$el.data("url"),this.listenTo(this.model,"change:keyword",this.textChange),this.listenTo(this.model,"change:suggestBooks",this.booksChange),this.listenTo(this.model,"change:suggestSearch",this.searchChange),this._screen=this.$el.append("<div class='bg-screen'></div>"),this.render()},showScreen:function(){this.$(".bg-screen").hasClass("active")||this.$(".bg-screen").addClass("active")},hideScreen:function(){this.$(".bg-screen").hasClass("active")&&(this.$(".bg-screen").removeClass("active"),this.$result.addClass("no-result"))},reset:function(){this.$bookresult.empty(),this.$suggestresult.empty(),this.$options&&this.$options.empty(),this.hideScreen(),this._clearSelectedOption()},render:function(){this.$bookresult=i("<div class='book-result'></div>"),this.$suggestresult=i("<div class='suggest-result'></div>"),this.$result=i("<div class='result-wrap no-result'></div>"),this.$suggestresult.appendTo(this.$result),this.$bookresult.appendTo(this.$result),this.$result.insertAfter(this.$(".header-search-el-wrap"))},booksChange:function(t){this.$bookresult.empty(),o.each(t.get("suggestBooks"),function(t,e){t.isbn=t.books[0].isbn13,t.slug=t.title.replace(/[^a-z0-9]/gi,"-"),t.cdn=cdnList[Math.floor(Math.random()*cdnList.length)];var n=this.stringLocalizer.localizeTemplate(s(t));this.$bookresult.append("<div class='suggestion suggest-book'>"+n+"</div>")},this),this._optionsChanged()},searchChange:function(t){this.$suggestresult.empty();var e=t.get("suggestSearch");e.length>0?(this.$result.removeClass("no-result"),this.showScreen()):(this.$result.addClass("no-result"),this.hideScreen()),o.each(e,function(t,e){var n=i("<a class='suggestion suggest-word'>"+t+"</a>");n.attr("href",this.stringLocalizer.localizedLink("/search?searchTerm="+r(n.text())+"&search=Find+book")),this.$suggestresult.append(n)},this),this._optionsChanged()},textChange:function(){this.model.get("keyword").length>1?this.model.fetch():this.reset()},_optionsChanged:function(){this.$options=this.$el.find(".suggest-result a, .book-result .suggestion"),this.$selectedOption=null},keypress:function(t){13==t.keyCode?this.$selectedOption&&(this.$selectedOption.is("a")?this.$selectedOption.click():this.$selectedOption.find("h4 a").first().click()):27==t.keyCode?this.reset():38==t.keyCode?this._moveToOption(-1):40==t.keyCode?this._moveToOption(1):this.model.set("keyword",this.$input.val())},_moveToOption:function(t){if((!(t<0)||this.$selectedOption)&&(this.$selectedOption&&this.$selectedOption.removeClass("selected"),this.$options)){var e=0;this.$selectedOption&&(e=this.$options.index(this.$selectedOption)+t),e<0?this._clearSelectedOption():e>=this.$options.size()?this._selectOption(i(this.$options.get(this.$options.size()-1))):this._selectOption(i(this.$options.get(e)))}},_selectOption:function(t){this.$selectedOption=t,this.$selectedOption.addClass("selected");var e;e=this.$selectedOption.is("a")?this.$selectedOption.text():this.$selectedOption.find("h4 a").first().text(),this.$input.val(e.trim())},_clearSelectedOption:function(){this.$selectedOption&&(this.$selectedOption.removeClass("selected"),this.$selectedOption=null)}});t.exports=l}).call(e,n(1),n(2))},function(t,e){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}},function(module,exports,__webpack_require__){(function(_){module.exports=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="suggest-book-wrap link-to-localize" data-url="/'+__e(slug)+"/"+__e(isbn)+'">\n\t<div class="book-img-wrap">\n\t\t<a href="/'+__e(slug)+"/"+__e(isbn)+'" class="suggest-link-block link-to-localize">\n\t\t\t<img src="https://'+__e(cdn)+".cloudfront.net/assets/images/book/sml/"+__e(isbn.substr(0,4))+"/"+__e(isbn.substr(4,4))+"/"+__e(isbn)+'.jpg" alt="'+__e(title)+'">\n\t\t</a>\n\t</div>\n\t<div class="book-content-wrap">\n\t\t<h4><a href="/'+__e(slug)+"/"+__e(isbn)+'" class="link-to-localize">'+__e(title)+"</a></h4>\n\t\t",contributors.length>0&&(__p+='\n            <p class="author">by '+__e(contributors)+"</p>\n        "),__p+='\n\t\t<ul class="formats">\n\t\t\t',books.forEach(function(t){__p+='\n\t\t\t\t<li><a href="/'+__e(slug)+"/"+__e(t.isbn13)+'" class="link-to-localize">'+__e(t.format)+"</a></li>\n\t\t\t"}),__p+="\n\t\t</ul>\n\t</div>\n</div>";return __p}}).call(exports,__webpack_require__(3))},function(t,e,n){(function(e,i){n(37),n(40),n(41),n(4);var o=n(42),s=n(34),a=e.View.extend({events:{"blur .validate":"validateField"},emailRegex:"^[\\p{L}\\p{N}\\._%+-]+@[\\p{L}\\p{N}\\.\\-]+\\.[\\p{L}]{2,}$",fullNameRegex:"^(?=.*[\\p{L}])[\\p{L}\\s',.\\-]*$",initialize:function(t){this.counter=new s,this.stringLocalizer=t.stringLocalizer;var e=this.stringLocalizer.localizeString("bd_js_enter_valid_email_address","Please enter a valid email address"),n=this.stringLocalizer.localizeString("bd_js_too_long","Sorry, that's too long"),o=this.stringLocalizer.localizeString("bd_js_name_only_letters","Sorry, full name can only contain letters"),a=this.stringLocalizer.localizeString("bd_js_enter_first_last_name","Please enter a first and last name");this.emailValidations={},this.emailValidations.mandatory=!0,this.emailValidations.validation=[{regex:"emailAddress",message:e}],this.emailValidations.tooLongMessage=n,this.emailValidations.maxLength=50,this.fullNameValidation={},this.fullNameValidation.mandatory=!0,this.fullNameValidation.validation=[{regex:this.fullNameRegex,message:o}],this.fullNameValidation.fieldEmptyMessage=a,this.fullNameValidation.maxLength=50,i(".no-delivery-country-selected #hasSubmittedSameAddresses").click(function(t){t.preventDefault()})},validateField:function(t){var e=i(t.currentTarget),n=this._validate(e);this._clearMinimalAddresses(e),n.length>0?this._showErrors(e,n):(this._clearErrors(e),this._copyEmailAddress(e))},_clearErrors:function(t){t.removeClass("checkout-error"),t.next(".error-block").html("")},_showErrors:function(t,e){t.addClass("checkout-error"),t.next(".error-block").html(e.join(". "))},_validate:function(t){var e=[],n=this._getFieldValidations(t);return this._validateLength(t,n,e),0==e.length&&this._validateWWW(t,e),0==e.length&&this._validateFieldValue(t,n,e),e},_getFieldValidations:function(t){var e=t.data("field-name");if("emailAddr"==e)return this.emailValidations;if("fullName"==e)return this.fullNameValidation;var n;return n="delivery"==t.data("addr-type")?getDeliveryValidations():getBillingValidations(),n[e]},_validateLength:function(t,e,n){var o=this.stringLocalizer.localizeString("bd_js_please_enter_your","Please enter your"),s=this.stringLocalizer.localizeString("bd_js_too_long_for_shipping_label","Sorry, that's too long for our shipping labels"),a=t.val().trim();if(e.mandatory&&0==a.length){var r=i("label[for='"+t.attr("name")+"']");if(e.fieldEmptyMessage)n.push(e.fieldEmptyMessage);else{var l=this._getLabelForErrorMsg(r.text());n.push(o+" "+l)}}else e.maxLength&&a.length>e.maxLength&&(e.tooLongMessage?n.push(e.tooLongMessage):n.push(s),this.counter.count("clientSideValidationFieldTooLong"))},_getLabelForErrorMsg:function(t){var e=t.toLowerCase();return e.replace("zip","ZIP")},_validateWWW:function(t,e){var n=t.val().trim();if(n.startsWith("www")||n.startsWith("http")){var o=i("label[for='"+t.attr("name")+"']");e.push(o.text()+" format is invalid")}},_validateFieldValue:function(t,e,n){var i=this,s=t.val().trim();if(s.length>0){var a=e.validation;a&&a.forEach(function(t){var e;e="emailAddress"==t.regex?o.cache(i.emailRegex):i._createRegex(t.regex),e.test(s)||(this.counter.count("clientSideValidationInvalidField"),n.push(t.message))})}},_createRegex:function(t){return t.indexOf("(?i)")!=-1||t.indexOf("(?-i)")!=-1?o.cache(t.replace("(?i)","").replace("(?-i)",""),"i"):o.cache(t)},_clearMinimalAddresses:function(t){if(this._isMinimalAddress(t)){var e=this,n=this._fetchMinimalAddresses(t);n.map(function(n){var o=i("#"+n+" input");n==t.attr("name")||o.val()||e._clearErrors(o)})}},_isMinimalAddress:function(t){return this._getFieldValidations(t).minimalAddress},_fetchMinimalAddresses:function(t){var e;return e="delivery"==t.data("addr-type")?getDeliveryMinimalAddresses():getBillingMinimalAddresses()},_copyEmailAddress:function(t){if("emailAddr"==t.data("field-name")){var e=i("#delivery-emailAddress .validate");e.length&&0==e.val().length&&(e.val(t.val()),this._clearErrors(e))}}});t.exports=a}).call(e,n(1),n(2))},function(t,e){Array.prototype.forEach=function(t){if(void 0===this||null===this)throw new TypeError(this+"is not an object");if(!(t instanceof Function))throw new TypeError(t+" is not a function");for(var e=Object(this),n=arguments[1],i=e instanceof String?e.split(""):e,o=Math.max(Math.min(i.length,9007199254740991),0)||0,s=-1;++s<o;)s in i&&t.call(n,i[s],s,e)}},function(t,e){Array.prototype.indexOf=function(t){if(void 0===this||null===this)throw new TypeError(this+"is not an object");var e=this instanceof String?this.split(""):this,n=Math.max(Math.min(e.length,9007199254740991),0)||0,i=Number(arguments[1])||0;for(i=(i<0?Math.max(n+i,0):i)-1;++i<n;)if(i in e&&e[i]===t)return i;return-1}},function(t,e,n){var i=n(43);n(44)(i),n(45)(i),n(46)(i),n(47)(i),n(48)(i),n(49)(i),n(50)(i),t.exports=i},function(t,e){/*!
	 * XRegExp 3.1.1
	 * <xregexp.com>
	 * Steven Levithan (c) 2007-2016 MIT License
	 */
"use strict";function n(t){var e=!0;try{new RegExp("",t)}catch(t){e=!1}return e&&"y"===t?new RegExp("aa|.","y").test("b"):e}function i(t,e,n,i,o){var s;if(t[x]={captureNames:e},o)return t;if(t.__proto__)t.__proto__=w.prototype;else for(s in w.prototype)t[s]=w.prototype[s];return t[x].source=n,t[x].flags=i?i.split("").sort().join(""):i,t}function o(t){return P.replace.call(t,/([\s\S])(?=[\s\S]*\1)/g,"")}function s(t,e){if(!w.isRegExp(t))throw new TypeError("Type RegExp expected");var n=t[x]||{},s=r(t),a="",h="",c=null,u=null;return e=e||{},e.removeG&&(h+="g"),e.removeY&&(h+="y"),h&&(s=P.replace.call(s,new RegExp("["+h+"]+","g"),"")),e.addG&&(a+="g"),e.addY&&(a+="y"),a&&(s=o(s+a)),e.isInternalOnly||(void 0!==n.source&&(c=n.source),null!=n.flags&&(u=a?o(n.flags+a):n.flags)),t=i(new RegExp(t.source,s),l(t)?n.captureNames.slice(0):null,c,u,e.isInternalOnly)}function a(t){return parseInt(t,16)}function r(t){return z?t.flags:P.exec.call(/\/([a-z]*)$/i,RegExp.prototype.toString.call(t))[1]}function l(t){return!(!t[x]||!t[x].captureNames)}function h(t){return parseInt(t,10).toString(16)}function c(t,e){var n,i=t.length;for(n=0;n<i;++n)if(t[n]===e)return n;return-1}function u(t,e){return O.call(t)==="[object "+e+"]"}function d(t,e,n){return P.test.call(n.indexOf("x")>-1?/^(?:\s|#[^#\n]*|\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/:/^(?:\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/,t.slice(e))}function p(t){for(;t.length<4;)t="0"+t;return t}function m(t,e){var n;if(o(e)!==e)throw new SyntaxError("Invalid duplicate regex flag "+e);for(t=P.replace.call(t,/^\(\?([\w$]+)\)/,function(t,n){if(P.test.call(/[gy]/,n))throw new SyntaxError("Cannot use flag g or y in mode modifier "+t);return e=o(e+n),""}),n=0;n<e.length;++n)if(!N[e.charAt(n)])throw new SyntaxError("Unknown regex flag "+e.charAt(n));return{pattern:t,flags:e}}function _(t){var e={};return u(t,"String")?(w.forEach(t,/[^\s,]+/,function(t){e[t]=!0}),e):t}function f(t){if(!/^[\w$]$/.test(t))throw new Error("Flag must be a single character A-Za-z0-9_$");N[t]=!0}function g(t,e,n,i,o){for(var s,a,r=k.length,l=t.charAt(n),h=null;r--;)if(a=k[r],!(a.leadChar&&a.leadChar!==l||a.scope!==i&&"all"!==a.scope||a.flag&&e.indexOf(a.flag)===-1)&&(s=w.exec(t,a.regex,n,"sticky"))){h={matchLength:s[0].length,output:a.handler.call(o,s,i,e),reparse:a.reparse};break}return h}function v(t){L.astral=t}function y(t){RegExp.prototype.exec=(t?C:P).exec,RegExp.prototype.test=(t?C:P).test,String.prototype.match=(t?C:P).match,String.prototype.replace=(t?C:P).replace,String.prototype.split=(t?C:P).split,L.natives=t}function b(t){if(null==t)throw new TypeError("Cannot convert null or undefined to object");return t}function w(t,e){if(w.isRegExp(t)){if(void 0!==e)throw new TypeError("Cannot supply flags when copying a RegExp");return s(t)}if(t=void 0===t?"":String(t),e=void 0===e?"":String(e),w.isInstalled("astral")&&e.indexOf("A")===-1&&(e+="A"),E[t]||(E[t]={}),!E[t][e]){for(var n,o={hasNamedCapture:!1,captureNames:[]},a=T,r="",l=0,h=m(t,e),c=h.pattern,u=h.flags;l<c.length;){do n=g(c,u,l,a,o),n&&n.reparse&&(c=c.slice(0,l)+n.output+c.slice(l+n.matchLength));while(n&&n.reparse);if(n)r+=n.output,l+=n.matchLength||1;else{var d=w.exec(c,M[a],l,"sticky")[0];r+=d,l+=d.length,"["===d&&a===T?a=I:"]"===d&&a===I&&(a=T)}}E[t][e]={pattern:P.replace.call(r,/(?:\(\?:\))+/g,"(?:)"),flags:P.replace.call(u,/[^gimuy]+/g,""),captures:o.hasNamedCapture?o.captureNames:null}}var p=E[t][e];return i(new RegExp(p.pattern,p.flags),p.captures,t,e)}var x="xregexp",L={astral:!1,natives:!1},P={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},C={},S={},E={},k=[],T="default",I="class",M={default:/\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u(?:[\dA-Fa-f]{4}|{[\dA-Fa-f]+})|c[A-Za-z]|[\s\S])|\(\?(?:[:=!]|<[=!])|[?*+]\?|{\d+(?:,\d*)?}\??|[\s\S]/,class:/\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u(?:[\dA-Fa-f]{4}|{[\dA-Fa-f]+})|c[A-Za-z]|[\s\S])|[\s\S]/},A=/\$(?:{([\w$]+)}|(\d\d?|[\s\S]))/g,D=void 0===P.exec.call(/()??/,"")[1],z=void 0!==/x/.flags,O={}.toString,B=n("u"),U=n("y"),N={g:!0,i:!0,m:!0,u:B,y:U};w.prototype=new RegExp,w.version="3.1.1",w._hasNativeFlag=n,w._dec=a,w._hex=h,w._pad4=p,w.addToken=function(t,e,n){n=n||{};var i,o=n.optionalFlags;if(n.flag&&f(n.flag),o)for(o=P.split.call(o,""),i=0;i<o.length;++i)f(o[i]);k.push({regex:s(t,{addG:!0,addY:U,isInternalOnly:!0}),handler:e,scope:n.scope||T,flag:n.flag,reparse:n.reparse,leadChar:n.leadChar}),w.cache.flush("patterns")},w.cache=function(t,e){return S[t]||(S[t]={}),S[t][e]||(S[t][e]=w(t,e))},w.cache.flush=function(t){"patterns"===t?E={}:S={}},w.escape=function(t){return P.replace.call(b(t),/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},w.exec=function(t,e,n,i){var o,a,r="g",l=!1;return l=U&&!!(i||e.sticky&&i!==!1),l&&(r+="y"),e[x]=e[x]||{},a=e[x][r]||(e[x][r]=s(e,{addG:!0,addY:l,removeY:i===!1,isInternalOnly:!0})),a.lastIndex=n=n||0,o=C.exec.call(a,t),i&&o&&o.index!==n&&(o=null),e.global&&(e.lastIndex=o?a.lastIndex:0),o},w.forEach=function(t,e,n){for(var i,o=0,s=-1;i=w.exec(t,e,o);)n(i,++s,t,e),o=i.index+(i[0].length||1)},w.globalize=function(t){return s(t,{addG:!0})},w.install=function(t){t=_(t),!L.astral&&t.astral&&v(!0),!L.natives&&t.natives&&y(!0)},w.isInstalled=function(t){return!!L[t]},w.isRegExp=function(t){return"[object RegExp]"===O.call(t)},w.match=function(t,e,n){var i,o,a=e.global&&"one"!==n||"all"===n,r=(a?"g":"")+(e.sticky?"y":"")||"noGY";return e[x]=e[x]||{},o=e[x][r]||(e[x][r]=s(e,{addG:!!a,removeG:"one"===n,isInternalOnly:!0})),i=P.match.call(b(t),o),e.global&&(e.lastIndex="one"===n&&i?i.index+i[0].length:0),a?i||[]:i&&i[0]},w.matchChain=function(t,e){return function t(n,i){function o(t){if(s.backref){if(!(t.hasOwnProperty(s.backref)||+s.backref<t.length))throw new ReferenceError("Backreference to undefined group: "+s.backref);a.push(t[s.backref]||"")}else a.push(t[0])}for(var s=e[i].regex?e[i]:{regex:e[i]},a=[],r=0;r<n.length;++r)w.forEach(n[r],s.regex,o);return i!==e.length-1&&a.length?t(a,i+1):a}([t],0)},w.replace=function(t,e,n,i){var o,a=w.isRegExp(e),r=e.global&&"one"!==i||"all"===i,l=(r?"g":"")+(e.sticky?"y":"")||"noGY",h=e;return a?(e[x]=e[x]||{},h=e[x][l]||(e[x][l]=s(e,{addG:!!r,removeG:"one"===i,isInternalOnly:!0}))):r&&(h=new RegExp(w.escape(String(e)),"g")),o=C.replace.call(b(t),h,n),a&&e.global&&(e.lastIndex=0),o},w.replaceEach=function(t,e){var n,i;for(n=0;n<e.length;++n)i=e[n],t=w.replace(t,i[0],i[1],i[2]);return t},w.split=function(t,e,n){return C.split.call(b(t),e,n)},w.test=function(t,e,n,i){return!!w.exec(t,e,n,i)},w.uninstall=function(t){t=_(t),L.astral&&t.astral&&v(!1),L.natives&&t.natives&&y(!1)},w.union=function(t,e){function n(t,e,n){var a=o[s-i];if(e){if(++s,a)return"(?<"+a+">"}else if(n)return"\\"+(+n+i);return t}var i,o,s=0;if(!u(t,"Array")||!t.length)throw new TypeError("Must provide a nonempty array of patterns to merge");for(var a,r=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,l=[],h=0;h<t.length;++h)a=t[h],w.isRegExp(a)?(i=s,o=a[x]&&a[x].captureNames||[],l.push(P.replace.call(w(a.source).source,r,n))):l.push(w.escape(a));return w(l.join("|"),e)},C.exec=function(t){var e,n,i,o=this.lastIndex,a=P.exec.apply(this,arguments);if(a){if(!D&&a.length>1&&c(a,"")>-1&&(n=s(this,{removeG:!0,isInternalOnly:!0}),P.replace.call(String(t).slice(a.index),n,function(){var t,e=arguments.length;for(t=1;t<e-2;++t)void 0===arguments[t]&&(a[t]=void 0)})),this[x]&&this[x].captureNames)for(i=1;i<a.length;++i)e=this[x].captureNames[i-1],e&&(a[e]=a[i]);this.global&&!a[0].length&&this.lastIndex>a.index&&(this.lastIndex=a.index)}return this.global||(this.lastIndex=o),a},C.test=function(t){return!!C.exec.call(this,t)},C.match=function(t){var e;if(w.isRegExp(t)){if(t.global)return e=P.match.apply(this,arguments),t.lastIndex=0,e}else t=new RegExp(t);return C.exec.call(t,b(this))},C.replace=function(t,e){var n,i,o,s=w.isRegExp(t);return s?(t[x]&&(i=t[x].captureNames),n=t.lastIndex):t+="",o=u(e,"Function")?P.replace.call(String(this),t,function(){var n,o=arguments;if(i)for(o[0]=new String(o[0]),n=0;n<i.length;++n)i[n]&&(o[0][i[n]]=o[n+1]);return s&&t.global&&(t.lastIndex=o[o.length-2]+o[0].length),e.apply(void 0,o)}):P.replace.call(null==this?this:String(this),t,function(){var t=arguments;return P.replace.call(String(e),A,function(e,n,o){var s;if(n){if(s=+n,s<=t.length-3)return t[s]||"";if(s=i?c(i,n):-1,s<0)throw new SyntaxError("Backreference to undefined group "+e);return t[s+1]||""}if("$"===o)return"$";if("&"===o||0===+o)return t[0];if("`"===o)return t[t.length-1].slice(0,t[t.length-2]);if("'"===o)return t[t.length-1].slice(t[t.length-2]+t[0].length);if(o=+o,!isNaN(o)){if(o>t.length-3)throw new SyntaxError("Backreference to undefined group "+e);return t[o]||""}throw new SyntaxError("Invalid token "+e)})}),s&&(t.global?t.lastIndex=0:t.lastIndex=n),o},C.split=function(t,e){if(!w.isRegExp(t))return P.split.apply(this,arguments);var n,i=String(this),o=[],s=t.lastIndex,a=0;return e=(void 0===e?-1:e)>>>0,w.forEach(i,t,function(t){t.index+t[0].length>a&&(o.push(i.slice(a,t.index)),t.length>1&&t.index<i.length&&Array.prototype.push.apply(o,t.slice(1)),n=t[0].length,a=t.index+n)}),a===i.length?P.test.call(t,"")&&!n||o.push(""):o.push(i.slice(a)),t.lastIndex=s,o.length>e?o.slice(0,e):o},w.addToken(/\\([ABCE-RTUVXYZaeg-mopqyz]|c(?![A-Za-z])|u(?![\dA-Fa-f]{4}|{[\dA-Fa-f]+})|x(?![\dA-Fa-f]{2}))/,function(t,e){if("B"===t[1]&&e===T)return t[0];throw new SyntaxError("Invalid escape "+t[0])},{scope:"all",leadChar:"\\"}),w.addToken(/\\u{([\dA-Fa-f]+)}/,function(t,e,n){var i=a(t[1]);if(i>1114111)throw new SyntaxError("Invalid Unicode code point "+t[0]);if(i<=65535)return"\\u"+p(h(i));if(B&&n.indexOf("u")>-1)return t[0];throw new SyntaxError("Cannot use Unicode code point above \\u{FFFF} without flag u")},{scope:"all",leadChar:"\\"}),w.addToken(/\[(\^?)]/,function(t){return t[1]?"[\\s\\S]":"\\b\\B"},{leadChar:"["}),w.addToken(/\(\?#[^)]*\)/,function(t,e,n){return d(t.input,t.index+t[0].length,n)?"":"(?:)"},{leadChar:"("}),w.addToken(/\s+|#[^\n]*\n?/,function(t,e,n){return d(t.input,t.index+t[0].length,n)?"":"(?:)"},{flag:"x"}),w.addToken(/\./,function(){return"[\\s\\S]"},{flag:"s",leadChar:"."}),w.addToken(/\\k<([\w$]+)>/,function(t){var e=isNaN(t[1])?c(this.captureNames,t[1])+1:+t[1],n=t.index+t[0].length;if(!e||e>this.captureNames.length)throw new SyntaxError("Backreference to undefined group "+t[0]);return"\\"+e+(n===t.input.length||isNaN(t.input.charAt(n))?"":"(?:)")},{leadChar:"\\"}),w.addToken(/\\(\d+)/,function(t,e){if(!(e===T&&/^[1-9]/.test(t[1])&&+t[1]<=this.captureNames.length)&&"0"!==t[1])throw new SyntaxError("Cannot use octal escape or backreference to undefined group "+t[0]);return t[0]},{scope:"all",leadChar:"\\"}),w.addToken(/\(\?P?<([\w$]+)>/,function(t){if(!isNaN(t[1]))throw new SyntaxError("Cannot use integer as capture name "+t[0]);if("length"===t[1]||"__proto__"===t[1])throw new SyntaxError("Cannot use reserved word as capture name "+t[0]);if(c(this.captureNames,t[1])>-1)throw new SyntaxError("Cannot use same name for multiple groups "+t[0]);return this.captureNames.push(t[1]),this.hasNamedCapture=!0,"("},{leadChar:"("}),w.addToken(/\((?!\?)/,function(t,e,n){return n.indexOf("n")>-1?"(?:":(this.captureNames.push(null),"(")},{optionalFlags:"n",leadChar:"("}),t.exports=w},function(t,e){/*!
	 * XRegExp.build 3.1.1
	 * <xregexp.com>
	 * Steven Levithan (c) 2012-2016 MIT License
	 * Inspired by Lea Verou's RegExp.create <lea.verou.me>
	 */
t.exports=function(t){"use strict";function e(t){var e=/^(?:\(\?:\))*\^/,n=/\$(?:\(\?:\))*$/;return e.test(t)&&n.test(t)&&n.test(t.replace(/\\[\s\S]/g,""))?t.replace(e,"").replace(n,""):t}function n(e){return t.isRegExp(e)?e[i]&&e[i].captureNames?e:t(e.source):t(e)}var i="xregexp",o=/(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g,s=t.union([/\({{([\w$]+)}}\)|{{([\w$]+)}}/,o],"g");t.build=function(a,r,l){var h,c,u,d,p=/^\(\?([\w$]+)\)/.exec(a),m={},_=0,f=0,g=[0];p&&(l=l||"",p[1].replace(/./g,function(t){l+=l.indexOf(t)>-1?"":t}));for(d in r)r.hasOwnProperty(d)&&(u=n(r[d]),m[d]={pattern:e(u.source),names:u[i].captureNames||[]});return a=n(a),c=a[i].captureNames||[],a=a.source.replace(s,function(t,e,n,i,s){var a,r,l,u=e||n;if(u){if(!m.hasOwnProperty(u))throw new ReferenceError("Undefined property "+t);return e?(a=c[f],g[++f]=++_,r="(?<"+(a||u)+">"):r="(?:",h=_,r+m[u].pattern.replace(o,function(t,e,n){if(e){if(a=m[u].names[_-h],++_,a)return"(?<"+a+">"}else if(n)return l=+n-1,m[u].names[l]?"\\k<"+m[u].names[l]+">":"\\"+(+n+h);return t})+")"}if(i){if(a=c[f],g[++f]=++_,a)return"(?<"+a+">"}else if(s)return l=+s-1,c[l]?"\\k<"+c[l]+">":"\\"+g[+s];return t}),t(a,l)}}},function(t,e){/*!
	 * XRegExp.matchRecursive 3.1.1
	 * <xregexp.com>
	 * Steven Levithan (c) 2009-2016 MIT License
	 */
t.exports=function(t){"use strict";function e(t,e,n,i){return{name:t,value:e,start:n,end:i}}t.matchRecursive=function(n,i,o,s,a){s=s||"",a=a||{};var r,l,h,c,u,d=s.indexOf("g")>-1,p=s.indexOf("y")>-1,m=s.replace(/y/g,""),_=a.escapeChar,f=a.valueNames,g=[],v=0,y=0,b=0,w=0;if(i=t(i,m),o=t(o,m),_){if(_.length>1)throw new Error("Cannot use more than one escape character");_=t.escape(_),u=new RegExp("(?:"+_+"[\\S\\s]|(?:(?!"+t.union([i,o]).source+")[^"+_+"])+)+",s.replace(/[^imu]+/g,""))}for(;;){if(_&&(b+=(t.exec(n,u,b,"sticky")||[""])[0].length),h=t.exec(n,i,b),c=t.exec(n,o,b),h&&c&&(h.index<=c.index?c=null:h=null),h||c)y=(h||c).index,b=y+(h||c)[0].length;else if(!v)break;if(p&&!v&&y>w)break;if(h)v||(r=y,l=b),++v;else{if(!c||!v)throw new Error("Unbalanced delimiter found in string");if(!--v&&(f?(f[0]&&r>w&&g.push(e(f[0],n.slice(w,r),w,r)),f[1]&&g.push(e(f[1],n.slice(r,l),r,l)),f[2]&&g.push(e(f[2],n.slice(l,y),l,y)),f[3]&&g.push(e(f[3],n.slice(y,b),y,b))):g.push(n.slice(l,y)),w=b,!d))break}y===b&&++b}return d&&!p&&f&&f[0]&&n.length>w&&g.push(e(f[0],n.slice(w),w,n.length)),g}}},function(t,e){/*!
	 * XRegExp Unicode Base 3.1.1
	 * <xregexp.com>
	 * Steven Levithan (c) 2008-2016 MIT License
	 */
t.exports=function(t){"use strict";function e(t){return t.replace(/[- _]+/g,"").toLowerCase()}function n(t){var e=/^\\[xu](.+)/.exec(t);return e?l(e[1]):t.charCodeAt("\\"===t.charAt(0)?1:0)}function i(e){var i="",o=-1;return t.forEach(e,/(\\x..|\\u....|\\?[\s\S])(?:-(\\x..|\\u....|\\?[\s\S]))?/,function(t){var e=n(t[1]);e>o+1&&(i+="\\u"+c(h(o+1)),e>o+2&&(i+="-\\u"+c(h(e-1)))),o=n(t[2]||t[1])}),o<65535&&(i+="\\u"+c(h(o+1)),o<65534&&(i+="-\\uFFFF")),i}function o(t){var e="b!";return r[t][e]||(r[t][e]=i(r[t].bmp))}function s(t,e){var n=r[t],i="";return n.bmp&&!n.isBmpLast&&(i="["+n.bmp+"]"+(n.astral?"|":"")),n.astral&&(i+=n.astral),n.isBmpLast&&n.bmp&&(i+=(n.astral?"|":"")+"["+n.bmp+"]"),e?"(?:(?!"+i+")(?:[-][-]|[\0-]))":"(?:"+i+")"}function a(t,e){var n=e?"a!":"a=";return r[t][n]||(r[t][n]=s(t,e))}var r={},l=t._dec,h=t._hex,c=t._pad4;t.addToken(/\\([pP])(?:{(\^?)([^}]*)}|([A-Za-z]))/,function(t,n,i){var s="Invalid double negation ",l="Unknown Unicode token ",h="Unicode token missing data ",c="Astral mode required for Unicode token ",u="Astral mode does not support Unicode tokens within character classes",d="P"===t[1]||!!t[2],p=i.indexOf("A")>-1,m=e(t[4]||t[3]),_=r[m];if("P"===t[1]&&t[2])throw new SyntaxError(s+t[0]);if(!r.hasOwnProperty(m))throw new SyntaxError(l+t[0]);if(_.inverseOf){if(m=e(_.inverseOf),!r.hasOwnProperty(m))throw new ReferenceError(h+t[0]+" -> "+_.inverseOf);_=r[m],d=!d}if(!_.bmp&&!p)throw new SyntaxError(c+t[0]);if(p){if("class"===n)throw new SyntaxError(u);return a(m,d)}return"class"===n?d?o(m):_.bmp:(d?"[^":"[")+_.bmp+"]"},{scope:"all",optionalFlags:"A",leadChar:"\\"}),t.addUnicodeData=function(n){var i,o,s="Unicode token requires name",a="Unicode token has no character data ";for(o=0;o<n.length;++o){if(i=n[o],!i.name)throw new Error(s);if(!(i.inverseOf||i.bmp||i.astral))throw new Error(a+i.name);r[e(i.name)]=i,i.alias&&(r[e(i.alias)]=i)}t.cache.flush("patterns")}}},function(t,e){/*!
	 * XRegExp Unicode Blocks 3.1.1
	 * <xregexp.com>
	 * Steven Levithan (c) 2010-2016 MIT License
	 * Unicode data by Mathias Bynens <mathiasbynens.be>
	 */
t.exports=function(t){"use strict";if(!t.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Blocks");t.addUnicodeData([{name:"InAegean_Numbers",astral:"[-]"},{name:"InAhom",astral:"[-]"},{name:"InAlchemical_Symbols",astral:"[-]"},{name:"InAlphabetic_Presentation_Forms",bmp:"-"},{name:"InAnatolian_Hieroglyphs",astral:"[-]"},{name:"InAncient_Greek_Musical_Notation",astral:"[-]"},{name:"InAncient_Greek_Numbers",astral:"[-]"},{name:"InAncient_Symbols",astral:"[-]"},{name:"InArabic",bmp:"-"},{name:"InArabic_Extended_A",bmp:"-"},{name:"InArabic_Mathematical_Alphabetic_Symbols",astral:"[-]"},{name:"InArabic_Presentation_Forms_A",bmp:"-"},{name:"InArabic_Presentation_Forms_B",bmp:"-\ufeff"},{name:"InArabic_Supplement",bmp:"-"},{name:"InArmenian",bmp:"-"},{name:"InArrows",bmp:"-"},{name:"InAvestan",astral:"[-]"},{name:"InBalinese",bmp:"-"},{name:"InBamum",bmp:"-"},{name:"InBamum_Supplement",astral:"[-]"},{name:"InBasic_Latin",bmp:"\0-"},{name:"InBassa_Vah",astral:"[-]"},{name:"InBatak",bmp:"-"},{name:"InBengali",bmp:"-"},{name:"InBlock_Elements",bmp:"-"},{name:"InBopomofo",bmp:"-"},{name:"InBopomofo_Extended",bmp:"-"},{name:"InBox_Drawing",bmp:"-"},{name:"InBrahmi",astral:"[-]"},{name:"InBraille_Patterns",bmp:"-"},{name:"InBuginese",bmp:"-"},{name:"InBuhid",bmp:"-"},{name:"InByzantine_Musical_Symbols",astral:"[-]"},{name:"InCJK_Compatibility",bmp:"-"},{name:"InCJK_Compatibility_Forms",bmp:"-"},{name:"InCJK_Compatibility_Ideographs",bmp:"-"},{name:"InCJK_Compatibility_Ideographs_Supplement",astral:"[-]"},{name:"InCJK_Radicals_Supplement",bmp:"-"},{name:"InCJK_Strokes",bmp:"-"},{name:"InCJK_Symbols_and_Punctuation",bmp:"-"},{name:"InCJK_Unified_Ideographs",bmp:"-"},{name:"InCJK_Unified_Ideographs_Extension_A",bmp:"-"},{name:"InCJK_Unified_Ideographs_Extension_B",astral:"[-][-]|[-]"},{name:"InCJK_Unified_Ideographs_Extension_C",astral:"[-]|[-][-]|[-]"},{name:"InCJK_Unified_Ideographs_Extension_D",astral:"[-]|[-]"},{name:"InCJK_Unified_Ideographs_Extension_E",astral:"[-][-]|[-]|[-]"},{name:"InCarian",astral:"[-]"},{name:"InCaucasian_Albanian",astral:"[-]"},{name:"InChakma",astral:"[-]"},{name:"InCham",bmp:"-"},{name:"InCherokee",bmp:"-"},{name:"InCherokee_Supplement",bmp:"-"},{name:"InCombining_Diacritical_Marks",bmp:"-"},{name:"InCombining_Diacritical_Marks_Extended",bmp:"-"},{name:"InCombining_Diacritical_Marks_Supplement",bmp:"-"},{name:"InCombining_Diacritical_Marks_for_Symbols",bmp:"-"},{name:"InCombining_Half_Marks",bmp:"-"},{name:"InCommon_Indic_Number_Forms",bmp:"-"},{name:"InControl_Pictures",bmp:"-"},{name:"InCoptic",bmp:"-"},{name:"InCoptic_Epact_Numbers",astral:"[-]"},{name:"InCounting_Rod_Numerals",astral:"[-]"},{name:"InCuneiform",astral:"[-]"},{name:"InCuneiform_Numbers_and_Punctuation",astral:"[-]"},{name:"InCurrency_Symbols",bmp:"-"},{name:"InCypriot_Syllabary",astral:"[-]"},{name:"InCyrillic",bmp:"-"},{name:"InCyrillic_Extended_A",bmp:"-"},{name:"InCyrillic_Extended_B",bmp:"-"},{name:"InCyrillic_Supplement",bmp:"-"},{name:"InDeseret",astral:"[-]"},{name:"InDevanagari",bmp:"-"},{name:"InDevanagari_Extended",bmp:"-"},{name:"InDingbats",bmp:"-"},{name:"InDomino_Tiles",astral:"[-]"},{name:"InDuployan",astral:"[-]"},{name:"InEarly_Dynastic_Cuneiform",astral:"[-]"},{name:"InEgyptian_Hieroglyphs",astral:"[-]|[-]"},{name:"InElbasan",astral:"[-]"},{name:"InEmoticons",astral:"[-]"},{name:"InEnclosed_Alphanumeric_Supplement",astral:"[-]"},{name:"InEnclosed_Alphanumerics",bmp:"-"},{name:"InEnclosed_CJK_Letters_and_Months",bmp:"-"},{name:"InEnclosed_Ideographic_Supplement",astral:"[-]"},{name:"InEthiopic",bmp:"-"},{name:"InEthiopic_Extended",bmp:"-"},{name:"InEthiopic_Extended_A",bmp:"-"},{name:"InEthiopic_Supplement",bmp:"-"},{name:"InGeneral_Punctuation",bmp:"-"},{name:"InGeometric_Shapes",bmp:"-"},{name:"InGeometric_Shapes_Extended",astral:"[-]"},{name:"InGeorgian",bmp:"-"},{name:"InGeorgian_Supplement",bmp:"-"},{name:"InGlagolitic",bmp:"-"},{name:"InGothic",astral:"[-]"},{name:"InGrantha",astral:"[-]"},{name:"InGreek_Extended",bmp:"-"},{name:"InGreek_and_Coptic",bmp:"-"},{name:"InGujarati",bmp:"-"},{name:"InGurmukhi",bmp:"-"},{name:"InHalfwidth_and_Fullwidth_Forms",bmp:"-"},{name:"InHangul_Compatibility_Jamo",bmp:"-"},{name:"InHangul_Jamo",bmp:"-"},{name:"InHangul_Jamo_Extended_A",bmp:"-"},{name:"InHangul_Jamo_Extended_B",bmp:"-"},{name:"InHangul_Syllables",bmp:"-"},{name:"InHanunoo",bmp:"-"},{name:"InHatran",astral:"[-]"},{name:"InHebrew",bmp:"-"},{name:"InHigh_Private_Use_Surrogates",bmp:"-"},{name:"InHigh_Surrogates",bmp:"-"},{name:"InHiragana",bmp:"-"},{name:"InIPA_Extensions",bmp:"-"},{name:"InIdeographic_Description_Characters",bmp:"-"},{name:"InImperial_Aramaic",astral:"[-]"},{name:"InInscriptional_Pahlavi",astral:"[-]"},{name:"InInscriptional_Parthian",astral:"[-]"},{name:"InJavanese",bmp:"-"},{name:"InKaithi",astral:"[-]"},{name:"InKana_Supplement",astral:"[-]"},{name:"InKanbun",bmp:"-"},{name:"InKangxi_Radicals",bmp:"-"},{name:"InKannada",bmp:"-"},{name:"InKatakana",bmp:"-"},{name:"InKatakana_Phonetic_Extensions",bmp:"-"},{name:"InKayah_Li",bmp:"-"},{name:"InKharoshthi",astral:"[-]"},{name:"InKhmer",bmp:"-"},{name:"InKhmer_Symbols",bmp:"-"},{name:"InKhojki",astral:"[-]"},{name:"InKhudawadi",astral:"[-]"},{name:"InLao",bmp:"-"},{name:"InLatin_Extended_Additional",bmp:"-"},{name:"InLatin_Extended_A",bmp:"-"},{name:"InLatin_Extended_B",bmp:"-"},{name:"InLatin_Extended_C",bmp:"-"},{name:"InLatin_Extended_D",bmp:"-"},{name:"InLatin_Extended_E",bmp:"-"},{name:"InLatin_1_Supplement",bmp:"-"},{name:"InLepcha",bmp:"-"},{name:"InLetterlike_Symbols",bmp:"-"},{name:"InLimbu",bmp:"-"},{name:"InLinear_A",astral:"[-]"},{name:"InLinear_B_Ideograms",astral:"[-]"},{name:"InLinear_B_Syllabary",astral:"[-]"},{name:"InLisu",bmp:"-"},{name:"InLow_Surrogates",bmp:"-"},{name:"InLycian",astral:"[-]"},{name:"InLydian",astral:"[-]"},{name:"InMahajani",astral:"[-]"},{name:"InMahjong_Tiles",astral:"[-]"},{name:"InMalayalam",bmp:"-"},{name:"InMandaic",bmp:"-"},{name:"InManichaean",astral:"[-]"},{name:"InMathematical_Alphanumeric_Symbols",astral:"[-]"},{name:"InMathematical_Operators",bmp:"-"},{name:"InMeetei_Mayek",bmp:"-"},{name:"InMeetei_Mayek_Extensions",bmp:"-"},{name:"InMende_Kikakui",astral:"[-]"},{name:"InMeroitic_Cursive",astral:"[-]"},{name:"InMeroitic_Hieroglyphs",astral:"[-]"},{name:"InMiao",astral:"[-]"},{name:"InMiscellaneous_Mathematical_Symbols_A",bmp:"-"},{name:"InMiscellaneous_Mathematical_Symbols_B",bmp:"-"},{name:"InMiscellaneous_Symbols",bmp:"-"},{name:"InMiscellaneous_Symbols_and_Arrows",bmp:"-"},{name:"InMiscellaneous_Symbols_and_Pictographs",astral:"[-]|[-]"},{name:"InMiscellaneous_Technical",bmp:"-"},{name:"InModi",astral:"[-]"},{name:"InModifier_Tone_Letters",bmp:"-"},{name:"InMongolian",bmp:"-"},{name:"InMro",astral:"[-]"},{name:"InMultani",astral:"[-]"},{name:"InMusical_Symbols",astral:"[-]"},{name:"InMyanmar",bmp:"-"},{name:"InMyanmar_Extended_A",bmp:"-"},{name:"InMyanmar_Extended_B",bmp:"-"},{name:"InNKo",bmp:"-"},{name:"InNabataean",astral:"[-]"},{name:"InNew_Tai_Lue",bmp:"-"},{name:"InNumber_Forms",bmp:"-"},{name:"InOgham",bmp:"-"},{name:"InOl_Chiki",bmp:"-"},{name:"InOld_Hungarian",astral:"[-]"},{name:"InOld_Italic",astral:"[-]"},{name:"InOld_North_Arabian",astral:"[-]"},{name:"InOld_Permic",astral:"[-]"},{name:"InOld_Persian",astral:"[-]"},{name:"InOld_South_Arabian",astral:"[-]"},{name:"InOld_Turkic",astral:"[-]"},{name:"InOptical_Character_Recognition",bmp:"-"},{name:"InOriya",bmp:"-"},{name:"InOrnamental_Dingbats",astral:"[-]"},{name:"InOsmanya",astral:"[-]"},{name:"InPahawh_Hmong",astral:"[-]"},{name:"InPalmyrene",astral:"[-]"},{name:"InPau_Cin_Hau",astral:"[-]"},{name:"InPhags_pa",bmp:"-"},{name:"InPhaistos_Disc",astral:"[-]"},{name:"InPhoenician",astral:"[-]"},{name:"InPhonetic_Extensions",bmp:"-"},{name:"InPhonetic_Extensions_Supplement",bmp:"-"},{name:"InPlaying_Cards",astral:"[-]"},{name:"InPrivate_Use_Area",bmp:"-"},{name:"InPsalter_Pahlavi",astral:"[-]"},{name:"InRejang",bmp:"-"},{name:"InRumi_Numeral_Symbols",astral:"[-]"},{name:"InRunic",bmp:"-"},{name:"InSamaritan",bmp:"-"},{name:"InSaurashtra",bmp:"-"},{name:"InSharada",astral:"[-]"},{name:"InShavian",astral:"[-]"},{name:"InShorthand_Format_Controls",astral:"[-]"},{name:"InSiddham",astral:"[-]"},{name:"InSinhala",bmp:"-"},{name:"InSinhala_Archaic_Numbers",astral:"[-]"},{name:"InSmall_Form_Variants",bmp:"-"},{name:"InSora_Sompeng",astral:"[-]"},{name:"InSpacing_Modifier_Letters",bmp:"-"},{name:"InSpecials",bmp:"-"},{name:"InSundanese",bmp:"-"},{name:"InSundanese_Supplement",bmp:"-"},{name:"InSuperscripts_and_Subscripts",bmp:"-"},{name:"InSupplemental_Arrows_A",bmp:"-"},{name:"InSupplemental_Arrows_B",bmp:"-"},{name:"InSupplemental_Arrows_C",astral:"[-]"},{name:"InSupplemental_Mathematical_Operators",bmp:"-"},{name:"InSupplemental_Punctuation",bmp:"-"},{name:"InSupplemental_Symbols_and_Pictographs",astral:"[-]"},{name:"InSupplementary_Private_Use_Area_A",astral:"[-][-]"},{name:"InSupplementary_Private_Use_Area_B",astral:"[-][-]"},{name:"InSutton_SignWriting",astral:"[-]"},{name:"InSyloti_Nagri",bmp:"-"},{name:"InSyriac",bmp:"-"},{name:"InTagalog",bmp:"-"},{name:"InTagbanwa",bmp:"-"},{name:"InTags",astral:"[-]"},{name:"InTai_Le",bmp:"-"},{name:"InTai_Tham",bmp:"-"},{name:"InTai_Viet",bmp:"-"},{name:"InTai_Xuan_Jing_Symbols",astral:"[-]"},{name:"InTakri",astral:"[-]"},{name:"InTamil",bmp:"-"},{name:"InTelugu",bmp:"-"},{name:"InThaana",bmp:"-"},{name:"InThai",bmp:"-"},{name:"InTibetan",bmp:"-"},{name:"InTifinagh",bmp:"-"},{name:"InTirhuta",astral:"[-]"},{name:"InTransport_and_Map_Symbols",astral:"[-]"},{name:"InUgaritic",astral:"[-]"},{name:"InUnified_Canadian_Aboriginal_Syllabics",bmp:"-"},{name:"InUnified_Canadian_Aboriginal_Syllabics_Extended",bmp:"-"},{name:"InVai",bmp:"-"},{name:"InVariation_Selectors",bmp:"-"},{name:"InVariation_Selectors_Supplement",astral:"[-]"},{name:"InVedic_Extensions",bmp:"-"},{name:"InVertical_Forms",bmp:"-"},{name:"InWarang_Citi",astral:"[-]"},{name:"InYi_Radicals",bmp:"-"},{name:"InYi_Syllables",bmp:"-"},{name:"InYijing_Hexagram_Symbols",bmp:"-"}])}},function(t,e){/*!
	 * XRegExp Unicode Categories 3.1.1
	 * <xregexp.com>
	 * Steven Levithan (c) 2010-2016 MIT License
	 * Unicode data by Mathias Bynens <mathiasbynens.be>
	 */
t.exports=function(t){"use strict";if(!t.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Categories");t.addUnicodeData([{name:"C",alias:"Other",isBmpLast:!0,bmp:"\0---------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[------]|[--]|[----------]|[-------]|[--]|[----]|[]|[-----]|[-------]|[----------------]|[-]|[------]|[-]|[--]|[----------------]|[-]|[-]|[-]|[--------][-]|[----]|[-----]|[-]|[-----------]|[---------------------]|[-]|[----]|[-]|[-]|[--------]|[-]"},{name:"Cc",alias:"Control",bmp:"\0--"},{name:"Cf",alias:"Format",bmp:"-----\ufeff-",astral:"[-]|[-]|[-]|"},{name:"Cn",alias:"Unassigned",bmp:"---------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[---]|[-----]|[----------]|[-------]|[--]|[----]|[]|[-----]|[-------]|[----------------]|[-]|[------]|[][]|[-]|[----]|[-]|[-]|[-]|[--------][-]|[----]|[-----]|[-]|[--]|[-----------]|[---------------------]|[-]|[----------------]|[-]|[-]|[--------]|[-]"},{name:"Co",alias:"Private_Use",bmp:"-",astral:"[--][-]|[][-]"},{name:"Cs",alias:"Surrogate",bmp:"-"},{name:"L",alias:"Letter",bmp:"A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[--]|[--]|[--]|[---]|[-]|[------]|[---------------]|[-]|[-]|[--]|[---][-]|[------]|[-------]|[-]|[--------------------]|[-------------------------]|[-------------------]|[-]|[--------------]|[--]|[-]|[----]|[]|[-]"},{name:"Ll",alias:"Lowercase_Letter",bmp:"a-z------------------------------------------------",astral:"[-]|[--------------------------]|[-]|[-]"},{name:"Lm",alias:"Modifier_Letter",bmp:"------------",astral:"[-]|[-]"},{name:"Lo",alias:"Other_Letter",bmp:"-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[--]|[--]|[--]|[-]|[-]|[---------------]|[-]|[-]|[-]|[---][-]|[------]|[-]|[-]|[--------------------]|[-------------------]|[-]|[--------------]|[------]|[------]|[-]|[----]|[]|[-]"},{name:"Lt",alias:"Titlecase_Letter",bmp:"---"},{name:"Lu",alias:"Uppercase_Letter",bmp:"A-Z---------------------------------------",astral:"[-]|[-]|[-]|[-----------------------]"},{name:"M",alias:"Mark",bmp:"------------------------------------------------------------------------------------------------------------",astral:"[------]|[------]|[----------------]|[--]|[--]|[]|[-]|[----]|[---]|[-]|[-]"},{name:"Mc",alias:"Spacing_Mark",bmp:"-----------------------------",astral:"[-]|[------]|[-----]|[-]"},{name:"Me",alias:"Enclosing_Mark",bmp:"---"},{name:"Mn",alias:"Nonspacing_Mark",bmp:"-------------------------------------------------------------------------------",astral:"[-------]|[-----]|[--]|[-]|[]|[-]|[----]|[---]|[------------]|[-]|[-]"},{name:"N",alias:"Number",bmp:"0-9------------------------------------------------------------",astral:"[-----]|[-]|[--]|[-]|[-]|[---]|[-]|[------]|[-]|[-]|[-]|[-------------]|[----]"},{name:"Nd",alias:"Decimal_Number",bmp:"0-9------------------------------------",astral:"[-]|[-]|[----]|[-]|[-----]|[--]"},{name:"Nl",alias:"Letter_Number",bmp:"------",astral:"[-]|[--]"},{name:"No",alias:"Other_Number",bmp:"----------------------",astral:"[--]|[--]|[-]|[-]|[-]|[-------------]|[]|[-]|[-]|[----]"},{name:"P",alias:"Punctuation",bmp:"!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}-------------------------------------------------",astral:"[----]|[-]|[---]|[-]|||[------]|[-]|[-]"},{name:"Pc",alias:"Connector_Punctuation",bmp:"_-"},{name:"Pd",alias:"Dash_Punctuation",bmp:"\\x2D-"},{name:"Pe",alias:"Close_Punctuation",bmp:"\\x29\\x5D}"},{name:"Pf",alias:"Final_Punctuation",bmp:""},{name:"Pi",alias:"Initial_Punctuation",bmp:""},{name:"Po",alias:"Other_Punctuation",bmp:"!-#%-'\\x2A,\\x2E/:;\\x3F@\\x5C----------------------------------------------",astral:"[----]|[-]|[---]|[-]|||[------]|[-]|[-]"},{name:"Ps",alias:"Open_Punctuation",bmp:"\\x28\\x5B\\x7B"},{name:"S",alias:"Symbol",bmp:"\\x24\\x2B<->\\x5E`\\x7C~-------------------------------------------------------------------------",astral:"[-------]|[-------------]|[-------]|[]|[----]|||[]|[-]|[----]|[--------]|[]"},{name:"Sc",alias:"Currency_Symbol",bmp:"\\x24--"},{name:"Sk",alias:"Modifier_Symbol",bmp:"\\x5E`----------",astral:"[-]"},{name:"Sm",alias:"Math_Symbol",bmp:"\\x2B<->\\x7C~---------------------",astral:"[]|[]"},{name:"So",alias:"Other_Symbol",bmp:"-----------------------------------------------------------",astral:"[-------]|[-------]|[-------------]|[----]|||[]|[-]|[----]|[--------]"},{name:"Z",alias:"Separator",bmp:" -\u2028\u2029"},{name:"Zl",alias:"Line_Separator",bmp:"\u2028"},{name:"Zp",alias:"Paragraph_Separator",bmp:"\u2029"},{name:"Zs",alias:"Space_Separator",bmp:" -"}])}},function(t,e){/*!
	 * XRegExp Unicode Properties 3.1.1
	 * <xregexp.com>
	 * Steven Levithan (c) 2012-2016 MIT License
	 * Unicode data by Mathias Bynens <mathiasbynens.be>
	 */
t.exports=function(t){"use strict";if(!t.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Properties");var e=[{name:"ASCII",bmp:"\0-"},{name:"Alphabetic",bmp:"A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",astral:"[--]|[---------------------]|[--]|[--]|[---]|[-]|[-------]|[------]|[---]|[-]|[-]|[---][-]|[-------------------------]|[----]|[-]|[--------------]|[--------]|[--]|[--]|[----------------]|[---------------------]|[-]|[]|[---]|[-]"},{name:"Any",isBmpLast:!0,bmp:"\0-",astral:"[-][-]"},{name:"Default_Ignorable_Code_Point",bmp:"-----\ufeff-",astral:"[-][-]|[-]|[-]"},{name:"Lowercase",bmp:"a-z----------------------------------------------------",astral:"[-]|[--------------------------]|[-]|[-]"},{name:"Noncharacter_Code_Point",bmp:"-",astral:"[][]"},{name:"Uppercase",bmp:"A-Z-----------------------------------------",astral:"[-]|[-]|[-----------------------]|[-]|[---]"},{name:"White_Space",bmp:"\t-\r -\u2028\u2029"}];e.push({name:"Assigned",inverseOf:"Cn"}),t.addUnicodeData(e)}},function(t,e){/*!
	 * XRegExp Unicode Scripts 3.1.1
	 * <xregexp.com>
	 * Steven Levithan (c) 2010-2016 MIT License
	 * Unicode data by Mathias Bynens <mathiasbynens.be>
	 */
t.exports=function(t){"use strict";if(!t.addUnicodeData)throw new ReferenceError("Unicode Base must be loaded before Unicode Scripts");t.addUnicodeData([{name:"Ahom",astral:"[---]"},{name:"Anatolian_Hieroglyphs",astral:"[-]"},{name:"Arabic",bmp:"------------------",astral:"[-]|[--------------]"},{name:"Armenian",bmp:"-----"},{name:"Avestan",astral:"[--]"},{name:"Balinese",bmp:"--"},{name:"Bamum",bmp:"-",astral:"[-]"},{name:"Bassa_Vah",astral:"[--]"},{name:"Batak",bmp:"--"},{name:"Bengali",bmp:"---------"},{name:"Bopomofo",bmp:"--"},{name:"Brahmi",astral:"[--]"},{name:"Braille",bmp:"-"},{name:"Buginese",bmp:"-"},{name:"Buhid",bmp:"-"},{name:"Canadian_Aboriginal",bmp:"--"},{name:"Carian",astral:"[-]"},{name:"Caucasian_Albanian",astral:"[-]"},{name:"Chakma",astral:"[--]"},{name:"Cham",bmp:"----"},{name:"Cherokee",bmp:"---"},{name:"Common",bmp:"\0-@\\x5B-`\\x7B---------------------------------------------------\ufeff------",astral:"[-------]|[-]|[----------------]|[-]|[-------]|[------]|[--------]|[--------------]"},{name:"Coptic",bmp:"---"},{name:"Cuneiform",astral:"[---]|[-]"},{name:"Cypriot",astral:"[--]"},{name:"Cyrillic",bmp:"----"},{name:"Deseret",astral:"[-]"},{name:"Devanagari",bmp:"----"},{name:"Duployan",astral:"[-----]"},{name:"Egyptian_Hieroglyphs",astral:"[-]|[-]"},{name:"Elbasan",astral:"[-]"},{name:"Ethiopic",bmp:"------------------------------"},{name:"Georgian",bmp:"----"},{name:"Glagolitic",bmp:"--"},{name:"Gothic",astral:"[-]"},{name:"Grantha",astral:"[----------]"},{name:"Greek",bmp:"-----------------------",astral:"[-]|[-]"},{name:"Gujarati",bmp:"-----------"},{name:"Gurmukhi",bmp:"--------"},{name:"Han",bmp:"---------",astral:"[--]|[---][-]|[--]|[-]|[--]|[-]"},{name:"Hangul",bmp:"-------------"},{name:"Hanunoo",bmp:"-"},{name:"Hatran",astral:"[--]"},{name:"Hebrew",bmp:"------"},{name:"Hiragana",bmp:"--",astral:"|"},{name:"Imperial_Aramaic",astral:"[--]"},{name:"Inherited",bmp:"------------",astral:"[----]|[]|[-]"},{name:"Inscriptional_Pahlavi",astral:"[--]"},{name:"Inscriptional_Parthian",astral:"[--]"},{name:"Javanese",bmp:"--"},{name:"Kaithi",astral:"[-]"},{name:"Kannada",bmp:"-----------"},{name:"Katakana",bmp:"-------",astral:""},{name:"Kayah_Li",bmp:"-"},{name:"Kharoshthi",astral:"[-------]"},{name:"Khmer",bmp:"----"},{name:"Khojki",astral:"[--]"},{name:"Khudawadi",astral:"[--]"},{name:"Lao",bmp:"---------"},{name:"Latin",bmp:"A-Za-z----------------------"},{name:"Lepcha",bmp:"---"},{name:"Limbu",bmp:"----"},{name:"Linear_A",astral:"[---]"},{name:"Linear_B",astral:"[------]"},{name:"Lisu",bmp:"-"},{name:"Lycian",astral:"[-]"},{name:"Lydian",astral:"[-]"},{name:"Mahajani",astral:"[-]"},{name:"Malayalam",bmp:"----------"},{name:"Mandaic",bmp:"-"},{name:"Manichaean",astral:"[--]"},{name:"Meetei_Mayek",bmp:"---"},{name:"Mende_Kikakui",astral:"[--]"},{name:"Meroitic_Cursive",astral:"[---]"},{name:"Meroitic_Hieroglyphs",astral:"[-]"},{name:"Miao",astral:"[---]"},{name:"Modi",astral:"[--]"},{name:"Mongolian",bmp:"----"},{name:"Mro",astral:"[--]"},{name:"Multani",astral:"[----]"},{name:"Myanmar",bmp:"---"},{name:"Nabataean",astral:"[--]"},{name:"New_Tai_Lue",bmp:"---"},{name:"Nko",bmp:"-"},{name:"Ogham",bmp:"-"},{name:"Ol_Chiki",bmp:"-"},{name:"Old_Hungarian",astral:"[---]"},{name:"Old_Italic",astral:"[-]"},{name:"Old_North_Arabian",astral:"[-]"},{name:"Old_Permic",astral:"[-]"},{name:"Old_Persian",astral:"[--]"},{name:"Old_South_Arabian",astral:"[-]"},{name:"Old_Turkic",astral:"[-]"},{name:"Oriya",bmp:"---------"},{name:"Osmanya",astral:"[--]"},{name:"Pahawh_Hmong",astral:"[-----]"},{name:"Palmyrene",astral:"[-]"},{name:"Pau_Cin_Hau",astral:"[-]"},{name:"Phags_Pa",bmp:"-"},{name:"Phoenician",astral:"[-]"},{name:"Psalter_Pahlavi",astral:"[---]"},{name:"Rejang",bmp:"-"},{name:"Runic",bmp:"--"},{name:"Samaritan",bmp:"--"},{name:"Saurashtra",bmp:"--"},{name:"Sharada",astral:"[--]"},{name:"Shavian",astral:"[-]"},{name:"Siddham",astral:"[--]"},{name:"SignWriting",astral:"[---]"},{name:"Sinhala",bmp:"--------",astral:"[-]"},{name:"Sora_Sompeng",astral:"[--]"},{name:"Sundanese",bmp:"--"},{name:"Syloti_Nagri",bmp:"-"},{name:"Syriac",bmp:"---"},{name:"Tagalog",bmp:"--"},{name:"Tagbanwa",bmp:"--"},{name:"Tai_Le",bmp:"--"},{name:"Tai_Tham",bmp:"-----"},{name:"Tai_Viet",bmp:"--"},{name:"Takri",astral:"[--]"},{name:"Tamil",bmp:"---------"},{name:"Telugu",bmp:"------------"},{name:"Thaana",bmp:"-"},{name:"Thai",bmp:"--"},{name:"Tibetan",bmp:"------"},{name:"Tifinagh",bmp:"-"},{name:"Tirhuta",astral:"[--]"},{name:"Ugaritic",astral:"[-]"},{name:"Vai",bmp:"-"},{name:"Warang_Citi",astral:"[-]"},{name:"Yi",bmp:"--"}])}},function(t,e,n){(function(e,i,o){n(37),n(52);var s=n(53),a=n(55),r=n(56),l=n(34),h=e.View.extend({events:{"keyup [data-field-name=addressSearch]":"keypress","keydown [data-field-name=addressSearch]":"keydown","click [data-field-name=addressSearch]":"anchorAndShowCloseBtn","click .suggest-result .suggestion":"clickOnSuggestion","click .address-bg-screen":"reset","click button.manual-address-entry":"clickManualEntryBtn","click span.manual-address-entry":"clickManualEntryOnDropdown","click .icon-close":"clearAndReset","submit #address-form":"handleFormSubmit",'change .delivery-form input[type="text"][name^="delivery-"]':"addressFieldChange"},initialize:function(t){this.counter=new l,this.app=t.app,this.stringLocalizer=t.stringLocalizer,this.$input=this.$("[data-field-name=addressSearch]"),this.suggestionsModel=new a,this.chosenAddressModel=new r,this.autoCompleteModel=new s({},{stringLocalizer:t.stringLocalizer}),this._setupCSMNames(),this._setupListeners(),this.authToken=this.$("input[name=experianToken]").val(),this._screen=this.$el.append("<div class='address-bg-screen'></div>"),this.render()},keypress:function(t){27==t.keyCode?this.clearAndReset():38==t.keyCode?this._moveToOption(-1):40==t.keyCode?this._moveToOption(1):this.suggestionsModel.set("keyword",this.$input.val())},keydown:function(t){13==t.keyCode&&this._clickOnSelectedOption(t)},textChange:function(){var t=this.suggestionsModel.get("keyword");if(this.latestExperianSearchRequest&&this.latestExperianSearchRequest.abort(),t.trim().length>0){this._logStartCall(this.experianSearchScope),this.$closeIcon.show();var e={"auth-token":this.authToken,query:t,country:i("#address-form").data("country-code")};this.latestExperianSearchRequest=this.suggestionsModel.doWrappedFetch(e)}else this.suggestionsModel.set("results",null),this.reset()},handleSuggestionsResponse:function(){if(this.suggestionsModel.isStatusSuccess()&&(this._manualAddressEntryFontWeightNormal(),this.counter.count(this.experianSuccessSearchAddress),this._logEndCall(this.experianSearchScope),this.showSuggestions()),this.suggestionsModel.isStatusFailureGeneric()){var t=this.suggestionsModel.get("responseStatus");this.counter.count(this.experianSearchError);var e=t?"."+t:".unknown";this.counter.count(this.experianSearchError+e),this._showErrorMessage(this.addressFinderUnavailableErrorMsg)}this.suggestionsModel.isStatusFailureTimeout()&&(this.counter.count(this.experianSearchTimeout),this._showErrorMessage(this.addressFinderUnavailableErrorMsg))},render:function(){var t=this.$("[data-field-name=addressSearch]");this.$suggestresult=i("<div class='suggest-result'></div>"),this.$result=i("<div class='result-wrap no-result'></div>"),this.$suggestresult.appendTo(this.$result),this.$result.insertAfter(t.parent()),this.$closeIcon=i("<i class='icon-close'/>"),this.$closeIcon.insertAfter(t),this._appendHelpText(),this._appendEnterManualAddress()},reset:function(){this.$suggestresult.empty(),this.$options&&(this.$options.not(".manual-address-entry").empty(),this._manualAddressEntryFontWeightNormal()),this._clearSelectedOption(),this._hideScreen(),this.$result.addClass("no-result"),0==this.$input.val().length&&this.$closeIcon.hide()},clearAndReset:function(){this.counter.count(this.clearedAddress),this.suggestionsModel.set("keyword",""),this.$input.val(""),this.reset(),this.$input.focus()},handleFormSubmit:function(t){if(!this.$result.hasClass("no-result"))return!1},showSuggestions:function(){this.$suggestresult.empty(),this._clearSelectedOption(),this._showHelpText();var t=this.suggestionsModel.get("results"),e=this.suggestionsModel.get("call_data"),n=e?e.query:"";t&&(1==t.length&&"undefined"!=typeof t[0].Error?(this.counter.count(this.experianSearchResultsError),this._showErrorMessage(this.addressFinderUnavailableErrorMsg)):(0==t.length&&n.length>=5?(this.counter.count("experianNoResults"),this._showErrorMessage(this.noResultsErrorMsg)):(this.$result.removeClass("no-result"),this._showScreen(),o.each(t,function(t,e){var n=i("<span class='suggestion suggest-word'></span>").attr("data-format",t.format).text(" "+t.suggestion);this.$suggestresult.append(n),i(n).dotdotdot({height:50,ellipsis:"...",wrap:"word",tolerance:0})},this)),this._optionsChanged()))},clickOnSuggestion:function(t){var e=i(t.target).html().trim();this.reset(),this._showLoadingIndicator();var n=i(t.target).data("format");this.counter.count(this.userClickedOnExperianSuggestion),this._logStartCall(this.experianCaputureScope);var o={"auth-token":this.authToken,call_url:n,selected_address:e};this.chosenAddressModel.doWrappedFetch(o),t.preventDefault()},handleChosenAddressResponse:function(){if(this.chosenAddressModel.isStatusSuccess()){var t=this.chosenAddressModel.get("address");if(t&&t.length>0){var e=this.chosenAddressModel.get("selected_address");this._mapFields(t),this.$input.val(e),this.counter.count(this.experianSuccessCaptureAddress),this.anchorOnSearchField()}}this.chosenAddressModel.isStatusFailureGeneric()&&(this.counter.count(this.experianFormatError),this._showErrorMessage(this.addressFinderUnavailableErrorMsg),this._hideLoadingIndicator()),this._logEndCall(this.experianCaputureScope)},clickManualEntryOnDropdown:function(){this.counter.count(this.manualAddressEntryOnDropdown),this.manualEntry()},clickManualEntryBtn:function(){this.counter.count(this.manualAddressEntryBtn),this.manualEntry()},manualEntry:function(){this.suggestionsModel.set("keyword",""),this.$input.val(""),this.reset(),this.anchorOnSearchField(),this._displayDeliveryForm(),i("#your-delivery-address").hide(),i("#enter-your-address").show()},anchorOnSearchField:function(){if(!app.isMobile()){var t=i("#delivery-addressSearch label");i("html,body").animate({scrollTop:i(t.get()).offset().top-10},"slow")}},anchorAndShowCloseBtn:function(t){this.anchorOnSearchField(),this.$input.val().length>0?this.$closeIcon.show():this.$closeIcon.hide(),this.showSuggestions(),t.preventDefault(),t.stopPropagation()},_hideHelpText:function(){i(".suggestion.suggest-word.help-text").hide()},_showHelpText:function(){i(".suggestion.suggest-word.help-text").show()},handleAutoCompleteResponse:function(){if(this.suggestionsModel.isStatusSuccess()){var t=this.autoCompleteModel.result;this.autocompleteMappingResponse=t,this._displayDeliveryForm(),o.each(Object.keys(t),function(e){var n=i('[name="delivery-'+e+'"]');n.val(t[e]),n.blur()}),i("#your-delivery-address").show(),i("#enter-your-address").hide(),this._hideLoadingIndicator(),this._logEndCall(self.kerouacMapScope)}this.suggestionsModel.isStatusFailureGeneric()&&(this.counter.count(self.kerouacMappingError),this._showErrorMessage(self.addressFinderUnavailableErrorMsg),this._hideLoadingIndicator())},_displayDeliveryForm:function(){var t=i(".delivery-form");t.removeClass("delivery-form-hidden"),t.find("input").removeAttr("autocomplete"),t.find("input[name='delivery-addressLine1']").attr("autocomplete","street-address"),i("button.manual-address-entry").hide(),this._resetAddressFields()},_mapFields:function(t){t.push({deliveryCountry:i("#deliveryCountryDropdown").val()});var e={};o.each(t,function(t){i.extend(e,t)},this),this._logStartCall(this.kerouacMapScope),this.autoCompleteModel.doWrappedFormPost(e,{})},_showLoadingIndicator:function(){i(".address-search-loading").removeClass("hidden")},_hideLoadingIndicator:function(){i(".address-search-loading").addClass("hidden")},_optionsChanged:function(){this.$options=this.$el.find(".suggest-result span, .suggestion-error.manual-address-entry"),this.$selectedOption=null},_moveToOption:function(t){if((!(t<0)||this.$selectedOption)&&(this.$selectedOption&&this.$selectedOption.removeClass("selected"),this.$options)){var e=0;this.$selectedOption&&(e=this.$options.index(this.$selectedOption)+t),e<0?this._clearSelectedOption():e>=this.$options.size()?this._selectOption(i(this.$options.get(this.$options.size()-1))):this._selectOption(i(this.$options.get(e)))}},_clickOnSelectedOption:function(t){this.$selectedOption&&this.$selectedOption.click(),t.preventDefault(),t.stopPropagation()},_selectOption:function(t){this.$selectedOption=t,this.$selectedOption.addClass("selected");var e={top:this.$suggestresult.offset().top,bottom:this.$suggestresult.offset().top+this.$suggestresult.outerHeight(),scrollTop:this.$suggestresult.scrollTop(),selectedTop:this.$selectedOption.offset().top,selectedBottom:this.$selectedOption.offset().top+this.$selectedOption.outerHeight(),scrollAmount:this.$selectedOption.outerHeight()};e.selectedBottom+e.scrollAmount>e.bottom?this.$suggestresult.scrollTop(e.scrollTop+e.scrollAmount):e.selectedTop-e.scrollAmount<e.top&&this.$suggestresult.scrollTop(e.scrollTop-e.scrollAmount)},_clearSelectedOption:function(){this.$selectedOption&&(this.$selectedOption.removeClass("selected"),this.$selectedOption=null)},_showErrorMessage:function(t){this._hideHelpText(),this.$suggestresult.empty();var e=i("<span class='suggestion-error'>"+t+"</span>");this.$suggestresult.append(e),this.$result.removeClass("no-result"),this._showScreen(),this._manualAddressEntryFontWeightBold()},_manualAddressEntryFontWeightBold:function(){i(".suggestion-error.manual-address-entry").addClass("bold-text")},_manualAddressEntryFontWeightNormal:function(){i(".suggestion-error.manual-address-entry").removeClass("bold-text")},_appendEnterManualAddress:function(){var t=this.stringLocalizer.localizeString("bd_js_enter_address_manually","Enter address manually"),e="<span class='suggestion-error manual-address-entry'>"+t+"</span>";this.$result.append(e)},_appendHelpText:function(){var t=this.stringLocalizer.localizeString("bd_js_keep_typing_to_refine_search_results","Keep typing to refine the search results"),e=i("<span class='suggestion suggest-word help-text'>"+t+"</span>");this.$result.prepend(e)},_resetAddressFields:function(){i(".delivery-form input").val("")},_logStartCall:function(t){window.uet&&(uet("tc",t,{wb:1}),ues("t0",t,new Date),ues("ctb",t,"1"))},_logEndCall:function(t){window.uex&&(uet("be",t),uex("ld",t,{wb:1}))},_showScreen:function(){this.$(".address-bg-screen").hasClass("active")||this.$(".address-bg-screen").addClass("active")},_hideScreen:function(){this.$(".address-bg-screen").hasClass("active")&&this.$(".address-bg-screen").removeClass("active")},_setupCSMNames:function(){this.experianSearchScope="experianSearchAddress",this.experianCaputureScope="experianCaptureAddress",this.kerouacMapScope="kerouacMapAddress",this.experianSuccessSearchAddress="experianSuccessSearchAddress",this.experianSuccessCaptureAddress="experianSuccessCaptureAddress",this.experianSearchError="experianSearchError",this.experianFormatError="experianFormatError",this.experianSearchResultsError="experianSearchResultsError",this.experianSearchTimeout="experianSearchTimeout",this.userClickedOnExperianSuggestion="userClickedOnExperianSuggestion",this.kerouacMappingError="kerouacMappingError",this.manualAddressEntryOnDropdown="manualAddressEntryOnDropdown",this.manualAddressEntryBtn="manualAddressEntryBtn",this.clearedAddress="clearedAddress",this.addressFinderUnavailableErrorMsg=this.stringLocalizer.localizeString("bd_js_unable_get_address_enter_manually","Sorry, we are unable to get the address. Please enter manually:"),this.noResultsErrorMsg=this.stringLocalizer.localizeString("bd_js_could_not_find_address_try_again","Sorry, we couldn't find the address. Please try again")},_setupListeners:function(){this.listenTo(this.suggestionsModel,"change:keyword",o.throttle(this.textChange,500)),this.listenTo(this.suggestionsModel,"change:call_status",this.handleSuggestionsResponse),this.listenTo(this.chosenAddressModel,"change:call_status",this.handleChosenAddressResponse),this.listenTo(this.autoCompleteModel,"change:call_status",this.handleAutoCompleteResponse)},addressFieldChange:function(t){var e="addressCode",n=i("[name=delivery-"+e+"]");if(n&&n.length>0)if(null!=this.autocompleteMappingResponse){var o=t.currentTarget.name,s=t.currentTarget.value,a=o.replace("delivery-",""),r=this.autocompleteMappingResponse[a];if(r&&r==s){var l=this.autocompleteMappingResponse[e];l&&n.val(l)}else n.val("")}else n.val("")}});t.exports=h}).call(e,n(1),n(2),n(3))},function(t,e){Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=n.length;return function(o){if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var s,a,r=[];for(s in o)t.call(o,s)&&r.push(s);if(e)for(a=0;a<i;a++)t.call(o,n[a])&&r.push(n[a]);return r}}()},function(t,e,n){var i=n(54),o=i.extend({selected_address:null,initialize:function(t,e){this.constructor.__super__.initialize.apply(this,arguments),this.call_url=e.stringLocalizer.localizedLink("/checkout-autocomplete-mapping"),this.result=null},_prepareDataForCall:function(t){return this.result=null,t},_processSuccessResponse:function(t,e,n){return this.result=t,!0}});t.exports=o},function(t,e,n){(function(e,n,i){var o=e.Model.extend({call_url:"",call_status:null,call_data:null,model_options:null,_prepareDataForCall:function(t){return t},_addExtraCallOptions:function(t){return t},_handleSpecificError:function(t,e,n){return!1},_processSuccessResponse:function(t,e,n){return!0},doWrappedFetch:function(t){var e=this._setupWrappedCall(t);return this.fetch(e)},doWrappedFormPost:function(t,e){var o=n.extend({data:i.param(t),processData:!1,contentType:"application/x-www-form-urlencoded;charset=UTF-8"},e);return o=this._setupWrappedCall(o),this.sync("create",this,o)},_setupWrappedCall:function(t){this.set("call_data",this._prepareDataForCall(t)),this.set("call_status",this.CALL_IN_PROGRESS,{silent:!0});var e=this,i=n.extend({data:this.get("call_data"),success:function(t,n,i){e._handleCallSuccess(t,n,i)},error:function(t,n,i){e._handleCallError(t,n,i)}},t);return i=this._addExtraCallOptions(i)},isStatusSuccess:function(){return this.get("call_status")==this.CALL_SUCCESS},isStatusInProgress:function(){return this.get("call_status")==this.CALL_IN_PROGRESS},isStatusFailureGeneric:function(){return this.get("call_status")==this.CALL_FAILURE_GENERIC},isStatusFailureTimeout:function(){return this.get("call_status")==this.CALL_FAILURE_TIMEOUT},url:function(){var t=this.get("call_url")?this.get("call_url"):this.call_url;return t},constructor:function(t){this.model_options=t,e.Model.apply(this,arguments)},initialize:function(t,e){e&&e.call_url&&(this.call_url=call_url),this.CALL_TIMEOUT_MILLISECONDS=5e3,this.CALL_SUCCESS=1,this.CALL_IN_PROGRESS=0,this.CALL_ABORT=-1,this.CALL_FAILURE_TIMEOUT=-2,this.CALL_FAILURE_GENERIC=-3},_handleCallError:function(t,e,n){this._handleSpecificError(t,e,n)||this.set("call_status",this.CALL_FAILURE_GENERIC),e&&e.status&&this.set("responseStatus",e.status)},_handleCallSuccess:function(t,e,n){this._processSuccessResponse(t,e,n),this.set("call_status",this.CALL_SUCCESS)}});t.exports=o}).call(e,n(1),n(3),n(2))},function(t,e,n){var i=n(54),o=20,s="https://api.edq.com/capture/address/v2/search",a=i.extend({keyword:"",_prepareDataForCall:function(t){return t.take=o,this.set("call_url",s),t},_addExtraOptions:function(t){return t.timeout=this.CALL_TIMEOUT_MILLISECONDS,t},_handleSpecificError:function(t,e,n){var i=!1;return"abort"==e.statusText?(this.set("call_status",this.CALL_ABORT),i=!0):"timeout"==e.statusText&&(this.set("call_status",this.CALL_FAILURE_TIMEOUT),i=!0),i}});t.exports=a},function(t,e,n){n(40),n(52);var i=n(54),o=i.extend({selected_address:null,getDpid:function(t){var e=null,n=this.get("address");if(n&&n.length>0){var i=n[n.length-1];e=i.deliveryPointId1}return e},_prepareDataForCall:function(t){return this.set("call_url",t.call_url),delete t.call_url,this.set("selected_address",t.selected_address),delete t.selected_address,t},_processSuccessResponse:function(t,e,n){var i=this.get("components"),o=this.get("address");return o&&o.length>0&&(i&&i.length>1&&i.forEach(function(t){"deliveryPointId1"==Object.keys(t)&&(o=o.concat(t))}),this.set("address",o)),!0}});t.exports=o},function(t,e,n){(function(e,i,o){n(58);var s=n(59),a=n(60),r=e.View.extend({_postdata:{testid:null,testtype:"js",ctime:null,mode:null,ppipe:null,ppal:null,screen:null,window:null},_submitted:!1,events:{"click .start-test":"startTest"},initialize:function(){this.action_url=this.$(".test-form").attr("action")+"?asJson=true",this._postdata.testid=this.$("#testid").val(),this._postdata.mode=document.compatMode,this._postdata.screen=window.screen.width+"w "+window.screen.height+"h "+window.screen.pixelDepth+"pp",this._postdata.window=window.screen.availWidth+"w "+window.screen.availHeight+"h";var t=this;i.each(navigator.plugins,function(e,n){t._postdata["pname"+n]=e.name,t._postdata["pfname"+n]=e.filename,t._postdata["pdesc"+n]=e.description,t._postdata["pver"+n]=""})},startTest:function(t){t.preventDefault(),o(t.currentTarget).addClass("loading"),o(t.currentTarget).html("Running tests...");var e=this;return this._testChase(function(t){e._postdata.ppipe=t,e.submitResults.apply(e)}),this._testPaypal(function(t){e._postdata.ppal=t,e.submitResults.apply(e)}),setTimeout(function(){null===e._postdata.ppipe&&(e._postdata.ppipe="Failed"),null===e._postdata.ppal&&(e._postdata.ppal="Failed"),e.submitResults.apply(e)},1e4),!1},showResults:function(t){this.$(".start-test").remove();var e=i.reduce(t,function(t,e){return t+s(e)},"<h2>Diagnostics results</h2>"),n=i.all(t,function(t){return"Success"===t.r});n&&(e=a()+e),this.$(".tech-test-results").html(e)},submitResults:function(){if(this._submitted===!1&&null!==this._postdata.ppipe&&null!==this._postdata.ppal){var t=this;this._submitted=!0,this._postdata.ctime=(new Date).getTime(),o.ajax({url:this.action_url,data:this._postdata,method:"POST",success:function(e){t.showResults.call(t,e.results)}})}},_testChase:function(t){var e=new Image;e.onerror=function(){t("Failed")},e.onload=function(){t("Loaded")},e.src="https://ppipe.net/hpp/resource/image/sprite.png?"+(new Date).getTime(),e.className="zero",this.el.appendChild(e)},_testPaypal:function(t){var e=new Image;e.onerror=function(){t("Failed")},e.onload=function(){t("Loaded")},e.className="zero",e.src="https://www.paypal.com/en_US/i/scr/scr_grayDotRepeatBg_3x1.gif?"+(new Date).getTime(),this.el.appendChild(e)}});t.exports=r}).call(e,n(1),n(3),n(2))},function(t,e){Array.prototype.reduce=function(t){if(void 0===this||null===this)throw new TypeError(this+"is not an object");if(!(t instanceof Function))throw new TypeError(t+" is not a function");var e,n=Object(this),i=(arguments[1],n instanceof String?n.split(""):n),o=Math.max(Math.min(i.length,9007199254740991),0)||0,s=-1;if(1 in arguments)e=arguments[1];else{for(;++s<o&&!(s in i););if(s>=o)throw new TypeError("Reduce of empty array with no initial value");e=i[s]}for(;++s<o;)s in i&&(e=t(e,i[s],s,n));return e}},function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="result-item">\n\t<h3>'+(null==(__t=t)?"":__t)+'</h3>\n\t<p class="'+(null==(__t=r.toLowerCase())?"":__t)+'">'+(null==(__t=r+(m.length>0?": ":"")+m)?"":__t)+"</p>\n</div>";return __p}},function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+="<h2>No issues found</h2>\n<p>All the tests passed. If you're still having issues please contact customer services for further help.</p>\n";return __p}},function(t,e,n){(function(e,n){var i=e.View.extend({tagName:"div",className:"jacket-img-lightbox",id:"jacket-img-lightbox-target",events:{"click .lightbox-close":"closeLightbox"},initialize:function(t){1==t.length&&(this.jacket_img=t,this.render())},render:function(){var t=n("<a>").addClass("lightbox-close").attr("href","#_").append(n("<i>").addClass("icon-close"));this.$el.append(t),this.$el.append(n("<div>").addClass("img-wrapper").append(this.jacket_img.clone())),n("body").append(this.$el)},closeLightbox:function(){n("body").removeClass("lightbox-show")}});t.exports=i}).call(e,n(1),n(2))}]);